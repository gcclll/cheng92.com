<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Vue3 æºç å¤´è„‘é£æš´ä¹‹â˜compiler-core - è‹¥å¶çŸ¥ç§‹</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Zhicheng Lee" /><meta name="description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ ğŸŒ§ åº â­ â­ ç”±äºå›¾ç‰‡æ˜¯ä½¿ç”¨ github åšçš„å›¾åºŠï¼Œæ²¡æœ‰ CDN åŠ é€Ÿ" /><meta name="keywords" content="Vue, React, JavaScript, Python" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />




<meta name="generator" content="Hugo 0.83.1 with theme even" />


<link rel="canonical" href="https://www.cheng92.com/vue/vue-mind-map-house-cc/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.06b20cf21b1dff0a19c6a6fd2770439ed0c003d544ece3c4e1fbfb34fc217e45.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/global.css">


<meta property="og:title" content="Vue3 æºç å¤´è„‘é£æš´ä¹‹â˜compiler-core" />
<meta property="og:description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ ğŸŒ§ åº â­ â­ ç”±äºå›¾ç‰‡æ˜¯ä½¿ç”¨ github åšçš„å›¾åºŠï¼Œæ²¡æœ‰ CDN åŠ é€Ÿ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.cheng92.com/vue/vue-mind-map-house-cc/" /><meta property="article:section" content="vue" />
<meta property="article:published_time" content="2020-11-07T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-11-07T00:00:00&#43;00:00" />

<meta itemprop="name" content="Vue3 æºç å¤´è„‘é£æš´ä¹‹â˜compiler-core">
<meta itemprop="description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ ğŸŒ§ åº â­ â­ ç”±äºå›¾ç‰‡æ˜¯ä½¿ç”¨ github åšçš„å›¾åºŠï¼Œæ²¡æœ‰ CDN åŠ é€Ÿ"><meta itemprop="datePublished" content="2020-11-07T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-11-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="6943">
<meta itemprop="keywords" content="vue,,vue3,,compiler-core,,parser,,compiler," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vue3 æºç å¤´è„‘é£æš´ä¹‹â˜compiler-core"/>
<meta name="twitter:description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ ğŸŒ§ åº â­ â­ ç”±äºå›¾ç‰‡æ˜¯ä½¿ç”¨ github åšçš„å›¾åºŠï¼Œæ²¡æœ‰ CDN åŠ é€Ÿ"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">è‹¥å¶çŸ¥ç§‹</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/emacs/">
        <li class="mobile-menu-item">Emacs</li>
      </a><a href="/algo/">
        <li class="mobile-menu-item">Algorithm</li>
      </a><a href="/web/">
        <li class="mobile-menu-item">Web</li>
      </a><a href="/vue/">
        <li class="mobile-menu-item">Vue</li>
      </a><a href="/react/">
        <li class="mobile-menu-item">React</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">è‹¥å¶çŸ¥ç§‹</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/emacs/">Emacs</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/algo/">Algorithm</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/web/">Web</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/vue/">Vue</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/react/">React</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li id="search">
        <img class="icon" src="/img/search.png"/>
        <input type="search" class="docsearch-input" placeholder="Search" style="display:none;" />
      </li></ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Vue3 æºç å¤´è„‘é£æš´ä¹‹â˜compiler-core</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-11-07 </span>
        <div class="post-category">
            <a href="/categories/vue/"> vue </a>
            </div>
          <span class="more-meta"> çº¦ 6943 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 14 åˆ†é’Ÿ </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡é˜…è¯» </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">ğŸŒ§ åº</a>
</li>
<li><a href="#pcg">ğŸŒ© åŠŸèƒ½ç‰¹æ€§åˆ†æ(parser-&gt;transform-&gt;codegen)</a>
<ul>
<li><a href="#pcg-div">01 div, çº¯æ ‡ç­¾</a>
</li>
<li><a href="#pcg-prop">02 attributes, é™æ€å±æ€§</a>
</li>
<li><a href="#pcg-v-bind">03 v-bind æŒ‡ä»¤</a>
</li>
<li><a href="#pcg-interpolation">04 interpolation, æ’å€¼</a>
</li>
<li><a href="#pcg-v-if">05 v-if æŒ‡ä»¤(git:0a591b6)</a>
<ul>
<li><a href="#pcg-05-01">æ‹“å±• 1ï¼šv-if-else æŒ‡ä»¤</a>
</li>
<li><a href="#pcg-05-02">æ‹“å±• 2ï¼šv-if-elseif-else æŒ‡ä»¤</a>
</li>
</ul>
</li>
<li><a href="#pcg-v-once">06 å« v-once æŒ‡ä»¤æ¨¡æ¿(git:2d0bab4)</a>
</li>
<li><a href="#pcg-vfor">07 v-for æŒ‡ä»¤</a>
</li>
</ul>
</li>
<li><a href="#mmh-key">â˜€ å…³é”®åŠŸèƒ½</a>
<ul>
<li><a href="#key-01-build-props">1. buildProps(node, context) å¦‚ä½•æ„å»º props ?</a>
</li>
<li><a href="#key-02-transform-if">2. transformIf() æ˜¯å¦‚ä½•è¿”å› v-if æŒ‡ä»¤çš„ transform çš„ï¼Ÿ</a>
</li>
<li><a href="#key-03-how-gen-props">3. codegen å¦‚ä½•ç”Ÿæˆå±æ€§(_createBLock(tag, props, â€¦))ç¬¬äºŒä¸ªå‚æ•°ï¼Ÿ</a>
</li>
<li><a href="#headline-16">4. transform é˜¶æ®µå¦‚ä½•å¯¹å±æ€§é™æ€æå‡ï¼Ÿ</a>
</li>
<li><a href="#headline-17">5. codegen å¦‚ä½•ç”Ÿæˆ if-elseif-else åˆ†æ”¯èŠ‚ç‚¹ ?</a>
</li>
<li><a href="#key-06-how-transform-v-else-if">6. transform é˜¶æ®µå¦‚ä½•è½¬æ¢ v-else-if æŒ‡ä»¤ï¼Ÿ</a>
</li>
<li><a href="#key-07-diff-block-vnode">7. ä»€ä¹ˆæ—¶å€™ç”¨ createVNode ä»€ä¹ˆæ—¶å€™ç”¨ createBlock ï¼Ÿ</a>
</li>
<li><a href="#key-08-how-hoist-static">8. transform é˜¶æ®µå¦‚ä½•åšé™æ€æå‡ï¼Ÿ</a>
</li>
<li><a href="#key-09-how-transform-vfor">9. transform é˜¶æ®µå¦‚ä½•è½¬æ¢ v-for æŒ‡ä»¤ï¼Ÿ</a>
</li>
</ul>
</li>
<li><a href="#mmh-cc-parser">â˜ compiler-core: parser</a>
<ul>
<li><a href="#map-parse-with-directive">å¸¦æŒ‡ä»¤çš„æ ‡ç­¾è§£æå…¨è¿‡ç¨‹(<code>v-bind</code>)</a>
</li>
<li><a href="#map-parse-simple-div">æ ‡ç­¾è§£æ(<code>&lt;div&gt;hello world&lt;/div&gt;</code>)</a>
<ul>
<li><a href="#map-parse-self-closing">è‡ªé—­åˆæ ‡ç­¾(<code class="verbatim">&lt;img/&gt;</code>)çš„è§£æï¼Œä¹Ÿåœ¨ parseTag é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªé’ˆå¯¹è¿™ä¸ªçš„å¤„ç†ï¼š</a>
</li>
<li><a href="#map-parse-void-tag">ç©ºæ ‡ç­¾çš„å¤„ç†ï¼Œéœ€è¦åœ¨è°ƒç”¨è§£æå‡½æ•° baseParse çš„æ—¶å€™æ˜ç¡®å‘ŠçŸ¥å®ƒå“ªäº›æ˜¯ç©ºæ ‡ç­¾(å¦‚ï¼š <code>&lt;img&gt;</code>)ï¼š</a>
</li>
<li><a href="#map-parse-template">æ¨¡æ¿æ ‡ç­¾çš„è§£æ(<code>&lt;template&gt;&lt;/template&gt;</code>)</a>
</li>
</ul>
</li>
<li><a href="#map-parse-invalid-div">è§£ææ— æ•ˆçš„ <code>&lt;/div&gt;</code></a>
</li>
<li><a href="#map-parse-interpolation">æ’å€¼è§£æ <code>some {{ foo + bar }} text</code></a>
</li>
<li><a href="#map-parse-simple-text">è§£æ <code>simple text</code></a>
</li>
</ul>
</li>
<li><a href="#mmh-cc-compiler">ğŸŒ™ compiler-core: compiler</a>
<ul>
<li><a href="#compiler-01">01-simple text ç¼–è¯‘è¿‡ç¨‹</a>
</li>
<li><a href="#compiler-02">02-pure interpolation ç¼–è¯‘è¿‡ç¨‹</a>
</li>
<li><a href="#compiler-03">03-inerpolation in pure div</a>
</li>
<li><a href="#compiler-04">04-interpolation in div with props</a>
</li>
<li><a href="#compiler-05">05-interpolation, v-if, props</a>
</li>
</ul>
</li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      
<link href="https://fonts.goo~gleapis.com/cs~s2?family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
<kbd>
<font color="blue" size="3" style="font-family: 'ZCOOL XiaoWei', serif;">
  è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚
</font>
</kbd><br><br>
<p>
<img src="/img/bdx/yiyeshu-001.jpg" alt="/img/bdx/yiyeshu-001.jpg" title="/img/bdx/yiyeshu-001.jpg" /></p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
ğŸŒ§ åº
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>â­ â­ ç”±äºå›¾ç‰‡æ˜¯ä½¿ç”¨ github åšçš„å›¾åºŠï¼Œæ²¡æœ‰ CDN åŠ é€Ÿï¼Œä¸”æœ‰äº›å›¾ç‰‡æ¯”è¾ƒå¤§(å¯èƒ½</p>
<p>
â­ â­ å¿« 1M) åŠ è½½æŒºæ…¢çš„ï¼Œæ¯å¼ å›¾ç‰‡éƒ½æœ‰å¯¹åº”çš„ä¸ƒç‰›(ä½†ä¸ä¸€å®šæ˜¯æœ€æ–°çš„)é“¾æ¥ï¼Œå¯èƒ½ä¼šå¿«ä¸€ç‚¹ã€‚</p>
<p>
â­ â­ å›¾ç‰‡å·²å…¨éƒ¨æ›´æ–°åˆ° <code>https://www.cheng92.com/img/...</code> ä¸‹</p>
<p>
ğŸ˜„ æ›´æ–°æ—¥å¿—</p>
<ol>
<li>
<p><span class="timestamp">&lt;2020-09-07 Mon&gt;</span>  <del>æ‰€æœ‰å›¾ç‰‡ä¿®æ”¹ä¸º github åœ°å€ï¼Œåç»­ä¿®æ”¹å›¾ç‰‡å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸
éœ€è¦ä¸Šä¼ åˆ°ä¸ƒç‰›ã€‚</del></p>
</li>
<li>
<p><span class="timestamp">&lt;2020-09-10 Thu&gt;</span>  <del>å›¾åºŠåˆ‡æ¢åˆ° <a href="https://gitee.com/gcclll/mind-maps.git">ç äº‘ gitee</a> è‡ªåŠ¨åŒæ­¥è‡ª <a href="https://github.com/gcclll/mind-maps.git">github</a>ã€‚</del></p>
</li>
<li>
<p><span class="timestamp">&lt;2020-09-11 Fri&gt;</span>  æ›´æ–°å›¾ç‰‡åˆ°åšå®¢ç›®å½• <code>/static/imgs/...</code> ï¼Œæ–‡å†…è®¿é—®è·¯å¾„ï¼š
<code>/img/vue3/...</code> ï¼Œå•ç‹¬è®¿é—®åŠ ä¸ŠåŸŸåå°±è¡Œï¼š <code>https://www.cheng92.com/img/vue3/...</code></p>
</li>
<li>
<p><span class="timestamp">&lt;2020-09-28 Mon&gt;</span> æ‰€æœ‰è„‘å›¾ä¿®æ”¹ä¸º svg æ ¼å¼ï¼Œå»ºè®®é€šè¿‡æ–° tab æ‰“å¼€ï¼Œæœ‰äº›èŠ‚ç‚¹å¯èƒ½åŒ…å«é“¾
æ¥ã€‚</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-pcg" class="outline-2">
<h2 id="pcg">
ğŸŒ© åŠŸèƒ½ç‰¹æ€§åˆ†æ(parser-&gt;transform-&gt;codegen)
</h2>
<div id="outline-text-pcg" class="outline-text-2">
<p>
ä» <a href="#compiler-01">compiler-01</a> å¼€å§‹éƒ½æ˜¯é’ˆå¯¹æŸä¸ªç¤ºä¾‹åšçš„åˆ†æï¼Œä½†æ˜¯éšæ—¶ç¤ºä¾‹çš„æ¨¡æ¿å¤æ‚åº¦å¢åŠ ï¼Œè„‘å›¾
çš„å¤§å°å°†è¶Šæ¥è¶Šå¤§ï¼Œä¸å ªé‡è´Ÿï¼Œé˜…è¯»å›é¡¾èµ·æ¥ä¹Ÿå¾ˆè´¹åŠ²ï¼Œåœ¨å®Œæˆäº† <a href="#compiler-01">compiler-01</a> -
<a href="#compiler-05">compiler-05</a> ä¹‹åå¯¹æ•´ä¸ªåˆ†æè¿‡ç¨‹ä¹Ÿæœ‰äº†å¤§æ¦‚çš„äº†è§£ï¼Œå¦èµ·è¿™ä¸€ç« èŠ‚çš„ç›®çš„å°±æ˜¯ä¸ºäº†èƒ½å•çº¯
çš„é’ˆå¯¹æŸä¸€ç‰¹å®šåŠŸèƒ½ç»˜åˆ¶å¯¹åº”çš„æµç¨‹å›¾ï¼Œæ¯”å¦‚ï¼š</p>
<p>
å±æ€§æ˜¯å¦‚ä½•è§£æçš„ï¼Œæœ€ååœ¨ render å‡½æ•°ä¸­åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>
æ’å€¼ï¼Ÿ <code>v-if, v-else, v-for, v-once</code> ç­‰æŒ‡ä»¤åˆæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ</p>
<blockquote>
<p>è¿™ä¸€ç« èŠ‚çš„æ‰€æœ‰è„‘å›¾ï¼Œç»˜åˆ¶åˆ†ä¸ºä»¥ä¸‹é˜¶æ®µï¼Œå¦‚æœæµç¨‹ç®€å•å¤šä¸ªé˜¶æ®µå¯èƒ½ä¼šåœ¨åŒä¸€å¼ è„‘å›¾ä¸Š</p>
<ol>
<li>
<p><strong>parser</strong> é˜¶æ®µå¾—åˆ°å®Œæ•´çš„ ast</p>
</li>
<li>
<p><strong>compiler</strong> é˜¶æ®µè§£æ ast ç”ŸæˆèŠ‚ç‚¹ <code>codegenNode</code></p>
</li>
<li>
<p><strong>generate</strong> é˜¶æ®µåˆ©ç”¨ <code>codegenNode</code> ç»„è£…æˆ render å‡½æ•°</p>
</li>
<li>
<p>å¾…ç»­â€¦â€¦</p>
</li>
</ol>
</blockquote>
<p>
ç« èŠ‚é¢„è§ˆï¼š</p>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>ç®€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#pcg-div">div</a></td>
<td><code>&lt;div&gt;&lt;/div&gt;</code></td>
</tr>
<tr>
<td><a href="#pcg-prop">attributes,é™æ€å±æ€§</a></td>
<td><code>&lt;div id=&#34;foo&#34;&gt;&lt;/div&gt;</code></td>
</tr>
<tr>
<td><a href="#pcg-v-bind">v-bind</a></td>
<td><code>&lt;div :class=&#34;bar.baz&#34;&gt;&lt;/div&gt;</code></td>
</tr>
<tr>
<td><a href="#pcg-interpolation">interpolation</a></td>
<td><code>&lt;div&gt;{{ world.burn() }}&lt;/div&gt;</code></td>
</tr>
<tr>
<td><a href="#pcg-v-if">v-if</a></td>
<td><code>&lt;div&gt;&lt;div v-if=&#34;ok&#34;&gt;yes&lt;/div&gt;&lt;/div&gt;</code></td>
</tr>
<tr>
<td><a href="#pcg-v-once">v-once</a></td>
<td><code>&lt;div&gt;&lt;p v-once&gt;test v-once&lt;/p&gt;&lt;/div&gt;</code></td>
</tr>
</tbody>
</table>
<div id="outline-container-pcg-div" class="outline-3">
<h3 id="pcg-div">
<span class="todo">DONE</span>
01 div, çº¯æ ‡ç­¾
</h3>
<div id="outline-text-pcg-div" class="outline-text-3">
<p>
<code>&lt;div&gt;&lt;/div&gt;</code></p>
<p>
ç»“æœï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">(</span><span class="kd">function</span> <span class="nx">anonymous</span><span class="p">(</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span> <span class="nx">openBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">openBlock</span><span class="p">,</span> <span class="nx">createBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createBlock</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span>

        <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">))</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-01-pure-div.svg" alt="/img/vue3/compiler-core/pcg/pcg-01-pure-div.svg" title="/img/vue3/compiler-core/pcg/pcg-01-pure-div.svg" /></p>
<ol>
<li>
<p>parser é˜¶æ®µï¼Œ <a href="/vue/vue3-source-code-compiler-core-parse_ts/#parse-parseelement">parseElement</a> -&gt; <a href="/vue/vue3-source-code-compiler-core-parse_ts/#parse-parsetag">parseTag</a></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-01-1-parser-pure-div.svg" alt="/img/vue3/compiler-core/pcg/pcg-01-1-parser-pure-div.svg" title="/img/vue3/compiler-core/pcg/pcg-01-1-parser-pure-div.svg" /></p>
</li>
<li>
<p>compiler é˜¶æ®µï¼Œ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-transform">transform</a> -&gt; <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-traversenode">traverseNode</a> -&gt; <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-traversechildren">traverseChildren</a> ï¼Œåªæœ‰ <code>0,ROOT</code>
å’Œ <code>1,ELEMENT</code> ä¸¤ä¸ªç±»å‹åˆ†æ”¯å¤„ç†ã€‚</p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-01-2-compiler-pure-div.svg" alt="/img/vue3/compiler-core/pcg/pcg-01-2-compiler-pure-div.svg" title="/img/vue3/compiler-core/pcg/pcg-01-2-compiler-pure-div.svg" /></p>
</li>
<li>
<p>codegen é˜¶æ®µï¼Œåªæœ‰ div çš„ block å¤„ç†(<code>_openBlock(), _createBlock(&#34;div&#34;)</code>)</p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-01-3-codegen-pure-div.svg" alt="/img/vue3/compiler-core/pcg/pcg-01-3-codegen-pure-div.svg" title="/img/vue3/compiler-core/pcg/pcg-01-3-codegen-pure-div.svg" /></p>
</li>
</ol>
</div>
</div>
<div id="outline-container-pcg-prop" class="outline-3">
<h3 id="pcg-prop">
<span class="todo">DONE</span>
02 attributes, é™æ€å±æ€§
</h3>
<div id="outline-text-pcg-prop" class="outline-text-3">
<p>
<code>&lt;div id=&#34;foo&#34;&gt;&lt;/div&gt;</code></p>
<ol>
<li>
<p><strong>parser é˜¶æ®µ</strong> ï¼š</p>
<p>
ä¸ <a href="#pcg-01">pcg-01</a> ç›¸æ¯”è¾ƒï¼Œå¤šäº†å·¦è¾¹ <a href="/vue/vue3-source-code-compiler-core-parse_ts/#parse-parsetag">parseTag</a> -&gt; <a href="/vue/vue3-source-code-compiler-core-parse_ts/#parse-parseattributes">parseAttributes</a> -&gt; <a href="/vue/vue3-source-code-compiler-core-parse_ts/#parse-parseattribute">parseAttribute</a> è§£æå±
æ€§ <code>id=&#34;foo&#34;</code> çš„å¤„ç†ã€‚</p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-02-1-parser-div-with-id.svg" alt="/img/vue3/compiler-core/pcg/pcg-02-1-parser-div-with-id.svg" title="/img/vue3/compiler-core/pcg/pcg-02-1-parser-div-with-id.svg" /></p>
</li>
<li>
<p><strong>compiler é˜¶æ®µï¼š</strong></p>
<p>
ä¸ <a href="#pcg-01">pcg-01</a> ç›¸æ¯”è¾ƒï¼Œå¤šäº† <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-transformelement">transformElement</a> ä¸­ props å±æ€§çš„å¤„ç†ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™
props.length = 1 é‡Œé¢æœ‰ä¸€ä¸ª <code>id=&#34;foo&#34;</code> å±æ€§ï¼Œéœ€è¦å»è°ƒç”¨ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-buildprops">buildProps</a> è§£æï¼Œæˆä¸‹é¢
çš„è§£æ„:</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">{</span>
    <span class="nx">properties</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">key</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="p">...},</span> <span class="c1">// SIMPLE_EXPRESSION
</span><span class="c1"></span>        <span class="nx">value</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">&#34;foo&#34;</span><span class="p">,</span> <span class="p">...},</span>
        <span class="nx">type</span><span class="o">:</span> <span class="mi">16</span> <span class="c1">// JS_PROPERTY
</span><span class="c1"></span>      <span class="p">}</span>
    <span class="p">]</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span> <span class="c1">// JS_OBJECT_EXPRESSION
</span><span class="c1"></span>  <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-02-2-compiler-div-with-id.svg" alt="/img/vue3/compiler-core/pcg/pcg-02-2-compiler-div-with-id.svg" title="/img/vue3/compiler-core/pcg/pcg-02-2-compiler-div-with-id.svg" /></p>
</li>
<li>
<p><strong>codegen é˜¶æ®µï¼š</strong></p>
<p>
åœ¨ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#codegen-gennodelist">genNodeList([tag, props, children, â€¦], ctx)</a> è§£æçš„æ—¶å€™ï¼Œè¿™é‡Œ props ä¸å†æ˜¯
nullï¼Œå› æ­¤ä¼šè¿›å…¥ Props è§£æè¿‡ç¨‹ï¼š</p>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#codegen-gennode">genNode(props, ctx)</a> -&gt; <strong>15,JS_OBJECT_EXPRESSION</strong> -&gt; <a href="/vue/vue3-source-code-compiler-core-compile_ts/#codegen-genobjectexpression">genObjectExpression(node,
ctx)</a> -&gt; éå† <strong>node.properties</strong>  -&gt; <a href="/vue/vue3-source-code-compiler-core-compile_ts/#codegen-genexpressionaspropertykey">genExpressionPropertyKey(key,ctx)</a> ç”Ÿæˆå±æ€§
å <code>{ id: ~ -&gt; ~genNode(value, ctx)</code> ç”Ÿæˆå±æ€§å€¼ -&gt; <strong>4, SIMPLE_EXPRESSION</strong> -&gt;
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#codegen-genexpression">genExpression(value, ctx)</a> ç”Ÿæˆå±æ€§å€¼ <code>{ id: &#34;foo&#34;</code></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-02-3-codegen-div-with-id.svg" alt="/img/vue3/compiler-core/pcg/pcg-02-3-codegen-div-with-id.svg" title="/img/vue3/compiler-core/pcg/pcg-02-3-codegen-div-with-id.svg" /></p>
</li>
</ol>
</div>
</div>
<div id="outline-container-pcg-v-bind" class="outline-3">
<h3 id="pcg-v-bind">
<span class="todo">DONE</span>
03 v-bind æŒ‡ä»¤
</h3>
<div id="outline-text-pcg-v-bind" class="outline-text-3">
<p>
<code>&lt;div :class=&#34;bar.baz&#34;&gt;&lt;/div&gt;</code></p>
<p>
ç»“æœé¢„è§ˆï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">(</span><span class="kd">function</span> <span class="nx">anonymous</span><span class="p">(</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">createVNode</span> <span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span> <span class="nx">openBlock</span> <span class="o">:</span> <span class="mi">_</span><span class="nx">openBlock</span><span class="p">,</span> <span class="nx">createBlock</span> <span class="o">:</span> <span class="mi">_</span><span class="nx">createBlock</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span>

        <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="kr">class</span><span class="o">:</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">baz</span> <span class="p">},</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span> <span class="cm">/* CLASS */</span><span class="p">))</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<ol>
<li>
<p><strong>parser é˜¶æ®µï¼š</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-03-1-parser-div-with-bind.svg" alt="/img/vue3/compiler-core/pcg/pcg-03-1-parser-div-with-bind.svg" title="/img/vue3/compiler-core/pcg/pcg-03-1-parser-div-with-bind.svg" /></p>
</li>
<li>
<p><strong>compiler é˜¶æ®µï¼š</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-03-2-compiler-div-with-bind.svg" alt="/img/vue3/compiler-core/pcg/pcg-03-2-compiler-div-with-bind.svg" title="/img/vue3/compiler-core/pcg/pcg-03-2-compiler-div-with-bind.svg" /></p>
</li>
<li>
<p><strong>codegen é˜¶æ®µï¼š</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-03-3-codegen-div-with-bind.svg" alt="/img/vue3/compiler-core/pcg/pcg-03-3-codegen-div-with-bind.svg" title="/img/vue3/compiler-core/pcg/pcg-03-3-codegen-div-with-bind.svg" /></p>
</li>
</ol>
</div>
</div>
<div id="outline-container-pcg-interpolation" class="outline-3">
<h3 id="pcg-interpolation">
<span class="todo">DONE</span>
04 interpolation, æ’å€¼
</h3>
<div id="outline-text-pcg-interpolation" class="outline-text-3">
<p>
<code>&lt;div&gt;{{ world.burn() }}&lt;/div&gt;</code></p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">(</span><span class="kd">function</span> <span class="nx">anonymous</span><span class="p">(</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">toDisplayString</span> <span class="o">:</span> <span class="mi">_</span><span class="nx">toDisplayString</span><span class="p">,</span> <span class="nx">createVNode</span> <span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span> <span class="nx">openBlock</span> <span class="o">:</span> <span class="mi">_</span><span class="nx">openBlock</span><span class="p">,</span> <span class="nx">createBlock</span> <span class="o">:</span> <span class="mi">_</span><span class="nx">createBlock</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span>

        <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">_</span><span class="nx">toDisplayString</span><span class="p">(</span><span class="nx">world</span><span class="p">.</span><span class="nx">burn</span><span class="p">()),</span> <span class="mi">1</span> <span class="cm">/* TEXT */</span><span class="p">))</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<ol>
<li>
<p><strong>parser é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-04-1-parser-div-with-interpolation.svg" alt="/img/vue3/compiler-core/pcg/pcg-04-1-parser-div-with-interpolation.svg" title="/img/vue3/compiler-core/pcg/pcg-04-1-parser-div-with-interpolation.svg" /></p>
</li>
<li>
<p><strong>compiler é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-04-2-compiler-div-with-interpolation.svg" alt="/img/vue3/compiler-core/pcg/pcg-04-2-compiler-div-with-interpolation.svg" title="/img/vue3/compiler-core/pcg/pcg-04-2-compiler-div-with-interpolation.svg" /></p>
</li>
<li>
<p><strong>codegen é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-04-3-codegen-div-with-interpolation.svg" alt="/img/vue3/compiler-core/pcg/pcg-04-3-codegen-div-with-interpolation.svg" title="/img/vue3/compiler-core/pcg/pcg-04-3-codegen-div-with-interpolation.svg" /></p>
</li>
</ol>
</div>
</div>
<div id="outline-container-pcg-v-if" class="outline-3">
<h3 id="pcg-v-if">
<span class="todo">DONE</span>
05 v-if æŒ‡ä»¤(<a href="https://github.com/gcclll/vue-next-code-read/commit/0a591b62d6961526b333afeb5f77c532b3992e31">git:0a591b6</a>)
</h3>
<div id="outline-text-pcg-v-if" class="outline-text-3">
<p>
<code>&lt;div&gt;&lt;div v-if=&#34;ok&#34;&gt;yes&lt;/div&gt;&lt;/div&gt;</code></p>
<p>
<strong>git commit: <a href="https://github.com/gcclll/vue-next-code-read/commit/0a591b62d6961526b333afeb5f77c532b3992e31">0a591b62d6961526b333afeb5f77c532b3992e31</a></strong></p>
<p>
vue.global:</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">(</span><span class="kd">function</span> <span class="nx">anonymous</span><span class="p">(</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span> <span class="nx">createCommentVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span>

    <span class="kr">const</span> <span class="mi">_</span><span class="nx">hoisted_1</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span> <span class="nx">openBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">openBlock</span><span class="p">,</span> <span class="nx">createBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">,</span> <span class="nx">createCommentVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span>

        <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">[</span>
          <span class="nx">ok</span>
            <span class="o">?</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_1</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">))</span>
            <span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span><span class="p">(</span><span class="s2">&#34;v-if&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
        <span class="p">]))</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å·®å¼‚ç‚¹ï¼š</p>
<ul>
<li>
<p>å°‘äº†å…¨å±€ä½œç”¨åŸŸä¸‹çš„ <code>_Vue</code> è§£æ„</p>
</li>
<li>
<p>key æ²¡æœ‰ hoisted</p>
</li>
</ul>
<p>è„‘å›¾åˆ—è¡¨ï¼š</p>
<ol>
<li>
<p><strong>parser é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-1-parser-div-with-if.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-1-parser-div-with-if.svg" title="/img/vue3/compiler-core/pcg/pcg-05-1-parser-div-with-if.svg" /></p>
</li>
<li>
<p><strong>compiler é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-2-compiler-div-with-if.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-2-compiler-div-with-if.svg" title="/img/vue3/compiler-core/pcg/pcg-05-2-compiler-div-with-if.svg" /></p>
</li>
<li>
<p><strong>codegen é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-3-codegen-div-with-if.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-3-codegen-div-with-if.svg" title="/img/vue3/compiler-core/pcg/pcg-05-3-codegen-div-with-if.svg" /></p>
</li>
</ol>
<div id="outline-container-pcg-05-01" class="outline-4">
<h4 id="pcg-05-01">
æ‹“å±• 1ï¼šv-if-else æŒ‡ä»¤
</h4>
<div id="outline-text-pcg-05-01" class="outline-text-4">
<p>
<code>&lt;div&gt;&lt;div v-if=&#34;ok&#34;&gt;yes&lt;/div&gt;&lt;div v-else&gt;no&lt;/div&gt;&lt;/div&gt;</code></p>
<p>
vue.global:</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">(</span><span class="kd">function</span> <span class="nx">anonymous</span><span class="p">(</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span> <span class="nx">createCommentVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span>

    <span class="kr">const</span> <span class="mi">_</span><span class="nx">hoisted_1</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">hoisted_2</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span> <span class="nx">openBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">openBlock</span><span class="p">,</span> <span class="nx">createBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">,</span> <span class="nx">createCommentVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span> <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span>

        <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">[</span>
          <span class="nx">ok</span>
            <span class="o">?</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_1</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">))</span>
            <span class="o">:</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_2</span><span class="p">,</span> <span class="s2">&#34;no&#34;</span><span class="p">))</span>
        <span class="p">]))</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
ä¸ <a href="#pcg-05">pcg-05</a> å·®å¼‚ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">ok</span>
    <span class="o">?</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_1</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">))</span>
    <span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span><span class="p">(</span><span class="s2">&#34;v-if&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// è¿™é‡Œæ²¡æœ‰ elseif, else åˆ†æ”¯ä¼šåˆ›å»ºä¸€ä¸ªæ³¨é‡ŠèŠ‚ç‚¹
</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å’Œ</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">ok</span>
    <span class="o">?</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_1</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">))</span>
    <span class="o">:</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_2</span><span class="p">,</span> <span class="s2">&#34;no&#34;</span><span class="p">))</span> <span class="c1">// åˆ†æ”¯èŠ‚ç‚¹
</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
é€ æˆè¿™å·®ä¸€ç‚¹æ˜¯åœ¨å“ªå¤„ç†çš„å‘¢ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>
v-if æŒ‡ä»¤çš„ codegen è¿‡ç¨‹æœ‰ä¸‰ä¸ªé‡è¦å› ç´ ï¼š</p>
<ol>
<li>
<p>test ç”Ÿæˆæ¡ä»¶è¡¨è¾¾å¼</p>
</li>
<li>
<p>consequent ç”Ÿæˆæˆç«‹æ¡ä»¶(<code>ok=true</code>)è¡¨è¾¾å¼çš„</p>
</li>
<li>
<p>alternate ç”Ÿæˆå¤±è´¥æ¡ä»¶(<code>ok=false</code>)è¡¨è¾¾å¼çš„</p>
</li>
</ol>
<p>å› æ­¤è¯¥æ‰©å±•é‡ç‚¹åœ¨ alternate å¤„ç† ğŸ›¬â€¦</p>
<p>
åœ¨ transform é˜¶æ®µé’ˆå¯¹ <code>v-else</code> çš„å¤„ç†é€»è¾‘ï¼š</p>
<blockquote>
<p>traverseNode ä¸­çš„ exitFns æ”¶é›†é˜¶æ®µï¼Œè°ƒç”¨ transformIf å– transform å‡½æ•°è¿‡ç¨‹ä¸­ï¼Œæœ‰
ä»¥ä¸‹å‡ ä¸ªé‡è¦æ­¥éª¤ï¼š</p>
<ol>
<li>
<p>éå†å½“å‰ <code>v-else</code> èŠ‚ç‚¹çš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹(<code>siblings=parent.children</code>)</p>
</li>
<li>
<p>æ‰¾åˆ°å½“å‰èŠ‚ç‚¹ node åœ¨ <code>siblings</code> ä¸­çš„ä½ç½® i</p>
</li>
<li>
<p><code>while i--</code> ä¾æ¬¡å¾€å‰æ‰¾å…„å¼ŸèŠ‚ç‚¹(å¦‚æœæ˜¯ <strong>COMMENT</strong> èŠ‚ç‚¹ï¼Œåˆ é™¤ä¿å­˜å¾…æ¢å¤ï¼Œå¦‚æœæ˜¯
<strong>9,IF</strong> èŠ‚ç‚¹å³æ‰¾åˆ°çš„ç›®æ ‡èŠ‚ç‚¹ sibling)</p>
</li>
<li>
<p>åˆ é™¤å½“å‰çš„ node åŒæ—¶è°ƒç”¨ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-createifbranch">createIfBranch</a> åˆ›å»º <code>10,IF_BRANCH</code> ç±»å‹çš„åˆ†æ”¯èŠ‚ç‚¹ç»“
æ„ï¼Œåˆå¹¶åˆ° <code>sibling.branches</code> ä¸­</p>
</li>
<li>
<p>è°ƒç”¨ <code>processCodegen</code> å‡½æ•°å³ <code>transformIf</code> æ—¶å€™æ‰§è¡Œä¼šå¾—åˆ°ç”Ÿæˆ <code>codegenNode</code>
çš„é‚£ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œå®ƒè·å– tranform å‡½æ•° <code>exitFn</code> ã€‚</p>
</li>
<li>
<p>æ‰‹åŠ¨æ‰§è¡Œ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-traversenode">traverseNode(node, â€¦)</a> è¿›è¡Œé€’å½’éå†è¯¥ v-else èŠ‚ç‚¹æ ‘(<strong>å› ä¸ºåœ¨ 4 ä¸­èŠ‚ç‚¹
è¢«åˆ é™¤äº†ï¼Œå› æ­¤ä¸»é€’å½’çº¿ä¸Šä¸ä¼šå‡ºç°è¿™ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ traverse</strong>)</p>
</li>
<li>
<p>æœ€åæ‰§è¡Œ exitFn ç”Ÿæˆè¯¥ <code>v-else</code> èŠ‚ç‚¹æ ‘çš„ <code>codegenNode</code> ã€‚</p>
<p>
<strong>æ³¨æ„ç‚¹</strong> ï¼šè¿™ä¸€æ­¥ <code>v-else</code> æ›¿æ¢ alternate è¿‡ç¨‹ä¸­æœ‰ä¸ª while å¾ªç¯ç”¨æ¥é€’å½’æŸ¥æ‰¾é
<strong>19,JS_CONDITIONAL_EXPRESSION</strong> ç±»å‹çš„èŠ‚ç‚¹çš„ alternate å†è¿›è¡Œæ›¿æ¢ï¼Œè¿™ä¹ˆåšçš„åŸ
å› æ˜¯ v-if-else æŒ‡ä»¤çš„åœ¨ render å‡½æ•°ä¸­æ˜¯é€šè¿‡ä¸‰ç›®è¿ç®—ç¬¦(<code>?:</code>)å®ç°çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹
<code>:</code> åé¢çš„æ˜¯ä¸€ä¸ª comment vnode ç±»å‹å ä½ç”¨ï¼Œå½“å®é™…æœ‰ else åˆ†æ”¯çš„æ—¶å€™ä¼šè¿›è¡Œæ›¿æ¢ï¼Œ
æ­¤æ—¶æ›¿æ¢éœ€è¦è€ƒè™‘åˆ°è¡¨è¾¾å¼åµŒå¥—çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦æ‰¾åˆ°æœ€åé‚£ä¸ª comment vnode ï¼Œè¯¦ç»†
æ­¥éª¤ç›´æ¥çœ‹è„‘å›¾å§ã€‚</p>
</li>
</ol>
</blockquote>
<ol>
<li>
<p><strong>parser é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-01-1-parser-div-with-if-else.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-01-1-parser-div-with-if-else.svg" title="/img/vue3/compiler-core/pcg/pcg-05-01-1-parser-div-with-if-else.svg" /></p>
</li>
<li>
<p><strong>transform é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-01-2-compiler-div-with-if-else.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-01-2-compiler-div-with-if-else.svg" title="/img/vue3/compiler-core/pcg/pcg-05-01-2-compiler-div-with-if-else.svg" /></p>
</li>
<li>
<p><strong>codegen é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-01-3-codegen-div-with-if-else.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-01-3-codegen-div-with-if-else.svg" title="/img/vue3/compiler-core/pcg/pcg-05-01-3-codegen-div-with-if-else.svg" /></p>
</li>
</ol>
</div>
</div>
<div id="outline-container-pcg-05-02" class="outline-4">
<h4 id="pcg-05-02">
æ‹“å±• 2ï¼šv-if-elseif-else æŒ‡ä»¤
</h4>
<div id="outline-text-pcg-05-02" class="outline-text-4">
<ol>
<li>
<p><strong>parser é˜¶æ®µ</strong></p>
<p>
ç›¸æ¯”è¾ƒ <a href="#pcg-05-01">æ‹“å±•1ï¼šv-if-else</a> è¿™é‡Œåªæ˜¯å¤šäº†ä¸€ä¸ª v-else-if è¿™åœ¨ parser é˜¶æ®µæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œ
ç›´æ¥å‚è€ƒæ‹“å±• 1 çš„è„‘å›¾ã€‚</p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-02-1-parser-div-with-if-eif-else.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-02-1-parser-div-with-if-eif-else.svg" title="/img/vue3/compiler-core/pcg/pcg-05-02-1-parser-div-with-if-eif-else.svg" /></p>
</li>
<li>
<p><strong>transform é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-02-2-compiler-div-with-if-eif-else.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-02-2-compiler-div-with-if-eif-else.svg" title="/img/vue3/compiler-core/pcg/pcg-05-02-2-compiler-div-with-if-eif-else.svg" /></p>
<p>
å¯¹æ¯”å‰åç»“æœå‘ç°ï¼š <code>v-if/v-else-if/v-else</code> æŒ‡ä»¤ä½“ç³»çš„å®ç°å…³é”®åœ¨äº <code>codegenNode</code> ä¸­
ä¸‰ä¸ªå­—æ®µï¼š</p>
<ul>
<li>
<p><strong>test</strong> <code>?:</code> è¡¨è¾¾å¼çš„æ¡ä»¶</p>
</li>
<li>
<p><strong>consequent</strong> <code>?:</code> è¡¨è¾¾å¼æ¡ä»¶ä¸º <code>true</code> çš„æ—¶å€™æ¸²æŸ“çš„èŠ‚ç‚¹</p>
</li>
<li>
<p><strong>alternate</strong> <code>?:</code> è¡¨è¾¾å¼æ¡ä»¶ä¸º <code>false</code> çš„æ—¶å€™æ¸²æŸ“çš„èŠ‚ç‚¹</p>
</li>
</ul>
<p>å¦‚æœæœ‰å¤šçº§åµŒå¥—çš„æƒ…å†µï¼Œä¼šåœ¨ <code>alternate</code> ä¸­ä½“ç°å‡ºæ¥ï¼Œè¿™é‡Œé¢è¦ä¹ˆæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ç»“æ„ï¼Œ
è¦ä¹ˆæ˜¯ä¸€ä¸ªå®Œæ•´çš„åŒ…å«(<code>{ test, consequent, alternate }</code>) åµŒå¥—çš„è¡¨è¾¾å¼ç»“æ„ã€‚</p>
<p>
<code>v-else-if</code> <a href="#key-02-transform-if">æ¸²æŸ“æµç¨‹æŸ¥çœ‹ç‰¹å®šçš„åŠŸèƒ½è„‘å›¾</a>ã€‚</p>
</li>
<li>
<p><strong>codegen é˜¶æ®µ</strong></p>
<p>
<img src="/img/vue3/compiler-core/pcg/pcg-05-02-3-codegen-div-with-if-eif-else.svg" alt="/img/vue3/compiler-core/pcg/pcg-05-02-3-codegen-div-with-if-eif-else.svg" title="/img/vue3/compiler-core/pcg/pcg-05-02-3-codegen-div-with-if-eif-else.svg" /></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-pcg-v-once" class="outline-3">
<h3 id="pcg-v-once">
<span class="todo">DONE</span>
06 å« v-once æŒ‡ä»¤æ¨¡æ¿(<a href="http://localhost:1313/vue/vue-mind-map-house/#pcg-interpolation">git:2d0bab4</a>)
</h3>
<div id="outline-text-pcg-v-once" class="outline-text-3">
<p>
<code>&lt;div&gt;&lt;p v-once&gt;test v-once&lt;/p&gt;&lt;/div&gt;</code></p>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/pcg/pcg-06-v-once.svg" alt="/img/vue3/compiler-core/pcg/pcg-06-v-once.svg" title="/img/vue3/compiler-core/pcg/pcg-06-v-once.svg" /></p>
<p>
<strong>git commit: <a href="https://github.com/gcclll/vue-next-code-read/commit/2d0bab4cfbf3408afe93270d7e9dc8ecd511dbe0">2d0bab4cfbf3408afe93270d7e9dc8ecd511dbe0</a></strong></p>
<ol>
<li>
<p>parser é˜¶æ®µæ²¡ä»€ä¹ˆä¸åŒï¼Œæœ€ç»ˆéƒ½æ˜¯ç”ŸæˆæŒ‡ä»¤ç±»å‹çš„ ast æ ‘</p>
</li>
<li>
<p>é‡ç‚¹åœ¨ transform é˜¶æ®µï¼Œå…ˆ <a href="/vue/vue3-source-code-function-list/#transform-transformtext">transformText</a> -&gt; <a href="/vue/vue3-source-code-function-list/#transform-transformelement">transformElement</a> -&gt; <a href="/vue/vue3-source-code-function-list/#transform-transformonce">transformOnce</a>
å¤„ç†</p>
<p>
ç»è¿‡ <code>transformOnce</code> ä¹‹å codegenNodeç»“æœå˜åŒ–ï¼Œä» <strong>13,VNODE_CALL</strong> ç±»å‹å˜æˆäº†
<strong>20,JS_CACHE_EXPRESSION</strong> ç±»å‹ã€‚</p>
<ul>
<li>
<p>æ›´æ–° <a href="/vue/vue3-source-code-function-list/#transform-getbasetransformpreset">getBaseTransformPreset</a></p>
</li>
<li>
<p>å®ç° <a href="/vue/vue3-source-code-function-list/#transform-vonce">transforms/vOnce-&gt;transformOnce</a></p>
</li>
<li>
<p><a href="/vue/vue3-source-code-function-list/#transform-buildprops">buildProps(node, ctx props = node.props, ssr=false) </a>ä¸­å¿½ç•¥å±æ€§ <code>v-once</code> å¤„ç†ï¼Œ
äº¤ç»™ <code>transformOnce()</code> å¤„ç†</p>
</li>
</ul>
</li>
<li>
<p>codegen é˜¶æ®µçš„å¤„ç†ï¼Œç”Ÿæˆ Render å‡½æ•°ï¼Œå¯¹äº v-once å¤„ç†åŸç†æ˜¯åˆ©ç”¨ç¼“å­˜æœºåˆ¶ï¼Œç¬¬
ä¸€æ¬¡åˆ›å»ºèŠ‚ç‚¹å­˜å‚¨åˆ°å¯¹åº”çš„ <code>context.cache[]</code> ä¸­ï¼Œåé¢æ›´æ–°èŠ‚ç‚¹æ—¶å€™ç›´æ¥å–å¯¹åº”ç¼“å­˜ã€‚</p>
<p>
å®ç°å…³é”®å‡½æ•°:</p>
<ul>
<li>
<p><a href="/vue/vue3-source-code-function-list/#codegen-gennode">genNode</a></p>
</li>
<li>
<p><a href="/vue/vue3-source-code-function-list/#codegen-gencacheexpression">genCacheExpression</a></p>
</li>
</ul>
</li>
</ol>
</div>
</div>
<div id="outline-container-pcg-vfor" class="outline-3">
<h3 id="pcg-vfor">
<span class="todo">TODO</span>
07 v-for æŒ‡ä»¤
</h3>
<div id="outline-text-pcg-vfor" class="outline-text-3">
<p>
è„‘å›¾ï¼š
<img src="/img/vue3/compiler-core/pcg/pcg-07-v-for.svg" alt="/img/vue3/compiler-core/pcg/pcg-07-v-for.svg" title="/img/vue3/compiler-core/pcg/pcg-07-v-for.svg" /></p>
<p>
è¿™é‡Œå°†ä¸‰ä¸ªé˜¶æ®µåˆå¹¶åœ¨ä¸€èµ·äº†ï¼Œ transform é˜¶æ®µçš„è§£æå•ç‹¬æ”¾åœ¨äº† <a href="#key-09-how-transform-vfor">9. transform é˜¶æ®µå¦‚
ä½•è½¬æ¢ v-for æŒ‡ä»¤ï¼Ÿ</a> è¿™éƒ¨åˆ†å’Œ v-if è§£æä¸€æ ·æ¯”è¾ƒå¤æ‚ï¼Œä¸”å±äºç‰¹å®šçš„æŒ‡ä»¤è§£æä½œä¸ºå…³é”®
åŠŸèƒ½è¿›è¡Œåˆ†æã€‚</p>
<p>
æ‰€ä»¥å¯¹äº transform é˜¶æ®µè¯¦ç»†å®ç°å’Œè„‘å›¾è¯·ç‚¹å‡»ä¸Šé¢é“¾æ¥æŸ¥çœ‹å†…å®¹ã€‚</p>
</div>
</div>
</div>
</div>
<div id="outline-container-mmh-key" class="outline-2">
<h2 id="mmh-key">
â˜€ å…³é”®åŠŸèƒ½
</h2>
<div id="outline-text-mmh-key" class="outline-text-2">
<p>
è¿™ä¸€ç« èŠ‚æ˜¯é’ˆå¯¹æ•´ä¸ª vue3 æºç è§£æ„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜æˆ–ä¸€äº›é‡è¦æˆ–å…³é”®çš„ä¸€äº›åŠŸèƒ½ï¼Œè¿›
è¡Œæå–è§£è¯»ã€‚</p>
<div id="outline-container-key-01-build-props" class="outline-3">
<h3 id="key-01-build-props">
<span class="todo">DONE</span>
1. buildProps(node, context) å¦‚ä½•æ„å»º props ?
</h3>
<div id="outline-text-key-01-build-props" class="outline-text-3">
<p>
CLOSED: [2020-09-18 Fri 16:07]</p>
<ul>
<li>
<p>State &#34;DONE&#34;       from &#34;TODO&#34;       [2020-09-18 Fri 16:07]</p>
</li>
</ul>
<p>
props åœ¨ compile é˜¶æ®µæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Œæ˜¯å¦‚ä½•ä»(<a href="#compiler-04">ç¤ºä¾‹04</a>)</p>
<p>
<img src="http://qiniu.ii6g.com/img/20200918160246.png" alt="http://qiniu.ii6g.com/img/20200918160246.png" title="http://qiniu.ii6g.com/img/20200918160246.png" /></p>
<p>
å˜æˆä¸‹é¢è¿™æ ·çš„ï¼š</p>
<p>
<img src="http://qiniu.ii6g.com/img/20200918160311.png" alt="http://qiniu.ii6g.com/img/20200918160311.png" title="http://qiniu.ii6g.com/img/20200918160311.png" /></p>
<p>
å®Œæ•´æµç¨‹ï¼š
<img src="/img/vue3/compiler-core/key/key-01-how-build-props.svg" alt="/img/vue3/compiler-core/key/key-01-how-build-props.svg" title="/img/vue3/compiler-core/key/key-01-how-build-props.svg" /></p>
</div>
</div>
<div id="outline-container-key-02-transform-if" class="outline-3">
<h3 id="key-02-transform-if">
<span class="todo">DONE</span>
2. transformIf() æ˜¯å¦‚ä½•è¿”å› v-if æŒ‡ä»¤çš„ transform çš„ï¼Ÿ
</h3>
<div id="outline-text-key-02-transform-if" class="outline-text-3">
<p>
å‚è€ƒ<a href="#compiler-05">ç”¨ä¾‹ 05</a></p>
<p>
v-if æŒ‡ä»¤æ˜¯å¦‚ä½•è½¬æ¢çš„ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>
è¿™ä¸ªè½¬æ¢å‡½æ•°åˆæ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>
å¾—åˆ°è¿™ä¸ªè½¬æ¢å‡½æ•°è¿‡ç¨‹ä¸­åšäº†ä»€ä¹ˆ ï¼Ÿï¼Ÿï¼Ÿ</p>
<blockquote>
<p>é€šè¿‡åœ¨ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-traversenode">traverseNode</a> ä¸­ï¼Œ switch node é˜¶æ®µä¹‹å‰ï¼Œæ”¶é›† transform å‡½æ•°åˆ° <code>exitFns[]</code>
ä¸­çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°äº† v-if æŒ‡ä»¤çš„å…ƒç´ ï¼Œä¼šæ‰§è¡Œ <code>transformIf</code> ï¼Œè¿™ä¸ªæ—¶å€™ä¼šéå†è§£æ
<code>node.props</code> æ‹¿åˆ°è¿™ä¸ª v-if æŒ‡ä»¤å±æ€§ï¼Œè°ƒç”¨ processIf å°†è¯¥èŠ‚ç‚¹è½¬æ¢æˆ</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">{</span>
    <span class="nx">branches</span><span class="o">:</span> <span class="p">[</span><span class="nx">branch</span><span class="p">],</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">9</span> <span class="c1">// IF
</span><span class="c1"></span>  <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å¹¶ä¸”ç”¨è¿™ä¸ªæ–°ç”Ÿæˆçš„èŠ‚ç‚¹ç»“æ„å»æ›¿æ¢åŸæ¥çš„ div v-if èŠ‚ç‚¹ç»“æ„ã€‚</p>
<p>
å³ï¼šåœ¨æ‹¿åˆ° transform if å‡½æ•°ä¹‹å‰ div v-if èŠ‚ç‚¹ç»“æ„å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆä¸ºäº†</p>
<p>
<code>type = 9</code> çš„ç»“æ„ï¼Œæœ€ååŸæ¥çš„èŠ‚ç‚¹æˆä¸ºäº† branches çš„å…ƒç´ ã€‚</p>
<p>
å¹¶ä¸”åŸèŠ‚ç‚¹çš„ props ä¼šè¢«æ¸…ç©º(é¿å…å›æº¯çš„æ—¶å€™é‡å¤å¤„ç†)ã€‚</p>
</blockquote>
<p>
transformIf:</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="kr">const</span> <span class="nx">transformIf</span> <span class="o">=</span> <span class="nx">createStructuralDirectiveTransform</span><span class="p">(</span>
    <span class="sr">/^(if|else|else-if)$/</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">processIf</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="p">(</span><span class="nx">ifNode</span><span class="p">,</span> <span class="nx">branch</span><span class="p">,</span> <span class="nx">isRoot</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Exit callback. Complete the codegenNode when all children have been
</span><span class="c1"></span>        <span class="c1">// transformed.
</span><span class="c1"></span>        <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// è¿™ä¸ªæ‰æ˜¯çœŸæ­£åœ¨å›æº¯è¿‡ç¨‹ä¸­è°ƒç”¨çš„ transform if å‡½æ•°
</span><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="nx">isRoot</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ifNode</span><span class="p">.</span><span class="nx">codegenNode</span> <span class="o">=</span> <span class="nx">createCodegenNodeForBranch</span><span class="p">(</span><span class="nx">branch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// attach this branch&#39;s codegen node to the v-if root.
</span><span class="c1"></span>            <span class="kd">let</span> <span class="nx">parentCondition</span> <span class="o">=</span> <span class="nx">ifNode</span><span class="p">.</span><span class="nx">codegenNode</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span>
              <span class="nx">parentCondition</span><span class="p">.</span><span class="nx">alternate</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span>
                <span class="mi">19</span> <span class="cm">/* JS_CONDITIONAL_EXPRESSION */</span>
            <span class="p">)</span> <span class="p">{</span>
              <span class="nx">parentCondition</span> <span class="o">=</span> <span class="nx">parentCondition</span><span class="p">.</span><span class="nx">alternate</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">parentCondition</span><span class="p">.</span><span class="nx">alternate</span> <span class="o">=</span> <span class="nx">createCodegenNodeForBranch</span><span class="p">(</span>
              <span class="nx">branch</span><span class="p">,</span>
              <span class="nx">ifNode</span><span class="p">.</span><span class="nx">branches</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
              <span class="nx">context</span>
            <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">};</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/key/key-02-transform-if.svg" alt="/img/vue3/compiler-core/key/key-02-transform-if.svg" title="/img/vue3/compiler-core/key/key-02-transform-if.svg" /></p>
</div>
</div>
<div id="outline-container-key-03-how-gen-props" class="outline-3">
<h3 id="key-03-how-gen-props">
<span class="todo">TODO</span>
3. codegen å¦‚ä½•ç”Ÿæˆå±æ€§(_createBLock(tag, props, â€¦))ç¬¬äºŒä¸ªå‚æ•°ï¼Ÿ
</h3>
<div id="outline-text-key-03-how-gen-props" class="outline-text-3">
<p>
å¦‚ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="c1">// ...
</span><span class="c1"></span>
  <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;foo&#34;</span><span class="p">,</span>
    <span class="kr">class</span><span class="o">:</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">baz</span>
  <span class="p">}))</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
id å’Œ class æ˜¯å¦‚ä½•ç”Ÿæˆå¯¹è±¡çš„ã€‚</p>
</div>
</div>
<div id="outline-container-headline-16" class="outline-3">
<h3 id="headline-16">
<span class="todo">DONE</span>
4. transform é˜¶æ®µå¦‚ä½•å¯¹å±æ€§é™æ€æå‡ï¼Ÿ
</h3>
<div id="outline-text-headline-16" class="outline-text-3">
<p>CLOSED: [2020-09-28 Mon 10:55]</p>
<ul>
<li>
<p>State &#34;DONE&#34;       from &#34;TODO&#34;       [2020-09-28 Mon 10:55]</p>
</li>
</ul>
<p>æ²¡æœ‰ hoist ä¹‹å‰ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">[</span>
    <span class="nx">ok</span>
      <span class="o">?</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="s2">&#34;yes&#34;</span><span class="p">))</span>
      <span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span><span class="p">(</span><span class="s2">&#34;v-if&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="p">]))</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æœ‰ hoist ä¹‹åï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">(</span><span class="kd">function</span> <span class="nx">anonymous</span><span class="p">(</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span>
    <span class="c1">// ... çœç•¥
</span><span class="c1"></span>
    <span class="c1">// æå‡åˆ° render å‡½æ•°ä¹‹å
</span><span class="c1"></span>    <span class="kr">const</span> <span class="mi">_</span><span class="nx">hoisted_1</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ... çœç•¥
</span><span class="c1"></span>        <span class="k">return</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">[</span>
          <span class="nx">ok</span>
            <span class="o">?</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_1</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">))</span>
            <span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span><span class="p">(</span><span class="s2">&#34;v-if&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
        <span class="p">]))</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<img src="/img/vue3/compiler-core/key/key-04-how-hoist-props.svg" alt="/img/vue3/compiler-core/key/key-04-how-hoist-props.svg" title="/img/vue3/compiler-core/key/key-04-how-hoist-props.svg" /></p>
<p>
<strong>transform</strong> é˜¶æ®µæ˜¯åœ¨ æ‰§è¡Œå®Œ <a href="vue/vue3-source-code-compiler-core-compile_ts/#transform-traversenode">traverseNode()</a> ä¹‹åè°ƒç”¨ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-hoiststatic">hoistStatic(root,context)</a> é€šè¿‡ walk() é€’å½’éå†
æ‰€æœ‰çš„å­©å­èŠ‚ç‚¹æ¥æ£€æµ‹æ»¡è¶³æ¡ä»¶çš„ hoist å±æ€§æˆ–èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>å³ï¼šé™æ€æå‡åŠ¨ä½œå‘ç”Ÿåœ¨æ‰€æœ‰èŠ‚ç‚¹çš„ codegenNode è§£æå®Œæ¯•ä¹‹å(ä¸”æ»¡è¶³ï¼š
<code>options.hoistStatic = true</code>)ã€‚</p>
</blockquote>
<p>
<strong>codegen</strong> é˜¶æ®µæ˜¯åœ¨ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#codegen-genfunctionpreamble">genFunctionPreamable(ast, context)</a> æ£€æµ‹ ast.hoists æ•°ç»„å°†éœ€è¦ç”¨
åˆ°çš„å‡½æ•°æå‡åˆ° render ä¹‹å¤–ï¼Œç„¶åè°ƒç”¨ <a href="/vue/vue3-source-code-compiler-core-compile_ts/#codegen-genhoists">genHoists(ast.hoists)</a> ç”Ÿæˆéœ€è¦æå‡çš„å±æ€§ã€‚</p>
<p>
æœ€åæ ¹æ®ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">node</span><span class="o">:</span>
  <span class="nx">content</span><span class="o">:</span> <span class="s2">&#34;_hoisted_1&#34;</span>
  <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">true</span>
  <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span>
  <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span> <span class="c1">// SIMPLE_EXPRESSION
</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æœ€åç”¨ <code>_hoisted_1</code> æ¥æ›¿ä»£ <code>{ key: 0 }</code> è¿™ä¸ªæƒŠå¤©å±æ€§ã€‚</p>
</div>
</div>
<div id="outline-container-headline-17" class="outline-3">
<h3 id="headline-17">
<span class="todo">DONE</span>
5. codegen å¦‚ä½•ç”Ÿæˆ if-elseif-else åˆ†æ”¯èŠ‚ç‚¹ ?
</h3>
<div id="outline-text-headline-17" class="outline-text-3">
<p>CLOSED: [2020-10-04 Sun 12:47]</p>
<ul>
<li>
<p>State &#34;DONE&#34;       from &#34;TODO&#34;       [2020-10-04 Sun 12:47]</p>
</li>
</ul>
<p><a href="#key-02-transform-if">ç”Ÿæˆåˆ†æ”¯å…¥å£å‡½æ•°äº§ç”Ÿè¿‡ç¨‹</a>ï¼š<a href="/vue/vue3-source-code-compiler-core-compile_ts/#transform-traversenode">traverseNode</a> ä¸­æ”¶é›† <code>exitFns</code> è¿‡ç¨‹ä¸­æ‰§è¡Œ <code>transformIf</code>
ç»è¿‡ä¸€äº›åˆ—æ“ä½œä¹‹åå¾—åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å½“å‰èŠ‚ç‚¹æ ‘é€’å½’ç»“æŸåè°ƒç”¨ï¼Œç”Ÿæˆ
<code>codegenNode</code></p>
<p>
è¿”å›çš„åˆ†æ”¯èŠ‚ç‚¹ codegenNode ç»“æ„ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="p">{</span>
    <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">19</span><span class="p">,</span>
    <span class="s2">&#34;test&#34;</span><span class="o">:</span><span class="p">{</span> <span class="c1">// ok ? ... : ...
</span><span class="c1"></span>      <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span>
      <span class="s2">&#34;content&#34;</span><span class="o">:</span><span class="s2">&#34;ok&#34;</span><span class="p">,</span>
      <span class="s2">&#34;isStatic&#34;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
      <span class="s2">&#34;isConstant&#34;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
      <span class="s2">&#34;loc&#34;</span><span class="o">:</span><span class="p">{</span>
        <span class="c1">// ...
</span><span class="c1"></span>        <span class="s2">&#34;source&#34;</span><span class="o">:</span><span class="s2">&#34;ok&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&#34;consequent&#34;</span><span class="o">:</span><span class="p">{</span> <span class="c1">// cond ? è¿™é‡Œçš„ä»£ç  : ...
</span><span class="c1"></span>      <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">13</span><span class="p">,</span>
      <span class="s2">&#34;tag&#34;</span><span class="o">:</span><span class="s2">&#34;&#34;</span><span class="nx">div</span><span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="s2">&#34;props&#34;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">15</span><span class="p">,</span>
        <span class="s2">&#34;loc&#34;</span><span class="o">:</span><span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">},</span>
        <span class="s2">&#34;properties&#34;</span><span class="o">:</span><span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">16</span><span class="p">,</span>
            <span class="s2">&#34;key&#34;</span><span class="o">:</span><span class="p">{</span>
              <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span>
              <span class="s2">&#34;isConstant&#34;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
              <span class="s2">&#34;content&#34;</span><span class="o">:</span><span class="s2">&#34;key&#34;</span><span class="p">,</span>
              <span class="s2">&#34;isStatic&#34;</span><span class="o">:</span><span class="kc">true</span>
            <span class="p">},</span>
            <span class="s2">&#34;value&#34;</span><span class="o">:</span><span class="p">{</span>
              <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span>
              <span class="s2">&#34;isConstant&#34;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
              <span class="s2">&#34;content&#34;</span><span class="o">:</span><span class="s2">&#34;0&#34;</span><span class="p">,</span>
              <span class="s2">&#34;isStatic&#34;</span><span class="o">:</span><span class="kc">false</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="s2">&#34;children&#34;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&#34;content&#34;</span><span class="o">:</span><span class="s2">&#34;yes&#34;</span><span class="p">,</span>
        <span class="s2">&#34;loc&#34;</span><span class="o">:</span><span class="p">{</span>
          <span class="s2">&#34;source&#34;</span><span class="o">:</span><span class="s2">&#34;yes&#34;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">&#34;isBlock&#34;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
      <span class="s2">&#34;isForBlock&#34;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
      <span class="s2">&#34;loc&#34;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&#34;source&#34;</span><span class="o">:</span><span class="s2">&#34;&lt;div v-if=&#34;</span><span class="nx">ok</span><span class="s2">&#34;&gt;yes&lt;/div&gt;&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&#34;alternate&#34;</span><span class="o">:</span><span class="p">{</span> <span class="c1">// cond ? ... : è¿™é‡Œçš„ä»£ç 
</span><span class="c1"></span>      <span class="s2">&#34;type&#34;</span><span class="o">:</span><span class="mi">14</span><span class="p">,</span>
      <span class="s2">&#34;loc&#34;</span><span class="o">:</span><span class="p">{</span>
        <span class="s2">&#34;source&#34;</span><span class="o">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="s2">&#34;arguments&#34;</span><span class="o">:</span><span class="p">[</span>
        <span class="s2">&#34;&#34;</span><span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="s2">&#34;true&#34;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&#34;newline&#34;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
  <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å¤„ç†æµç¨‹å›¾ï¼š</p>
<p>
<img src="/img/vue3/compiler-core/key/key-05-how-gen-if-branches.svg" alt="/img/vue3/compiler-core/key/key-05-how-gen-if-branches.svg" title="/img/vue3/compiler-core/key/key-05-how-gen-if-branches.svg" /></p>
</div>
</div>
<div id="outline-container-key-06-how-transform-v-else-if" class="outline-3">
<h3 id="key-06-how-transform-v-else-if">
<span class="todo">DONE</span>
6. transform é˜¶æ®µå¦‚ä½•è½¬æ¢ v-else-if æŒ‡ä»¤ï¼Ÿ
</h3>
<div id="outline-text-key-06-how-transform-v-else-if" class="outline-text-3">
<p>
ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="src src-html">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;ok&#34;</span><span class="p">&gt;</span>yes<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else-if</span><span class="o">=</span><span class="s">&#34;nok&#34;</span><span class="p">&gt;</span>nok<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span><span class="p">&gt;</span>no<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<img src="/img/vue3/compiler-core/key/key-02-transform-if.svg" alt="/img/vue3/compiler-core/key/key-02-transform-if.svg" title="/img/vue3/compiler-core/key/key-02-transform-if.svg" /></p>
</div>
</div>
<div id="outline-container-key-07-diff-block-vnode" class="outline-3">
<h3 id="key-07-diff-block-vnode">
<span class="todo">DONE</span>
7. ä»€ä¹ˆæ—¶å€™ç”¨ createVNode ä»€ä¹ˆæ—¶å€™ç”¨ createBlock ï¼Ÿ
</h3>
<div id="outline-text-key-07-diff-block-vnode" class="outline-text-3">
<p>
åˆ°ç›®å‰ä¸ºæ­¢å¤§éƒ¨åˆ†çš„å®ä¾‹éƒ½æ˜¯é€šè¿‡ block è§£æçš„ï¼Œå› ä¸ºå­©å­èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªã€‚</p>
<p>
å­©å­èŠ‚ç‚¹æœ‰å¤šä¸ªçš„æ—¶å€™ä¼šè¿›å…¥ VNode æµç¨‹ï¼Œè¿™é‡Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ¥å°†å¤šä¸ªå­©å­
åŒ…èµ·æ¥å»ç”Ÿæˆ render å‡½æ•°ã€‚</p>
<p>
è™šæ‹ŸèŠ‚ç‚¹åˆ›å»ºæœ‰è¿™ä¹ˆå‡ ä¸ªå‡½æ•°ï¼š <code>createVNode, createCommentVNode, createTextVNode</code>
è¿™äº›å‡½æ•°ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿå’Œ <code>openBlock, createBlock</code> åŒºåˆ«åœ¨å“ªï¼Ÿ</p>
<p>
å¯¹æ¯”ä¸¤ä¸ªç¤ºä¾‹ï¼š</p>
<p>
vnode ç‰ˆ v1:</p>
<div class="src src-html">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;foo&#34;</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;bar.baz&#34;</span><span class="p">&gt;</span>
    {{ world.burn() }}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;ok&#34;</span><span class="p">&gt;</span>yes<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
é vnode ç‰ˆ v2:</p>
<div class="src src-html">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;foo&#34;</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;bar.baz&#34;</span><span class="p">&gt;</span>
    {{ world.burn() }}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
åŒºåˆ«ï¼šæ’å€¼ <code>{{world.burn()}}</code> æœ‰ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ <code>&lt;div v-if=&#34;ok&#34;&gt;yes&lt;/div&gt;</code> æ­¤æ—¶æ’å€¼
èŠ‚ç‚¹çš„å¤„ç†ä¼šä¸ä¸€æ ·ï¼Œå…ˆçœ‹ç»“æœï¼š</p>
<ol>
<li>
<p>v1 ç»“æœ(<strong>è¿™ä¸ªç»“æœæ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜</strong>)ï¼š</p>
<p>
é—®é¢˜ï¼š <code>_createTextVNode(, 1 /* TEXT */)</code> è¿™é‡Œå°‘äº†ä¸ªå‚æ•°ï¼Œåº”è¯¥æ˜¯é‚£ä¸ªæ’å€¼è¡¨è¾¾å¼ã€‚</p>
<p>
è§£å†³æ–¹æ³•ï¼šåŠ ä¸Š <code>genNode: COMPOUND_EXPRESSION</code> åˆ†æ”¯å¤„ç†ã€‚</p>
<p>
å¤„ç†ä¹‹åï¼š <code>_createTextVNode(_toDisplayString(world.burn()) + &#34; &#34;, 1 /* TEXT */)</code></p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">;</span>
<span class="kr">const</span> <span class="p">{</span>
<span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span>
<span class="nx">createCommentVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span><span class="p">,</span>
<span class="nx">createTextVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createTextVNode</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span><span class="p">;</span>

<span class="kr">const</span> <span class="mi">_</span><span class="nx">hoisted_1</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>

<span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span>
        <span class="nx">toDisplayString</span><span class="o">:</span> <span class="mi">_</span><span class="nx">toDisplayString</span><span class="p">,</span>
        <span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span>
        <span class="nx">openBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">openBlock</span><span class="p">,</span>
        <span class="nx">createBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">,</span>
        <span class="nx">createCommentVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span><span class="p">,</span>
        <span class="nx">createTextVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createTextVNode</span><span class="p">,</span>
        <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">(</span>
        <span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span>
        <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span>
            <span class="s2">&#34;div&#34;</span><span class="p">,</span>
            <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;foo&#34;</span><span class="p">,</span>
            <span class="kr">class</span><span class="o">:</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">baz</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">[</span>
            <span class="mi">_</span><span class="nx">createTextVNode</span><span class="p">(,</span> <span class="mi">1</span> <span class="cm">/* TEXT */</span><span class="p">),</span>
            <span class="nx">ok</span>
                <span class="o">?</span> <span class="p">(</span><span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="mi">_</span><span class="nx">hoisted_1</span><span class="p">,</span> <span class="s2">&#34;yes&#34;</span><span class="p">))</span>
                <span class="o">:</span> <span class="mi">_</span><span class="nx">createCommentVNode</span><span class="p">(</span><span class="s2">&#34;v-if&#34;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="mi">2</span> <span class="cm">/* CLASS */</span>
        <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></td></tr></table>
</div>
</div>
</div>
</li>
<li>
<p>v2 ç»“æœï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="nx">anonymous</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="mi">_</span><span class="nx">Vue</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">;</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">,</span> <span class="mi">_</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">with</span> <span class="p">(</span><span class="mi">_</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span>
            <span class="nx">toDisplayString</span><span class="o">:</span> <span class="mi">_</span><span class="nx">toDisplayString</span><span class="p">,</span>
            <span class="nx">createVNode</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createVNode</span><span class="p">,</span>
            <span class="nx">openBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">openBlock</span><span class="p">,</span>
            <span class="nx">createBlock</span><span class="o">:</span> <span class="mi">_</span><span class="nx">createBlock</span><span class="p">,</span>
        <span class="p">}</span> <span class="o">=</span> <span class="mi">_</span><span class="nx">Vue</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="mi">_</span><span class="nx">openBlock</span><span class="p">(),</span>
            <span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span>
            <span class="s2">&#34;div&#34;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;foo&#34;</span><span class="p">,</span>
                <span class="kr">class</span><span class="o">:</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">baz</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="mi">_</span><span class="nx">toDisplayString</span><span class="p">(</span><span class="nx">world</span><span class="p">.</span><span class="nx">burn</span><span class="p">()),</span>
            <span class="mi">3</span> <span class="cm">/* TEXT, CLASS */</span>
            <span class="p">)</span>
        <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">});</span></code></pre></td></tr></table>
</div>
</div>
</div>
</li>
</ol>
<p>
è„‘å›¾ï¼š</p>
<p>
<img src="/img/vue3/compiler-core/key/key-07-diff-block-vnode.svg" alt="/img/vue3/compiler-core/key/key-07-diff-block-vnode.svg" title="/img/vue3/compiler-core/key/key-07-diff-block-vnode.svg" /></p>
</div>
</div>
<div id="outline-container-key-08-how-hoist-static" class="outline-3">
<h3 id="key-08-how-hoist-static">
<span class="todo">DONE</span>
8. transform é˜¶æ®µå¦‚ä½•åšé™æ€æå‡ï¼Ÿ
</h3>
<div id="outline-text-key-08-how-hoist-static" class="outline-text-3">
<p>
é™æ€æå‡æ£€æµ‹åœ¨ transform é˜¶æ®µï¼Œ traverseNode éå†å®Œ ast æ ‘ä¹‹åï¼Œä¼šè°ƒç”¨
<code>hoistStatic(root, context)</code> å¯¹æ‰€æœ‰ codegenNode è¿›è¡Œé€’å½’ï¼Œå°†éœ€è¦é™æ€æå‡çš„èŠ‚ç‚¹æå–
åˆ° root.hoists ä¸­ã€‚</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">createTransformContext</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="nx">traverseNode</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hoistStatic</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">hoistStatic</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
é™æ€æå‡æ¡ä»¶ï¼š</p>
<ol>
<li>
<p>æ ¹èŠ‚ç‚¹å¿…é¡»æœ‰ä¸€ä¸ªå­©å­ä»¥ä¸ŠèŠ‚ç‚¹ï¼Œä¸”æ‰€æœ‰å­å­™èŠ‚ç‚¹éƒ½å¿…é¡»æ˜¯é™æ€èŠ‚ç‚¹(<code>isStatic(child,
resultCache)</code>)</p>
</li>
<li>
<p>å¦‚æœèŠ‚ç‚¹æ˜¯åŠ¨æ€èŠ‚ç‚¹ï¼Œåˆ™æ£€æµ‹å…¶æ‰€æœ‰å±æ€§ï¼Œæå–å‡ºé™æ€å±æ€§å°†å…¶æå‡</p>
</li>
<li>
<p>æå‡ä¹‹åçš„å±æ€§æˆ–èŠ‚ç‚¹ä¼šä¿å­˜åˆ° <code>context.hoists</code> é‡Œé¢</p>
</li>
</ol>
<p>æºç è„‘å›¾ï¼š
<img src="/img/vue3/compiler-core/key/key-08-how-hoist-static.svg" alt="/img/vue3/compiler-core/key/key-08-how-hoist-static.svg" title="/img/vue3/compiler-core/key/key-08-how-hoist-static.svg" /></p>
</div>
</div>
<div id="outline-container-key-09-how-transform-vfor" class="outline-3">
<h3 id="key-09-how-transform-vfor">
<span class="todo">DONE</span>
9. transform é˜¶æ®µå¦‚ä½•è½¬æ¢ v-for æŒ‡ä»¤ï¼Ÿ
</h3>
<div id="outline-text-key-09-how-transform-vfor" class="outline-text-3">
<p>
è¿™é‡Œå’Œ <a href="#key-06-how-transform-v-else-if">transform å¦‚ä½•è½¬æ¢ v-else-if</a> ä¸€æ ·å¤æ‚ï¼Œè¿™é‡Œå°†å•ç‹¬è¿›è¡Œåˆ†æç»˜å‡ºå¯¹åº”è„‘å›¾ï¼Œç¤º
ä¾‹æ¥æºäº <a href="#pcg-vfor">v-for æŒ‡ä»¤</a> ä¸”ä¿æŒåŒæ­¥ã€‚</p>
<p>
<img src="/img/vue3/compiler-core/key/key-09-how-transform-vfor.svg" alt="/img/vue3/compiler-core/key/key-09-how-transform-vfor.svg" title="/img/vue3/compiler-core/key/key-09-how-transform-vfor.svg" /></p>
<p>
æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<div class="src src-html">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;list&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&#34;user in users&#34;</span><span class="p">&gt;</span>{{user.name}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>`</code></pre></td></tr></table>
</div>
</div>
</div>
<p>
transform é˜¶æ®µå‰å ast å¯¹æ¯”ï¼š</p>
<ol>
<li>
<p>transform ä¹‹å‰çš„ <code>&lt;li&gt;</code> ast:</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ast.children[0]/*&lt;ul&gt;*/.children[0]/*&lt;li&gt;*/
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">before</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">type</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;li&#39;</span><span class="p">,</span>
<span class="nx">props</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;for&#39;</span><span class="p">,</span>
    <span class="nx">exp</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;user in users&#39;</span><span class="p">,</span>
        <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">loc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">source</span><span class="o">:</span> <span class="s2">&#34;v-for=&#39;user in users&#39;&#34;</span> <span class="p">},</span>
    <span class="p">},</span>
<span class="p">],</span>
<span class="nx">isSelfClosing</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="nx">children</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nx">content</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;user.name&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">loc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">source</span><span class="o">:</span> <span class="s1">&#39;{{user.name}}&#39;</span> <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span></code></pre></td></tr></table>
</div>
</div>
</div>
</li>
<li>
<p>tranform ä¹‹åçš„ <code>&lt;li&gt;</code> ast:</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// ast.children[0]/*&lt;ul&gt;*/.children[0]/*&lt;li&gt;*/
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">after</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">type</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="c1">// FOR
</span><span class="c1"></span><span class="nx">source</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// æºæ•°æ®
</span><span class="c1"></span>    <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
    <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">},</span>
<span class="nx">valueAlias</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// è¿­ä»£è¿‡ç¨‹ä¸­çš„å€¼
</span><span class="c1"></span>    <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
    <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">},</span>
<span class="nx">parseResult</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">source</span><span class="o">:</span> <span class="s1">&#39;...&#39;</span> <span class="cm">/*å¯¹åº”å¤–é¢çš„source*/</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;...&#39;</span> <span class="cm">/*å¯¹åº”å¤–é¢çš„ valueAlias*/</span><span class="p">,</span>
<span class="p">},</span>
<span class="nx">children</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;li&#39;</span><span class="p">,</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">children</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
        <span class="c1">// {{user.name}}
</span><span class="c1"></span>        <span class="nx">type</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;user.name&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">],</span>
    <span class="nx">codegenNode</span><span class="o">:</span> <span class="p">{</span><span class="cm">/*...è§ li çš„ codegenNode */</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">],</span>
<span class="nx">codegenNode</span><span class="o">:</span> <span class="p">{</span><span class="cm">/*...*/</span><span class="p">},</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<ul>
<li>
<p><strong>type</strong>: 11, FOR ç±»å‹</p>
</li>
<li>
<p><strong>source</strong>: æ¸²æŸ“åˆ—è¡¨çš„æ•°æ®æ¥æºï¼Œè¿™é‡Œæ˜¯ <code>users</code></p>
</li>
<li>
<p><strong>valueAlias</strong>: æ¸²æŸ“åˆ—è¡¨é¡¹éœ€è¦çš„æ•°æ® <code>user</code></p>
</li>
</ul>
</li>
<li>
<p>transform ä¹‹åç”Ÿæˆçš„ <code>&lt;li&gt;</code> codegenNode:</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">node</span><span class="p">.</span><span class="nx">codegenNode</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">type</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="c1">// FOR
</span><span class="c1"></span><span class="nx">codegenNode</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="c1">// VNODE_CALL
</span><span class="c1"></span>    <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span> <span class="c1">// JS_CALL_EXPRESSION
</span><span class="c1"></span>    <span class="nx">arguments</span><span class="o">:</span> <span class="p">[</span> <span class="c1">// å°†ä½œä¸º callee: _renderList çš„å‚æ•°
</span><span class="c1"></span>        <span class="p">{</span> 
        <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
        <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="c1">// ç”¨æ¥ç”Ÿæˆå‡½æ•°çš„ (user) =&gt; { retrun `è§£æåçš„returns` }
</span><span class="c1"></span>        <span class="nx">type</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="c1">// JS_FUNCTION_EXPRESSION
</span><span class="c1"></span>        <span class="nx">params</span><span class="o">:</span> <span class="p">[</span> <span class="c1">// è¿™ä¸ªä½œä¸º _renderList ç¬¬äºŒä¸ªå‡½æ•°çš„å‚æ•°
</span><span class="c1"></span>            <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
            <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
        <span class="nx">returns</span><span class="o">:</span> <span class="p">{</span> <span class="c1">// _renderList ç¬¬äºŒä¸ªå‚æ•°å‡½æ•°çš„è¿”å›å€¼
</span><span class="c1"></span>            <span class="nx">type</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;&#34;li&#34;&#39;</span><span class="p">,</span>
            <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c1">// INTERPOLATION
</span><span class="c1"></span>            <span class="nx">content</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="nx">isStatic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nx">isConstant</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;user.name&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">},</span>
            <span class="nx">patchFlag</span><span class="o">:</span> <span class="s1">&#39;1 /* TEXT */&#39;</span><span class="p">,</span>
            <span class="nx">isBlock</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">disableTracking</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">newline</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// è¿™ä¸ªç»“åˆ body å†³å®šæ˜¯å¦æ˜¯ (user) =&gt; xx è¿˜æ˜¯ (user) =&gt; { return xxx }
</span><span class="c1"></span>        <span class="nx">isSlot</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">],</span>
    <span class="p">},</span>
    <span class="nx">patchFlag</span><span class="o">:</span> <span class="s1">&#39;256 /* UNKEYED_FRAGMENT */&#39;</span><span class="p">,</span>
    <span class="nx">isBlock</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">disableTracking</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">},</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
 <code>const children = codegenNode.children</code></p>
<ul>
<li>
<p><strong>children</strong>: ç”Ÿæˆ <code>_renderList(</code> å‡½æ•°</p>
<p>
<code>_renderList(</code></p>
</li>
<li>
<p><strong>children.arguments</strong>: ç”Ÿæˆ <code>_renderList(users, fn)</code> å‡½æ•°çš„
ä¸¤ä¸ªå‚æ•° <code>users</code> å’Œ <code>fn</code></p>
</li>
<li>
<p><strong>children.arguments[0]</strong>: å°†ç”Ÿæˆç¬¬ä¸€ä¸ªå‚æ•° users</p>
<p>
<code>_renderList(users,</code></p>
</li>
<li>
<p><strong>children.arguments[1]</strong>: å°†ç”Ÿæˆ fn å‡½æ•°</p>
<p>
<code>_renderList(users, fn</code></p>
</li>
<li>
<p><strong>children.arguments[1].type</strong>: 18ï¼Œè¡¨ç¤ºæ˜¯ <code>JS_FUNCTION_EXPRESSION</code> ç±»å‹ï¼Œç”¨
æ¥ç”Ÿæˆå‡½æ•°çš„</p>
</li>
<li>
<p><strong>children.arguments[1].params</strong>: ä½œä¸º fn å‡½æ•°çš„å‚æ•°</p>
<p>
<code>_renderList(users, (user) =&gt;</code></p>
</li>
<li>
<p><strong>children.arguments[1].returns</strong>: ä½œä¸º fnå‡½æ•°çš„è¿”å›å€¼</p>
<p>
<code>_renderList(users, (user) =&gt; { return (_openBlock(), _createBlock(&#34;li&#34;, null,
_toDisplayString(user.name), 1 /*TEXT*/)) })</code></p>
</li>
</ul>
</li>
</ol>
<p>ä»ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œ v-for æŒ‡ä»¤æœ€åä¼šè¢«æ›¿æ¢æˆä¸‹é¢çš„ç»“æ„ï¼š</p>
<p>
<code>{ type:11, valueAlias:/*è¿™é‡Œæ˜¯è¿­ä»£å½“å‰çš„æ•°æ® user */, source: /* è¿™é‡Œæ˜¯æ•°æ®æºï¼Œå¦‚ï¼šusers*/}</code></p>
<p>
ç”Ÿæˆçš„ li codegenNode ç»“æ„ï¼š</p>
<p>
<code>{type: 13, children: {/*...*/}}</code></p>
<p>
<code>renderList(users, (user)=&gt; {return xx})</code> æœ€ç»ˆç”± children å†…æ•°æ®å‘ˆç°ï¼š</p>
<p>
<code>{type: 14, arguments: [{...}, {...}]}</code></p>
<p>
arguments: </p>
<p>
<code>[{ type: 4, content: &#34;users&#34; }, { type: 18, params: {...} returns: {...} }}]</code></p>
<p>
ç¬¬äºŒä¸ªå‚æ•°æˆå‘˜è¡¨(ç”Ÿæˆï¼š <code>_renderList(users, fn)</code>)</p>
<table>
<thead>
<tr>
<th>memeber</th>
<th>type</th>
<th>value</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td>18,JS_FUNCTION_EXPRESSION</td>
<td>18</td>
<td>ç”Ÿæˆå‡½æ•° fn çš„ç±»å‹</td>
</tr>
<tr>
<td><code>params</code></td>
<td>4,SIMPLE_EXPRESSION</td>
<td><code>{type:4, content: &#34;user&#34;}</code></td>
<td>fn ç¬¬ä¸€ä¸ªå‚æ•° user, <code>(user) =&gt; xxx</code></td>
</tr>
<tr>
<td><code>returns</code></td>
<td>13,VNODECALL</td>
<td><code>{type:13, tag: &#34;\&#34;li\&#34;&#34;, ...}</code></td>
<td>fn å‡½æ•°çš„è¿”å›å€¼</td>
</tr>
<tr>
<td><code>body</code></td>
<td>-</td>
<td>-</td>
<td>fn çš„å‡½æ•°ä½“ï¼Œ <code>() =&gt; body</code>, å’Œ returns ç›¸å†²çªï¼ŒäºŒé€‰ä¸€ï¼Œä¸” returns ä¼˜å…ˆ</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="outline-container-mmh-cc-parser" class="outline-2">
<h2 id="mmh-cc-parser">
â˜ compiler-core: parser
</h2>
<div id="outline-text-mmh-cc-parser" class="outline-text-2">
<p>
vue3.0 çš„è§£æå™¨æ¨¡å—ï¼Œå°† html æ¨¡æ¿è§£ææˆ AST å¯¹è±¡ã€‚</p>
<div id="outline-container-map-parse-with-directive" class="outline-3">
<h3 id="map-parse-with-directive">
å¸¦æŒ‡ä»¤çš„æ ‡ç­¾è§£æå…¨è¿‡ç¨‹(<code>v-bind</code>)
</h3>
<div id="outline-text-map-parse-with-directive" class="outline-text-3">
<p>
ä»£ç ï¼š <code>baseParse(`&lt;div v-bind:keyup.enter.prevent=&#34;ok&#34;&gt;&lt;/div&gt;`)</code></p>
<ol>
<li>
<p>parseChildren â¡ï¸ while</p>
</li>
<li>
<p>parseElement â¬…ï¸ <code>&lt;div ....&gt;&lt;/div&gt;</code></p>
</li>
<li>
<p>parseTag â¡ï¸ <strong>node: div</strong> â¡ï¸ parseAttributes è§£æå±æ€§ â¬…ï¸ <code>v-bind:keyup...&gt;&lt;/div&gt;</code></p>
</li>
<li>
<p>parseAttribute â¡ï¸</p>
<ol>
<li>
<p>å…ˆè§£æ <code>=&#34;ok&#34;</code> å‡ºå€¼</p>
</li>
<li>
<p>åè§£æ <code>v-bind:keyup.enter.prevent</code></p>
</li>
</ol>
</li>
<li>
<p>æœ€åå¾—åˆ° <code>props[0] -&gt; { name: &#39;bind&#39;, arg: { content: &#39;keyup&#39;, ... }, exp:
{ content: &#39;ok&#39;, ... }, modifiers: [&#39;enter&#39;, &#39;prevent&#39; ]}</code></p>
<ol>
<li>
<p>name: æŒ‡ä»¤çš„åç§°ï¼Œ <code>v-bind, @</code> éƒ½ä¼šè½¬æˆ <strong>bind</strong> åç§°</p>
</li>
<li>
<p>arg: è¡¨ç¤ºæŒ‡ä»¤ç»‘å®šçš„å‚æ•°åç§°ï¼Œè¿™é‡Œå¯ä»¥æ˜¯åŠ¨æ€å˜é‡ï¼Œå¦‚ï¼š
<code>v-bind:[dynamicVarName]</code> ï¼Œç”± <code>arg.isConstant</code> æ ‡è¯†ã€‚</p>
</li>
<li>
<p>exp: è¡¨ç¤ºè¡¨è¾¾å¼çš„å€¼</p>
</li>
</ol>
</li>
</ol>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/parser-test-tag-with-directive-v-bind.png" alt="/img/vue3/compiler-core/parser-test-tag-with-directive-v-bind.png" title="/img/vue3/compiler-core/parser-test-tag-with-directive-v-bind.png" /></p>
</div>
</div>
<div id="outline-container-map-parse-simple-div" class="outline-3">
<h3 id="map-parse-simple-div">
æ ‡ç­¾è§£æ(<code>&lt;div&gt;hello world&lt;/div&gt;</code>)
</h3>
<div id="outline-text-map-parse-simple-div" class="outline-text-3">
<p>
ä»£ç ï¼š <code>baseParse(`&lt;div&gt;hello world&lt;/div&gt;`)</code></p>
<ol>
<li>
<p>parseChildren while å¼€å§‹è§£æ</p>
</li>
<li>
<p>é‡åˆ° <code>&lt;d</code> æ»¡è¶³ <code>/^[z-a]/i</code> è¿›å…¥ parseElement è§£ææ ‡ç­¾</p>
</li>
<li>
<p>parseElement -&gt; parseTag è§£æå‡ºåä¸º <strong>div</strong> çš„æ ‡ç­¾èŠ‚ç‚¹ï¼Œ <code>content = `hello world&lt;/div&gt;`</code></p>
</li>
<li>
<p>parseElement -&gt; parseChildren è§£æå‡º <strong>hello world</strong> æ–‡æœ¬èŠ‚ç‚¹ä½œä¸º div èŠ‚ç‚¹çš„
children[0]ï¼Œ <code>content = `&lt;/div&gt;`</code></p>
</li>
<li>
<p>è¿”å›åˆ° parseChildren è§£æ <code>&lt;/div&gt;</code> å‘ç° <code>ancestors</code> æœ‰å†…å®¹ä¸”æ‰¾åˆ°äº†
<code>&lt;/div&gt;</code> åŒ¹é…çš„ <code>&lt;div&gt;</code> èŠ‚ç‚¹ï¼Œæœ€åå®ŒæˆåŒ¹é…ã€‚</p>
</li>
</ol>
<p>
æµç¨‹å›¾ï¼š</p>
<p>
<img src="/img/vue3/compiler-core/parser-test-simple-tag-div.png" alt="/img/vue3/compiler-core/parser-test-simple-tag-div.png" title="/img/vue3/compiler-core/parser-test-simple-tag-div.png" /></p>
<div id="outline-container-map-parse-self-closing" class="outline-4">
<h4 id="map-parse-self-closing">
è‡ªé—­åˆæ ‡ç­¾(<code class="verbatim">&lt;img/&gt;</code>)çš„è§£æï¼Œä¹Ÿåœ¨ <a href="/vue/vue3-source-code-compiler-core/#parsetagcontext-type-parent">parseTag</a> é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªé’ˆå¯¹è¿™ä¸ªçš„å¤„ç†ï¼š
</h4>
<div id="outline-text-map-parse-self-closing" class="outline-text-4">
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
  <span class="c1">// è§£æåˆ°è¿™é‡Œçš„æ—¶å€™ content åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š`/&gt;xxx`
</span><span class="c1"></span>  <span class="nx">isSelfClosing</span> <span class="o">=</span> <span class="nx">startsWith</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="s1">&#39;/&gt;&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">TagType</span><span class="p">.</span><span class="nx">End</span> <span class="o">&amp;&amp;</span> <span class="nx">isSelfClosing</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å¦‚æœè‡ªé—­åˆæ²¡æœ‰å¼€å§‹æ ‡ç­¾ï¼Œæ˜¯éæ³•çš„
</span><span class="c1"></span>    <span class="nx">emitError</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">ErrorCodes</span><span class="p">.</span><span class="nx">END_TAG_WITH_TRAILING_SOLIDUS</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// è¿™é‡Œåˆ¤æ–­å¦‚æœæ˜¯è‡ªé—­åˆçš„ï¼Œé‚£ä¹ˆè¯¥æ ‡ç­¾çš„è§£æå°±å·²ç»ç»“æŸäº†
</span><span class="c1"></span>  <span class="nx">advanceBy</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">isSelfClosing</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-map-parse-void-tag" class="outline-4">
<h4 id="map-parse-void-tag">
ç©ºæ ‡ç­¾çš„å¤„ç†ï¼Œéœ€è¦åœ¨è°ƒç”¨è§£æå‡½æ•° <a href="/vue/vue3-source-code-compiler-core/#baseparsecontext-options">baseParse</a> çš„æ—¶å€™æ˜ç¡®å‘ŠçŸ¥å®ƒå“ªäº›æ˜¯ç©ºæ ‡ç­¾(å¦‚ï¼š <code>&lt;img&gt;</code>)ï¼š
</h4>
<div id="outline-text-map-parse-void-tag" class="outline-text-4">
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="kr">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">baseParse</span><span class="p">(</span><span class="s1">&#39;&lt;img&gt;after&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">isVoidTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;img&#39;</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<code>isVoidTag</code> ä¼šåœ¨ <a href="/vue/vue3-source-code-compiler-core/#parseelementcontext-mode">parseElement</a> çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œåœ¨è°ƒç”¨ <a href="/vue/vue3-source-code-compiler-core/#parsetagcontext-type-parent">parseTag</a> è§£æå®Œ
<strong>TagType.Start</strong> ä¹‹åæ£€æµ‹ï¼Œå¦‚æœæ˜¯ç©ºæ ‡ç­¾ç±»å‹ï¼Œä¼šç›´æ¥é€€å‡ºè§£æå³å®Œæˆè¯¥æ ‡ç­¾çš„è§£æ
è¿‡ç¨‹(å› ä¸ºæ˜¯ç©ºæ ‡ç­¾ï¼Œæ‰€ä»¥åé¢çš„å†…å®¹å°±ä¸å†å±äºå®ƒäº†ï¼Œå¯ä»¥ç»“æŸäº†)ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="c1">// è‡ªé—­åˆçš„åˆ°è¿™é‡Œå°±å¯ä»¥ç»“æŸäº†
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">isSelfClosing</span> <span class="o">||</span> <span class="nx">context</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">isVoidTag</span><span class="o">?</span><span class="p">.(</span><span class="nx">element</span><span class="p">.</span><span class="nx">tag</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">element</span><span class="p">;</span>
  <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-map-parse-template" class="outline-4">
<h4 id="map-parse-template">
æ¨¡æ¿æ ‡ç­¾çš„è§£æ(<code>&lt;template&gt;&lt;/template&gt;</code>)
</h4>
<div id="outline-text-map-parse-template" class="outline-text-4">
<p>
è¿™ä¸ªè§£æå’Œæ™®é€šæ ‡ç­¾åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯åœ¨ parseTag é‡Œé¢è§£æçš„æ—¶å€™æ›´æ–°ä¸‹ç±»å‹å°±å¯ä»¥äº†ï¼Œå¾ˆ
ç®€å•çš„æ“ä½œï¼š</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript">  <span class="kd">function</span> <span class="nx">parseTag</span><span class="p">(</span>
      <span class="nx">context</span>: <span class="kt">ParserContext</span><span class="p">,</span>
      <span class="kr">type</span><span class="o">:</span> <span class="nx">TagType</span><span class="p">,</span>
      <span class="nx">parent</span>: <span class="kt">ElementNode</span> <span class="o">|</span> <span class="kc">undefined</span>
  <span class="p">)</span><span class="o">:</span> <span class="nx">ElementNode</span> <span class="p">{</span>

      <span class="c1">// ...çœç•¥ï¼Œè¿™äº›éƒ½å¯ä»¥çœç•¥äº†ï¼Œå’Œæ™®é€šæ ‡ç­¾å¤„ç†ä¸€æ¨¡ä¸€æ ·
</span><span class="c1"></span>
      <span class="kd">let</span> <span class="nx">tagType</span> <span class="o">=</span> <span class="nx">ElementTypes</span><span class="p">.</span><span class="nx">ELEMENT</span>
      <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">options</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">context</span><span class="p">.</span><span class="nx">inVPre</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">isCustomElement</span><span class="p">(</span><span class="nx">tag</span><span class="p">))</span> <span class="p">{</span>
          <span class="c1">// ...çœç•¥ï¼Œvue å†…ç½®ç»„ä»¶ç±»å‹
</span><span class="c1"></span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;slot&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">tagType</span> <span class="o">=</span> <span class="nx">ElementTypes</span><span class="p">.</span><span class="nx">SLOT</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>
              <span class="c1">// æ‰€ä»¥è¿™é‡Œæ‰æ˜¯é‡ç‚¹ï¼Œä½œä¸ºæ¨¡æ¿æ ‡ç­¾å¿…é¡»æ»¡è¶³ä¸€å®šçš„æ¡ä»¶
</span><span class="c1"></span>              <span class="c1">// 1. å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå±æ€§ï¼Œä¸”ç±»å‹æ˜¯æŒ‡ä»¤
</span><span class="c1"></span>              <span class="c1">// 2. å¹¶ä¸”æ»¡è¶³ const isSpecialTemplateDirective = /*#__PURE__*/ makeMap(`if,else,else-if,for,slot`)
</span><span class="c1"></span>              <span class="c1">// å³è¯¥æŒ‡ä»¤å¿…é¡»æ˜¯ if, else, else-if, for, slotï¼Œä¹Ÿå°±æ˜¯è¯´æ¨¡æ¿å¿…é¡»ç”¨ä½œå¾ªç¯æˆ–æ’æ§½æ—¶ä½¿ç”¨
</span><span class="c1"></span>              <span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;template&#39;</span> <span class="o">&amp;&amp;</span>
                  <span class="nx">props</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="p">{</span>
                      <span class="k">return</span> <span class="p">(</span>
                          <span class="nx">p</span><span class="p">.</span><span class="kr">type</span> <span class="o">===</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">DIRECTIVE</span> <span class="o">&amp;&amp;</span> <span class="nx">isSpecialTemplateDirective</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
                      <span class="p">)</span>
                  <span class="p">})</span>
          <span class="p">)</span> <span class="p">{</span>
              <span class="nx">tagType</span> <span class="o">=</span> <span class="nx">ElementTypes</span><span class="p">.</span><span class="nx">TEMPLATE</span>
          <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="p">{</span>
          <span class="kr">type</span><span class="o">:</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">ELEMENT</span><span class="p">,</span>
          <span class="nx">ns</span><span class="p">,</span>
          <span class="nx">tag</span><span class="p">,</span>
          <span class="nx">tagType</span><span class="p">,</span>
          <span class="nx">props</span><span class="p">,</span>
          <span class="nx">isSelfClosing</span><span class="p">,</span>
          <span class="nx">children</span><span class="o">:</span> <span class="p">[],</span>
          <span class="nx">loc</span>: <span class="kt">getSelection</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">start</span><span class="p">),</span>
          <span class="nx">codegenNode</span>: <span class="kt">undefined</span> <span class="c1">// to be created during transform phase
</span><span class="c1"></span>      <span class="p">}</span>
  <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æ‰€ä»¥ä¸‹é¢è¿™ä¸¤ä¸ªç”¨ä¾‹å°±èƒ½å¾ˆå¥½çš„å¾—åˆ°è§£é‡Šäº†ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">test</span><span class="p">(</span><span class="s2">&#34;template element with directives&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">baseParse</span><span class="p">(</span><span class="s1">&#39;&lt;template v-if=&#34;ok&#34;&gt;&lt;/template&gt;&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">ELEMENT</span><span class="p">,</span>
      <span class="nx">tagType</span><span class="o">:</span> <span class="nx">ElementTypes</span><span class="p">.</span><span class="nx">TEMPLATE</span><span class="p">,</span> <span class="c1">// è¿™é‡Œæ˜¯æ¨¡æ¿ç±»å‹ï¼Œå› ä¸ºæœ‰ `v-if&#39; æŒ‡ä»¤
</span><span class="c1"></span>    <span class="p">});</span>
  <span class="p">});</span> <span class="c1">// template element with directives
</span><span class="c1"></span>
  <span class="nx">test</span><span class="p">(</span><span class="s2">&#34;template element without directives&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">baseParse</span><span class="p">(</span><span class="s2">&#34;&lt;template&gt;&lt;/template&gt;&#34;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">ELEMENT</span><span class="p">,</span>
      <span class="nx">tagType</span><span class="o">:</span> <span class="nx">ElementTypes</span><span class="p">.</span><span class="nx">ELEMENT</span><span class="p">,</span> <span class="c1">// è€Œè¿™é‡Œä¾æ—§æ˜¯å…ƒç´ ç±»å‹ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•æŒ‡ä»¤
</span><span class="c1"></span>    <span class="p">});</span>
  <span class="p">});</span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-map-parse-invalid-div" class="outline-3">
<h3 id="map-parse-invalid-div">
è§£ææ— æ•ˆçš„ <code>&lt;/div&gt;</code>
</h3>
<div id="outline-text-map-parse-invalid-div" class="outline-text-3">
<p>
ä»£ç ï¼š <code>baseParse(`&lt;/div&gt;`)</code></p>
<p>
ç»è¿‡çš„å‡½æ•°ï¼š</p>
<ol>
<li>
<p>parseChildren è¿›å…¥è§£æ while</p>
</li>
<li>
<p>parseText è§£æå‡ºæœ‰æ•ˆæ–‡æœ¬</p>
</li>
<li>
<p>å›åˆ° parseChildren while å¾ªç¯è§£æ <code>&lt;/div&gt;</code> æŠ¥é”™</p>
</li>
</ol>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/parser-test-invalid-end-tag.png" alt="/img/vue3/compiler-core/parser-test-invalid-end-tag.png" title="/img/vue3/compiler-core/parser-test-invalid-end-tag.png" /></p>
</div>
</div>
<div id="outline-container-map-parse-interpolation" class="outline-3">
<h3 id="map-parse-interpolation">
æ’å€¼è§£æ <code>some {{ foo + bar }} text</code>
</h3>
<div id="outline-text-map-parse-interpolation" class="outline-text-3">
<p>
ä»£ç ï¼š <code>baseParse(`some {{ foo + bar }} text`)</code></p>
<ol>
<li>
<p>parseChildren â¡ï¸ while: <code>some {{ foo + bar }} text</code></p>
</li>
<li>
<p>parseText â¡ï¸ node[0]: <code>`some`</code></p>
</li>
<li>
<p><code>{{ foo + bar }} text</code>  â¡ï¸  parseInterpolation  â¡ï¸
node[1]: <code>foor + bar</code></p>
</li>
<li>
<p><code>` text`</code> â¡ï¸ parseText â¡ï¸ node[2]: <code>`text`</code></p>
</li>
<li>
<p>nodes -&gt; root.children</p>
</li>
</ol>
<p>è§£æè¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š</p>
<ol>
<li>
<p>æ’å€¼è§£æï¼Œé¦–å…ˆæ˜¯åŒ¹é… `{{` ç„¶åå»çš„ <strong>}}</strong> çš„ç´¢å¼•ï¼Œæœ€åé€šè¿‡ <code>slice(startIdx,
endIdx)</code> å–åˆ°è¦è§£æçš„è¡¨è¾¾å¼ã€‚</p>
</li>
<li>
<p><code>`some`</code> å’Œ  <code>`text`</code> ä¸ä¼šåˆå¹¶åˆ°ä¸€ä¸ª node ä¸­ï¼Œå› ä¸ºä¸æ˜¯ç›¸é‚»çš„ï¼Œè¯·æ³¨æ„åˆå¹¶æ–‡
æœ¬ ndoe çš„å‰ææ¡ä»¶ï¼šå‰ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¿…é¡»æ˜¯æ–‡æœ¬èŠ‚ç‚¹ç±»å‹ã€‚</p>
</li>
</ol>
<p>æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/parser-test-text-with-interpolation.png" alt="/img/vue3/compiler-core/parser-test-text-with-interpolation.png" title="/img/vue3/compiler-core/parser-test-text-with-interpolation.png" /></p>
</div>
</div>
<div id="outline-container-map-parse-simple-text" class="outline-3">
<h3 id="map-parse-simple-text">
è§£æ <code>simple text</code>
</h3>
<div id="outline-text-map-parse-simple-text" class="outline-text-3">
<p>
è§£æçº¯æ–‡æœ¬ï¼Œåªä¼šè¿›å…¥ while å¾ªç¯ä¸­çš„ !node æ£€æµ‹ç„¶åè¿›å…¥ <code>parseText</code> çº¯æ–‡æœ¬è§£
æï¼Œä¼šåŒ¹é… <code>&lt;, {{, ]]&gt;</code> ä½œä¸ºçº¯æ–‡æœ¬çš„ç»“æŸæ ‡å¿—ã€‚</p>
<p>
å¾—åˆ°çº¯æ–‡æœ¬å†…å®¹åä¼ é€’ç»™ <code>parseTextData</code> æ›¿æ¢ <code>/&amp;(gt|lt|amp|apos|quot);/g</code>
html è¯­ä¹‰ç¬¦å·ä¹‹åè¿”å›ç»™ <code>parseText:content</code> ç»„ç»‡æ–‡æœ¬èŠ‚ç‚¹ç»“æ„è¿”å›ã€‚</p>
<p>
é€€å‡º while å¾ªç¯ï¼Œå°† node å¡åˆ° <code>root.children[]</code> é‡Œé¢ï¼Œä½œä¸ºæ ¹èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ã€‚</p>
<p>
ä»£ç ï¼š <code>baseParse(`simple text`)</code></p>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/parser-test-simple-text.png" alt="/img/vue3/compiler-core/parser-test-simple-text.png" title="/img/vue3/compiler-core/parser-test-simple-text.png" /></p>
</div>
</div>
</div>
</div>
<div id="outline-container-mmh-cc-compiler" class="outline-2">
<h2 id="mmh-cc-compiler">
ğŸŒ™ compiler-core: compiler
</h2>
<div id="outline-text-mmh-cc-compiler" class="outline-text-2">
<p>
vu3.0 ç¼–è¯‘å™¨æ¨¡å—ï¼Œå°† parser è§£æå¾—åˆ°çš„ AST å¯¹è±¡ç¼–è¯‘æˆå¯¹åº”çš„ render å‡½æ•°ã€‚</p>
<p>
è¯¥æ¨¡å—ä¸»è¦å®ç°çš„ä¸‰å¤§å—ï¼Œå› ä¸ºè¿™ä¸‰ä¸ªå…³è”æ€§å¾ˆå¼ºï¼Œå› æ­¤æ”¾åˆ°ä¸€å—äº†ã€‚</p>
<ol>
<li>
<p>compile.ts ç¼–è¯‘å™¨ä¸»æ¨¡å—</p>
</li>
<li>
<p>transform.ts å³ transforms/ ç›®å½•ï¼Œè¯­æ³•è½¬æ¢æ¨¡å—ï¼Œå…¥å£å‡½æ•°ï¼š transform()ï¼Œæ¯”å¦‚ï¼š
v-if æŒ‡ä»¤ï¼Œå‡½æ•°ï¼Œå˜é‡ç­‰</p>
</li>
<li>
<p>codegen.ts å…¥å£å‡½æ•°ï¼š generate() ï¼Œç”Ÿæˆä»£ç å­—ç¬¦ä¸²ï¼Œç”¨æ¥è°ƒç”¨ <code>new
Function(code)</code> ç”Ÿæˆ render å‡½æ•°ã€‚</p>
</li>
</ol>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/compiler.png" alt="/img/vue3/compiler-core/compiler.png" title="/img/vue3/compiler-core/compiler.png" /></p>
<div id="outline-container-compiler-01" class="outline-3">
<h3 id="compiler-01">
01-simple text ç¼–è¯‘è¿‡ç¨‹
</h3>
<div id="outline-text-compiler-01" class="outline-text-3">
<p>
ä»£ç ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">compile</span><span class="p">(</span><span class="sb">`simple text`</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="sb">`foo.vue`</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#test-text-01">01-simple-text æµ‹è¯•ç”¨ä¾‹åœ°å€</a></p>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/compiler-test-simple-text.png" alt="/img/vue3/compiler-core/compiler-test-simple-text.png" title="/img/vue3/compiler-core/compiler-test-simple-text.png" /></p>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#test-cc-01">è¯¦ç»†è¿‡ç¨‹åˆ†æè¯·ç‚¹å‡»é“¾æ¥ã€‚</a></p>
</div>
</div>
<div id="outline-container-compiler-02" class="outline-3">
<h3 id="compiler-02">
02-pure interpolation ç¼–è¯‘è¿‡ç¨‹
</h3>
<div id="outline-text-compiler-02" class="outline-text-3">
<p>
ä»£ç ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">compile</span><span class="p">(</span><span class="sb">`{{ world.burn() }}`</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="sb">`foo.vue`</span><span class="p">,</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#test-02-worldburn">02-pure-interpolation æµ‹è¯•ç”¨ä¾‹åœ°å€</a></p>
<p>
æµç¨‹å›¾ï¼š</p>
<p>
<img src="/img/vue3/compiler-core/compiler-test-pure-interpolation.png" alt="/img/vue3/compiler-core/compiler-test-pure-interpolation.png" title="/img/vue3/compiler-core/compiler-test-pure-interpolation.png" /></p>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#test-cc-02">è¯¦ç»†è¿‡ç¨‹åˆ†æè¯·ç‚¹å‡»é“¾æ¥ã€‚</a></p>
</div>
</div>
<div id="outline-container-compiler-03" class="outline-3">
<h3 id="compiler-03">
03-inerpolation in pure div
</h3>
<div id="outline-text-compiler-03" class="outline-text-3">
<p>
ä»£ç ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;div&gt;{{ world.burn() }}&lt;/div&gt;`</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="sb">`foo.vue`</span><span class="p">,</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#test-cc-03">ç”¨ä¾‹åœ°å€</a></p>
<p>
æµç¨‹å›¾ï¼š</p>
<p>
<img src="/img/vue3/compiler-core/compiler-test-interpolation-in-div.svg" alt="/img/vue3/compiler-core/compiler-test-interpolation-in-div.svg" title="/img/vue3/compiler-core/compiler-test-interpolation-in-div.svg" /></p>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#test-cc-03">è¯¦ç»†è¿‡ç¨‹åˆ†æè¯·ç‚¹å‡»é“¾æ¥ã€‚</a></p>
</div>
</div>
<div id="outline-container-compiler-04" class="outline-3">
<h3 id="compiler-04">
04-interpolation in div with props
</h3>
<div id="outline-text-compiler-04" class="outline-text-3">
<p>
ä»£ç ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;div id=&#34;foo&#34; :class=&#34;bar.baz&#34;&gt;{{ world.burn() }}&lt;/div&gt;`</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="sb">`foo.vue`</span><span class="p">,</span>
  <span class="p">})</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<a href="/vue/vue3-source-code-compiler-core-compile_ts/#test-cc-04">ç”¨ä¾‹åœ°å€</a></p>
<p>
æµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/compiler-test-interpolation-in-div-with-props.svg" alt="/img/vue3/compiler-core/compiler-test-interpolation-in-div-with-props.svg" title="/img/vue3/compiler-core/compiler-test-interpolation-in-div-with-props.svg" /></p>
</div>
</div>
<div id="outline-container-compiler-05" class="outline-3">
<h3 id="compiler-05">
05-interpolation, v-if, props
</h3>
<div id="outline-text-compiler-05" class="outline-text-3">
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">  <span class="nx">code</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">  &lt;div id=&#34;foo&#34; :class=&#34;bar.baz&#34;&gt;
</span><span class="sb">  {{ world.burn() }}
</span><span class="sb">  &lt;div v-if=&#34;ok&#34;&gt;yes&lt;/div&gt;
</span><span class="sb">  &lt;/div&gt;`</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å¦‚æœæ”¾åˆ°ä¸€å¼ å›¾é‡Œé¢ï¼Œå®åœ¨å¤ªç¹çäº†ï¼Œç®€åŒ–ï¼Œæ‹†åˆ†å¦‚ä¸‹ï¼š</p>
<p>
<img src="/img/vue3/compiler-core/compiler-test-05-div-with-vif.svg" alt="/img/vue3/compiler-core/compiler-test-05-div-with-vif.svg" title="/img/vue3/compiler-core/compiler-test-05-div-with-vif.svg" /></p>
<ol>
<li>
<p>æ•´ä½“æµç¨‹åŠå¯¼è‡´ç»“æœ</p>
</li>
<li>
<p>parse ast æµç¨‹</p>
</li>
<li>
<p>transform ast æµç¨‹ï¼Œè¿™éƒ¨åˆ†ä¼šæ¯”è¾ƒç¹ç</p>
</li>
<li>
<p>codegen generate æµç¨‹</p>
</li>
</ol>
<p>transform é˜¶æ®µæµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/lib/compiler-lib-04-transform.svg" alt="/img/vue3/compiler-core/lib/compiler-lib-04-transform.svg" title="/img/vue3/compiler-core/lib/compiler-lib-04-transform.svg" /></p>
<p>
generate é˜¶æ®µæµç¨‹å›¾ï¼š
<img src="/img/vue3/compiler-core/lib/compiler-lib-03-generate.svg" alt="/img/vue3/compiler-core/lib/compiler-lib-03-generate.svg" title="/img/vue3/compiler-core/lib/compiler-lib-03-generate.svg" /></p>
</div>
</div>
</div>
</div>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Zhicheng Lee</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2020-11-07
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/vue/">vue,</a>
          <a href="/tags/vue3/">vue3,</a>
          <a href="/tags/compiler-core/">compiler-core,</a>
          <a href="/tags/parser/">parser,</a>
          <a href="/tags/compiler/">compiler</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/vue/vue-mind-map-reactivity/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Vue3 æºç å¤´è„‘é£æš´ä¹‹ 1 â˜reactivity</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/vue/vue3-source-code-function-list/">
            <span class="next-text nav-default">Vue3 æ‰€æœ‰å‡½æ•°æºç å³ç®€è¦è¯´æ˜</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'zcheng';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><div id="lv-container" data-id="city" data-uid="MTAyMC81MTQwMC8yNzg4MQ==">
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
    <noscript>Please enable JavaScript to view the comments powered by <a href="https://livere.com/">LiveRe.</a></noscript>
    </div>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:gccll.love@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/6062239/simon" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/gccll_love" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/profile.php?id=100013995916088" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://github.com/gcclll" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/gccll" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://space.bilibili.com/384410681" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://www.cheng92.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡ </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> æœ¬ç«™æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> äºº </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2020 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>Zhicheng Lee</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
    docsearch({
    apiKey: "ac1e64640788e5697016a58be1ec7232",
    indexName: "cheng92.com",
    appId: "EDIKM3W4HV",
    inputSelector: '.docsearch-input',
    debug: false,
    });
</script>



<script type="text/javascript" src="/js/main.min.db4c43431f3833e1a48d3c8754f77c8250eedde3c20810a308f35779fdf8acd1.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-175986456-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>





<script src="/js/global.js"></script>


</body>
</html>
