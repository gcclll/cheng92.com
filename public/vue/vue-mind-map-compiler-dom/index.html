<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Vue3 æºç å¤´è„‘é£æš´ä¹‹ 4 â˜compiler-dom - è‹¥å¶çŸ¥ç§‹</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Zhicheng Lee" /><meta name="description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ stb-vue-next å®Œå…¨æ‹·è´äº vue-next ï¼Œä¸»è¦ç›®çš„ç”¨äºå­¦ä¹ ã€‚ å£°æ˜ ï¼švu" /><meta name="keywords" content="Vue, React, JavaScript, Python" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />




<meta name="generator" content="Hugo 0.83.1 with theme even" />


<link rel="canonical" href="https://www.cheng92.com/vue/vue-mind-map-compiler-dom/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.06b20cf21b1dff0a19c6a6fd2770439ed0c003d544ece3c4e1fbfb34fc217e45.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/global.css">


<meta property="og:title" content="Vue3 æºç å¤´è„‘é£æš´ä¹‹ 4 â˜compiler-dom" />
<meta property="og:description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ stb-vue-next å®Œå…¨æ‹·è´äº vue-next ï¼Œä¸»è¦ç›®çš„ç”¨äºå­¦ä¹ ã€‚ å£°æ˜ ï¼švu" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.cheng92.com/vue/vue-mind-map-compiler-dom/" /><meta property="article:section" content="vue" />
<meta property="article:published_time" content="2020-12-16T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-12-16T00:00:00&#43;00:00" />

<meta itemprop="name" content="Vue3 æºç å¤´è„‘é£æš´ä¹‹ 4 â˜compiler-dom">
<meta itemprop="description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ stb-vue-next å®Œå…¨æ‹·è´äº vue-next ï¼Œä¸»è¦ç›®çš„ç”¨äºå­¦ä¹ ã€‚ å£°æ˜ ï¼švu"><meta itemprop="datePublished" content="2020-12-16T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-12-16T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="5638">
<meta itemprop="keywords" content="vue,,vue3,,compiler-dom," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vue3 æºç å¤´è„‘é£æš´ä¹‹ 4 â˜compiler-dom"/>
<meta name="twitter:description" content="è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚ stb-vue-next å®Œå…¨æ‹·è´äº vue-next ï¼Œä¸»è¦ç›®çš„ç”¨äºå­¦ä¹ ã€‚ å£°æ˜ ï¼švu"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">è‹¥å¶çŸ¥ç§‹</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/emacs/">
        <li class="mobile-menu-item">Emacs</li>
      </a><a href="/algo/">
        <li class="mobile-menu-item">Algorithm</li>
      </a><a href="/web/">
        <li class="mobile-menu-item">Web</li>
      </a><a href="/vue/">
        <li class="mobile-menu-item">Vue</li>
      </a><a href="/react/">
        <li class="mobile-menu-item">React</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">è‹¥å¶çŸ¥ç§‹</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/emacs/">Emacs</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/algo/">Algorithm</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/web/">Web</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/vue/">Vue</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/react/">React</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li id="search">
        <img class="icon" src="/img/search.png"/>
        <input type="search" class="docsearch-input" placeholder="Search" style="display:none;" />
      </li></ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Vue3 æºç å¤´è„‘é£æš´ä¹‹ 4 â˜compiler-dom</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-12-16 </span>
        <div class="post-category">
            <a href="/categories/vue/"> vue </a>
            </div>
          <span class="more-meta"> çº¦ 5638 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 12 åˆ†é’Ÿ </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡é˜…è¯» </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#init">0062974 compiler-domæ¨¡å—åˆå§‹åŒ–</a>
</li>
<li><a href="#headline-2">4fa13bf init parse + compile function</a>
</li>
<li><a href="#headline-3">8c86624 add transformStyle node transform</a>
</li>
<li><a href="#headline-4">7ea8dfe add v-html transform</a>
</li>
<li><a href="#headline-5">4f3a4ee add v-text transform</a>
</li>
<li><a href="#headline-6">588d5f1 add v-model transform</a>
</li>
<li><a href="#v-on">a94aacd add v-on transform</a>
</li>
<li><a href="#headline-8">e64a1b3 add v-show transform</a>
</li>
<li><a href="#headline-9">436db72 add transition component warn transform</a>
</li>
<li><a href="#headline-10">af56754 add stringifyStatic node ç¯å¢ƒé™æ€æå‡</a>
</li>
<li><a href="#headline-11">f0cbb25 add ignoreSideEffectTags transform</a>
</li>
<li><a href="#headline-12">fd0f5ae add dom parserOptions and decode html</a>
</li>
<li><a href="#headline-13">ç”¨ä¾‹æµ‹è¯•(<code>&lt;f12&gt;</code> æŸ¥çœ‹æ§åˆ¶å°)ï¼š</a>
</li>
<li><a href="#headline-14">æ€»ç»“</a>
</li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      
<link href="https://fonts.goo~gleapis.com/cs~s2?family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
<kbd>
<font color="blue" size="3" style="font-family: 'ZCOOL XiaoWei', serif;">
  è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚
</font>
</kbd><br><br>
<p>
<img src="/img/bdx/yiyeshu-001.jpg" alt="/img/bdx/yiyeshu-001.jpg" title="/img/bdx/yiyeshu-001.jpg" /></p>
<p>
<kbd>
<strong><a href="https://github.com/gcclll/stb-vue-next">stb-vue-next</a> å®Œå…¨æ‹·è´äº <a href="https://github.com/vuejs/vue-next">vue-next</a> ï¼Œä¸»è¦ç›®çš„ç”¨äºå­¦ä¹ ã€‚</strong>
</kbd></p>
<blockquote>
<p><strong>å£°æ˜</strong> ï¼švue-next compiler-dom æ¨¡å—
<strong>è°ƒè¯•</strong> ï¼šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å¯é€šè¿‡ <code>&lt;F12&gt;</code> æ§åˆ¶å°æŸ¥çœ‹</p>
<p>
<strong>æ›´æ–°æ—¥å¿—&amp;Todos</strong> ï¼š</p>
<ol>
<li>
<p>[2020-12-16 19:40:21] åˆ›å»º</p>
</li>
<li>
<p>[2020-12-19 13:01:02] å®Œæˆ</p>
</li>
<li>
<p>TODO å®Œå–„æµ‹è¯•ç”¨ä¾‹</p>
</li>
</ol>
</blockquote>
<script src="/js/vue/compiler-dom.global.js"></script>
<script src="/js/utils.js"></script>
<script>
i = 0, j = 0
const { compile: compile2, parse } = VueCompilerDOM
const compile = (tpl, title, logAst = false) => {
    l2(title)
    const { code, ast } = compile2(tpl, {
        onError: (e) => console.warn(e.message),
        hoistStatic: true,
        ...( compile.options || {} )
    })

    log.gray(tpl)
    log([code])
    logAst && log(typeof logAst === 'function' ? logAst(ast) : ast)
    return ast
}
const c = (tpl, desc, fn) => compile(tpl, desc, fn || (ast => ast.codegenNode))
</script>
<div id="outline-container-init" class="outline-2">
<h2 id="init">
0062974 compiler-domæ¨¡å—åˆå§‹åŒ–
</h2>
<div id="outline-text-init" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/0062974d50531aa5e51f229968fd582d567a090c">feat(init): compiler-dom Â· gcclll/stb-vue-next@0062974</a></p>
<p>
æ—¥å¸¸æ“ä½œå…ˆ copyï¼šå…ˆå°† <em>vue-next/packages/compiler-dom/</em> ä¸‹é¢çš„å†…å®¹æ‹·è´è¿‡æ¥ï¼Œåˆ é™¤ src ç›®å½•ä¸‹çš„æ‰€æœ‰ä»£
ç ã€‚</p>
<p>
äº†è§£ç›®å½•ç»“æ„ï¼š</p>
<pre class="example">
â•°â”€$ tree -C -I &#39;dist|__tests__&#39;
.
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ api-extractor.json
â”œâ”€â”€ index.js
â”œâ”€â”€ package.json
â””â”€â”€ src
    â”œâ”€â”€ decodeHtml.ts
    â”œâ”€â”€ decodeHtmlBrowser.ts
    â”œâ”€â”€ errors.ts
    â”œâ”€â”€ index.ts
    â”œâ”€â”€ namedChars.json
    â”œâ”€â”€ parserOptions.ts
    â”œâ”€â”€ runtimeHelpers.ts
    â””â”€â”€ transforms
        â”œâ”€â”€ ignoreSideEffectTags.ts
        â”œâ”€â”€ stringifyStatic.ts
        â”œâ”€â”€ transformStyle.ts
        â”œâ”€â”€ vHtml.ts
        â”œâ”€â”€ vModel.ts
        â”œâ”€â”€ vOn.ts
        â”œâ”€â”€ vShow.ts
        â”œâ”€â”€ vText.ts
        â””â”€â”€ warnTransitionChildren.ts

2 directories, 21 files
</pre>
<p>
åŠŸèƒ½é¢„è§ˆï¼š</p>
<ol>
<li>
<p><code>ignoreSideEffectTags.ts</code> å¿½ç•¥æ¨¡æ¿ä¸­çš„ <code>style, script</code> æ ‡ç­¾</p>
</li>
<li>
<p><code>stringifyStatic.ts</code> å¯¹é™æ€æå‡åšçš„ä¸€äº›å¤„ç†</p>
</li>
<li>
<p><code>transformStyle.ts</code> å°†é™æ€ style å±æ€§è½¬æˆæŒ‡ä»¤ç±»å‹å±æ€§ï¼Œä¸”å°†å†…å®¹è½¬æˆå¯¹è±¡</p>
<p>
å¦‚ï¼š <code>&lt;div style=&#34;color:red&#34; /&gt;</code> ä¼šè½¬æˆï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">style</span><span class="o">:</span> <span class="p">{</span> <span class="nx">color</span><span class="o">:</span> <span class="s2">&#34;red&#34;</span> <span class="p">}</span>
<span class="p">},</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span> <span class="cm">/* TEXT */</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
</li>
<li>
<p><code>vHtml.ts</code> å°† v-html è¡¨è¾¾å¼è½¬æˆ <code>innerHTML</code> å†…å®¹</p>
</li>
<li>
<p><code>vModel.ts</code> å¤„ç† <code>&lt;input&gt;</code> ç±»å‹ï¼Œåˆ é™¤ <code>modelValue: value</code> å±æ€§ï¼Œä¸å…è®¸æœ‰å‚æ•°</p>
</li>
<li>
<p><code>vOn.ts</code>  äº‹ä»¶ä¿®é¥°ç¬¦å¤„ç†, è¯¦æƒ…è¯·æŸ¥<a href="#v-on">ç›¸å…³ç« èŠ‚ &gt;&gt;&gt;</a> </p>
<p>
åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>
<p>äº‹ä»¶é€‰é¡¹ä¿®é¥°ç¬¦ <code>passive, capture, once</code> ä¼šè¢«è§£æåˆ°äº‹ä»¶ååé¢</p>
<p>
å¦‚ï¼š <code>&lt;div @click.capture.once=&#34;i++&#34; /&gt;</code> ç»“æœï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="mi">_</span><span class="nx">createBlock</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="s1">&#39;onClickCaptureOnce&#39;</span><span class="o">:</span> <span class="nx">$event</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">},</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">40</span> <span class="cm">/* PROPS, HYDRATE_EVENTS */</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;onClickCaptureOnce&#34;</span><span class="p">])</span></code></pre></td></tr></table>
</div>
</div>
</div>
</li>
<li>
<p>é”®ç›˜ç±»äº‹ä»¶(<code>onkeydown,onkeyup,onkeypress</code>)ä¿®é¥°ç¬¦ ~~</p>
</li>
<li>
<p>ç³»ç»ŸæŒ‰é”®ç±»å‹ä¿®é¥°ç¬¦(<code>ctrl,alt,shift,meta,exact</code>)ï¼Œæ•è·å†’æ³¡(<code>stop,prevent,self</code>)ï¼Œé¼ 
æ ‡(<code>middle,left,right</code>)</p>
</li>
</ul>
</li>
<li>
<p><code>vShow.ts</code> é’ˆå¯¹ v-show æŒ‡ä»¤ï¼Œè¿™ä¸ªå¯èƒ½éœ€è¦åœ¨ runtime æœŸé—´å¤„ç†</p>
</li>
<li>
<p><code>vText.ts</code> v-text æŒ‡ä»¤çš„å¤„ç†ï¼Œå°†è¡¨è¾¾å¼å†…å®¹è§£ææˆ <code>textContent</code> å±æ€§å†…å®¹</p>
</li>
<li>
<p><code>warnTransitionChildren.ts</code> æ–‡ä»¶æ˜¯é’ˆå¯¹ <code>&lt;transition&gt;</code> å†…ç½®æ ‡ç­¾çš„æ£€æµ‹ï¼Œå®ƒçš„å­©
å­èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ª</p>
</li>
<li>
<p><code>decodeHtml[Browser].ts</code> æ˜¯ç”¨æ¥å¤„ç† html ç¬¦å·è¯­ä¹‰åŒ–çš„ï¼Œåˆ†åˆ«æ˜¯ NODE ç¯å¢ƒå’Œæµè§ˆå™¨ç¯
å¢ƒçš„å¤„ç†é€»è¾‘</p>
</li>
<li>
<p><code>parserOptions.ts</code> é’ˆå¯¹ compiler-core çš„é€‰é¡¹åšäº†è¿›ä¸€æ­¥æ‰©å±•(namespace, native
tag, decodeEntities ç­‰)</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
4fa13bf init parse + compile function
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/4fa13bfe57f414f158041122119096f3fb8a859d">feat(init): compiler-dom index.ts&gt; compile + parse function Â· gcclll/stb-vue-next@4fa13bf</a></p>
<p>
åˆå§‹åŒ–ç¼–è¯‘å’Œè§£æå‡½æ•°ï¼Œå¯¹åº”ç€ compile-core çš„ <code>baseCompile</code> å’Œ <code>baseParse</code> å‡½æ•°ã€‚</p>
<p>
å³ï¼š compiler-dom æ˜¯é’ˆå¯¹ compiler-core çš„è¿›ä¸€æ­¥å°è£…å¤„ç†ï¼Œä¼ é€’ä¸€äº› <code>transformXxx</code>
å‡½æ•°ï¼Œè‡³äºè¿™äº›å‡½æ•°åšäº†ä»€ä¹ˆå¤„ç†ï¼Œéœ€è¦ä¸‹é¢ä¸€æ­¥æ­¥æ¥æ­å¼€ã€‚</p>
<p>
compile :</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">compile</span><span class="p">(</span>
  <span class="nx">template</span>: <span class="kt">string</span><span class="p">,</span>
  <span class="nx">options</span>: <span class="kt">CompilerOptions</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">CodegenResult</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">baseCompile</span><span class="p">(</span>
    <span class="nx">template</span><span class="p">,</span>
    <span class="nx">extend</span><span class="p">({},</span> <span class="nx">parserOptions</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">nodeTransforms</span><span class="o">:</span> <span class="p">[],</span>
      <span class="nx">directiveTransforms</span>: <span class="kt">extend</span><span class="p">({}),</span>
      <span class="c1">// é™æ€æå‡ transform
</span><span class="c1"></span>      <span class="nx">transformHoist</span>: <span class="kt">__BROWSER__</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">stringifyStatic</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
parse:</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">parse</span><span class="p">(</span><span class="nx">template</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">options</span>: <span class="kt">ParserOptions</span> <span class="o">=</span> <span class="p">{})</span><span class="o">:</span> <span class="nx">RootNode</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">baseParse</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">extend</span><span class="p">({},</span> <span class="nx">parserOptions</span><span class="p">,</span> <span class="nx">options</span><span class="p">))</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å…¶å®åˆ°è¿™é‡Œä¹Ÿæ˜¯åº”è¯¥å¯ä»¥æ‰§è¡Œçš„ï¼Œæ¥æµ‹è¯•ä¸‹ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">ast</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;div&gt;{{ test }}&lt;/div&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="s1">&#39;\n&gt;&gt;&gt; AST: \n&#39;</span><span class="p">,</span> <span class="nx">ast</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { toDisplayString : _toDisplayString, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, null, _toDisplayString(test), 1 /* TEXT */))
  }
}
&gt;&gt;&gt; AST:
 {
  type: 0,
  children: [
    {
      type: 1,
      ns: 0,
      tag: &#39;div&#39;,
      tagType: 0,
      props: [],
      isSelfClosing: false,
      children: [Array],
      loc: [Object],
      codegenNode: [Object]
    }
  ],
  codegenNode: {
    type: 13,
    tag: &#39;&#34;div&#34;&#39;,
    props: undefined,
    children: { type: 5, content: [Object], loc: [Object] },
    patchFlag: &#39;1 /* TEXT */&#39;,
    dynamicProps: undefined,
    directives: undefined,
    isBlock: true,
    disableTracking: false,
    loc: { start: [Object], end: [Object], source: &#39;&lt;div&gt;{{ test }}&lt;/div&gt;&#39; }
  },
}
</pre>
<p>
æ¥ä¸‹æ¥æ‰æ˜¯è¿›å…¥æ­£é¢˜ â›³â€¦ğŸš„ğŸš„ğŸš„</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
8c86624 add transformStyle node transform
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/8c8662439d651e95f2036040e4d31f95dd52b836">feat: add transformStyle transform Â· gcclll/stb-vue-next@8c86624</a></p>
<p>
ä½œç”¨æ˜¯å°† <code>node.props</code> é‡Œé¢çš„ <code>style</code> å†…è”å±æ€§è½¬æˆå¯¹è±¡ç±»å‹ã€‚</p>
<p>
æ ¹æ®æ¡ä»¶ï¼Œè¿™é‡Œåªæ£€æµ‹é™æ€å±æ€§ï¼Œç„¶åå°†å…¶è½¬æˆ <code>v-bind</code> å‹çš„åŠ¨æ€å±æ€§ï¼Œå°†å†…è”è½¬æˆå¯¹è±¡ã€‚</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">transformStyle</span>: <span class="kt">NodeTransform</span> <span class="o">=</span> <span class="nx">node</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="kr">type</span> <span class="o">===</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">ELEMENT</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">p</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="kr">type</span> <span class="o">===</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">ATTRIBUTE</span> <span class="o">&amp;&amp;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;style&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// replace p with an expression node
</span><span class="c1"></span>        <span class="nx">node</span><span class="p">.</span><span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
          <span class="kr">type</span><span class="o">:</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">DIRECTIVE</span><span class="p">,</span>
          <span class="nx">name</span><span class="o">:</span> <span class="sb">`bind`</span><span class="p">,</span>
          <span class="nx">arg</span>: <span class="kt">createSimpleExpression</span><span class="p">(</span><span class="sb">`style`</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">loc</span><span class="p">),</span>
          <span class="nx">exp</span>: <span class="kt">parseInlineCSS</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">loc</span><span class="p">),</span>
          <span class="nx">modifiers</span><span class="o">:</span> <span class="p">[],</span>
          <span class="nx">loc</span>: <span class="kt">p.loc</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å†…è”è½¬å¯¹è±¡è§£æå‡½æ•°ï¼š <code>parseInlineCSS</code></p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">const</span> <span class="nx">parseInlineCSS</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">cssText</span>: <span class="kt">string</span><span class="p">,</span>
  <span class="nx">loc</span>: <span class="kt">SourceLocation</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">SimpleExpressionNode</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">normalized</span> <span class="o">=</span> <span class="nx">parseStringStyle</span><span class="p">(</span><span class="nx">cssText</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">createSimpleExpression</span><span class="p">(</span>
    <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">normalized</span><span class="p">),</span>
    <span class="kc">false</span><span class="p">,</span>
    <span class="nx">loc</span><span class="p">,</span>
    <span class="nx">ConstantTypes</span><span class="p">.</span><span class="nx">CAN_STRINGIFY</span>
  <span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
<code>parseStringStyle</code> å¤„ç†å…¶å®å°±æ˜¯ä»¥ <code>;</code> ä¸ºåˆ†éš”ç¬¦ï¼Œå°† <code>name:value</code> åˆ†å‰²å‡ºæ¥ï¼Œè§£æå‡º
<code>name</code> å’Œ <code>value</code> ç»„æˆå¯¹è±¡ã€‚</p>
<p>
æµ‹è¯•ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;div style=&#34;color:red;font-size:30px;&#34;&gt;{{ text }}&lt;/div&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { toDisplayString : _toDisplayString, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, { style: {&#34;color&#34;:&#34;red&#34;,&#34;font-size&#34;:&#34;30px&#34;} }, _toDisplayString(text), 1 /* TEXT */))
  }
}
undefined
</pre>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
7ea8dfe add v-html transform
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/7ea8dfe5c57ec712fe7f87d2fcce7320aa0f2560">feat: add transform v-html Â· gcclll/stb-vue-next@7ea8dfe</a></p>
<p>
v-html æŒ‡ä»¤è½¬æ¢ã€‚</p>
<p>
ä»£ç å¾ˆç®€å•ï¼š</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript">
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">transformVHtml</span>: <span class="kt">DirectiveTransform</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">exp</span><span class="p">,</span> <span class="nx">loc</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">dir</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exp</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span>
      <span class="nx">createDOMCompilerError</span><span class="p">(</span><span class="nx">DOMErrorCodes</span><span class="p">.</span><span class="nx">X_V_HTML_NO_EXPRESSION</span><span class="p">,</span> <span class="nx">loc</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span>
      <span class="nx">createDOMCompilerError</span><span class="p">(</span><span class="nx">DOMErrorCodes</span><span class="p">.</span><span class="nx">X_V_HTML_WITH_CHILDREN</span><span class="p">,</span> <span class="nx">loc</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">createObjectProperty</span><span class="p">(</span>
        <span class="nx">createSimpleExpression</span><span class="p">(</span><span class="sb">`innerHTML`</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">loc</span><span class="p">),</span>
        <span class="nx">exp</span> <span class="o">||</span> <span class="nx">createSimpleExpression</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
å…¶å®å°±æ˜¯é’ˆå¯¹ <code>v-html</code> å°†å…¶è½¬æˆ <code>innerHTML</code> åŠ¨æ€å±æ€§ï¼Œæ£€æµ‹ä¸¤ä¸ªä¸åˆæ³•ä½¿ç”¨æƒ…å†µ</p>
<ol>
<li>
<p>æ²¡æœ‰è¡¨è¾¾å¼</p>
</li>
<li>
<p>åŒ…å«å­©å­èŠ‚ç‚¹</p>
</li>
</ol>
<p>æµ‹è¯•ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="mi">_</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">tpl</span> <span class="p">=&gt;</span> <span class="nx">compile</span><span class="p">(</span><span class="nx">tpl</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onError</span><span class="o">:</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`é”™è¯¯æè¿°ï¼š`</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">code</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">_</span><span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;div v-html=&#34;test&#34;/&gt;`</span><span class="p">))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&gt;&gt;&gt; v-html ä¸‹ä¸èƒ½æœ‰ä»»ä½•å­©å­èŠ‚ç‚¹`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">_</span><span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;div v-html=&#34;test&#34;&gt;hello&lt;/div&gt;`</span><span class="p">))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&gt;&gt;&gt; v-html ä¸èƒ½æ²¡æœ‰è¡¨è¾¾å¼`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">_</span><span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;div v-html&gt;&lt;/div&gt;`</span><span class="p">))</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, { innerHTML: test }, null, 8 /* PROPS */, [&#34;innerHTML&#34;]))
  }
}
&gt;&gt;&gt; v-html ä¸‹ä¸èƒ½æœ‰ä»»ä½•å­©å­èŠ‚ç‚¹
é”™è¯¯æè¿°ï¼šv-html will override element children.
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, { innerHTML: test }, null, 8 /* PROPS */, [&#34;innerHTML&#34;]))
  }
}
&gt;&gt;&gt; v-html ä¸èƒ½æ²¡æœ‰è¡¨è¾¾å¼
é”™è¯¯æè¿°ï¼šv-html is missing expression.
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, { innerHTML: &#34;&#34; }))
  }
}
undefined
</pre>
<ol>
<li>
<p>è¿™é‡Œ v-html å±æ€§ä¼šè¢«è§£ææˆ <code>node.props</code> é‡Œé¢åŠ¨æ€å±æ€§ï¼Œå±æ€§åä¸º <code>innerHTML</code> ã€‚</p>
</li>
<li>
<p>å¦‚æœæœ‰ <code>v-html</code> æŒ‡ä»¤æ˜¯è¯¥ç»„ä»¶ä¸‹é¢å°±ä¸èƒ½æœ‰ä»»ä½•å­©å­èŠ‚ç‚¹</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
4f3a4ee add v-text transform
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/4f3a4eeec6394537b38587a47d3ac948155d1995">feat(add): v-text transform Â· gcclll/stb-vue-next@4f3a4ee</a></p>
<p>
v-text æŒ‡ä»¤è½¬æ¢å‡½æ•°ï¼Œè½¬æˆå±æ€§ä¸º <code>textContent</code> ã€‚</p>
<p>
ä»£ç :</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript">
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">transformVText</span>: <span class="kt">DirectiveTransform</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">exp</span><span class="p">,</span> <span class="nx">loc</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">dir</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exp</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span>
      <span class="nx">createDOMCompilerError</span><span class="p">(</span><span class="nx">DOMErrorCodes</span><span class="p">.</span><span class="nx">X_V_TEXT_NO_EXPRESSION</span><span class="p">,</span> <span class="nx">loc</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span>
      <span class="nx">createDOMCompilerError</span><span class="p">(</span><span class="nx">DOMErrorCodes</span><span class="p">.</span><span class="nx">X_V_TEXT_WITH_CHILDREN</span><span class="p">,</span> <span class="nx">loc</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">createObjectProperty</span><span class="p">(</span>
        <span class="nx">createSimpleExpression</span><span class="p">(</span><span class="sb">`textContent`</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
        <span class="nx">exp</span>
          <span class="o">?</span> <span class="nx">createCallExpression</span><span class="p">(</span>
              <span class="nx">context</span><span class="p">.</span><span class="nx">helperString</span><span class="p">(</span><span class="nx">TO_DISPLAY_STRING</span><span class="p">),</span>
              <span class="p">[</span><span class="nx">exp</span><span class="p">],</span>
              <span class="nx">loc</span>
            <span class="p">)</span>
          <span class="o">:</span> <span class="nx">createSimpleExpression</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æµ‹è¯•ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">tpl</span> <span class="p">=&gt;</span> <span class="nx">compile</span><span class="p">(</span><span class="nx">tpl</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">onError</span><span class="o">:</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`é”™è¯¯æè¿°: </span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">code</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;div v-text=&#34;test&#34;/&gt;`</span><span class="p">))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&gt;&gt;&gt; åŒ…å«å­©å­èŠ‚ç‚¹`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;div v-text=&#34;test&#34;&gt;hello&lt;/div&gt;`</span><span class="p">))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&gt;&gt;&gt; æ— è¡¨è¾¾å¼`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;div v-text&gt;&lt;/div&gt;`</span><span class="p">))</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { toDisplayString : _toDisplayString, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, {
      textContent: _toDisplayString(test)
    }, null, 8 /* PROPS */, [&#34;textContent&#34;]))
  }
}
&gt;&gt;&gt; åŒ…å«å­©å­èŠ‚ç‚¹
é”™è¯¯æè¿°: v-text will override element children.
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { toDisplayString : _toDisplayString, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, {
      textContent: _toDisplayString(test)
    }, null, 8 /* PROPS */, [&#34;textContent&#34;]))
  }
}
&gt;&gt;&gt; æ— è¡¨è¾¾å¼
é”™è¯¯æè¿°: v-text is missing expression.
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, { textContent: &#34;&#34; }))
  }
}
undefined
</pre>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
588d5f1 add v-model transform
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<p>
v-model æŒ‡ä»¤è½¬æ¢ã€‚</p>
<p>
åœ¨å®Œæˆ v-model æŒ‡ä»¤è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬çœ‹ä¸‹ compiler-core é‡Œé¢çš„ v-model å¤„ç†çš„æœ€åç»“
æœæ˜¯ä»€ä¹ˆâ“</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;input v-model:value=&#34;result&#34; /&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;input&#34;, {
      value: result,
      &#34;onUpdate:value&#34;: $event =&gt; (result = $event)
    }, null, 40 /* PROPS, HYDRATE_EVENTS */, [&#34;value&#34;,&#34;onUpdate:value&#34;]))
  }
}
undefined
</pre>
<p>
ç»“æœæ˜¾ç¤ºï¼šv-model æœ€ç»ˆè½¬æˆäº†ä¸¤ä¸ªå±æ€§</p>
<p>
<code>{ value: result, &#34;onUpdate:value&#34;: $event =&gt; (result = $event)}</code></p>
<p>
è¿™ä¸ªåŸç†åº”è¯¥æ˜¯è¿™æ ·ï¼š è¾“å…¥æ¡†å†…å®¹ç»‘å®š <code>result</code> ï¼Œå½“è¾“å…¥æ¡†å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘
<code>onUpdate:value</code> äº‹ä»¶ï¼Œæ‰§è¡Œè¯¥å‡½æ•°é‡æ–°å¤åˆ¶ <code>result</code> å˜æ›´æ•°æ®ã€‚ </p>
<p>
åŠ ä¸Š compiler-dom é˜¶æ®µçš„ v-model transform ä¹‹åï¼š
<a href="https://github.com/gcclll/stb-vue-next/commit/588d5f1d088ad48a71fa89a3070a1ad58666f431">feat(add): v-model transform Â· gcclll/stb-vue-next@588d5f1</a></p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;input v-model=&#34;result&#34; /&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { vModelText : _vModelText, createVNode : _createVNode, withDirectives : _withDirectives, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return _withDirectives((_openBlock(), _createBlock(&#34;input&#34;, {
      &#34;onUpdate:modelValue&#34;: $event =&gt; (result = $event)
    }, null, 8 /* PROPS */, [&#34;onUpdate:modelValue&#34;])), [
      [_vModelText, result]
    ])
  }
}
undefined
</pre>
<p>
å˜åŒ–ï¼š</p>
<ol>
<li>
<p>ä¸æ”¯æŒå‚æ•°äº†</p>
</li>
<li>
<p>åˆ é™¤äº† <code>value: result</code> å±æ€§(é»˜è®¤æ˜¯ <code>modelValue</code>)ã€‚</p>
</li>
<li>
<p>ç”¨ <code>_withDirectives</code> å°† <code>&lt;input&gt;</code> åŒ…èµ·æ¥äº†</p>
<p>
è¿™ä¸ªå‡½æ•°å®šä¹‰æ˜¯åœ¨ <code>runtime-core</code> é‡Œé¢å®šä¹‰äº†ï¼Œä½œç”¨å°±æ˜¯å°† ç¬¬äºŒä¸ªå‚æ•° <code>[
[_vModelText, result] ]</code> é‡Œé¢çš„æŒ‡ä»¤å¡åˆ° <code>vnode.dirs</code> æŒ‡ä»¤é›†ä¸­å»ã€‚</p>
</li>
</ol>
<p>
ä»£ç :</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript">
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">transformModel</span>: <span class="kt">DirectiveTransform</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">baseResult</span> <span class="o">=</span> <span class="nx">baseTransform</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span>
  <span class="c1">// base transform has errors OR component v-model (only need props)
</span><span class="c1"></span>  <span class="c1">// æ²¡æœ‰ v-modelæŒ‡ä»¤ï¼Œæˆ–åº”ç”¨åœ¨ç”¨æˆ·ç»„ä»¶ä¸Šäº†
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">baseResult</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tagType</span> <span class="o">===</span> <span class="nx">ElementTypes</span><span class="p">.</span><span class="nx">COMPONENT</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">baseResult</span>
  <span class="p">}</span>

  <span class="c1">// ä¸èƒ½æœ‰å‚æ•°ï¼Ÿ
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">dir</span><span class="p">.</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ... æŠ¥é”™ï¼Œä¸èƒ½æœ‰å‚æ•°ï¼Œå³å¿…é¡»æ˜¯ ~v-model=&#34;xxx&#34;~ æ¥ä½¿ç”¨
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="c1">// ä¸èƒ½æœ‰ value å±æ€§ï¼Œå› ä¸º input ç»‘å®šçš„å°±æ˜¯ value å±æ€§
</span><span class="c1"></span>  <span class="kd">function</span> <span class="nx">checkDuplicateValue() {</span>
    <span class="c1">// ... è¿™é‡Œæ—¢æ˜¯æ£€æµ‹æ˜¯ä¸æ˜¯æœ‰ &lt;input value=&#34;xx&#34;&gt; value å±æ€§
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="kr">const</span> <span class="p">{</span> <span class="nx">tag</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">node</span>
  <span class="kr">const</span> <span class="nx">isCustomElement</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">isCustomElement</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span>
    <span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;input&#39;</span> <span class="o">||</span>
    <span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;textarea&#39;</span> <span class="o">||</span>
    <span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;select&#39;</span> <span class="o">||</span>
    <span class="nx">isCustomElement</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">directiveToUse</span> <span class="o">=</span> <span class="nx">V_MODEL_TEXT</span>
    <span class="kd">let</span> <span class="nx">isInvalidType</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;input&#39;</span> <span class="o">||</span> <span class="nx">isCustomElement</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="kr">type</span> <span class="o">=</span> <span class="nx">findProp</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="sb">`type`</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="kr">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="kr">type</span><span class="p">.</span><span class="kr">type</span> <span class="o">===</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">DIRECTIVE</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// :type=&#39;foo&#39;
</span><span class="c1"></span>          <span class="nx">directiveToUse</span> <span class="o">=</span> <span class="nx">V_MODEL_DYNAMIC</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kr">type</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">switch</span> <span class="p">(</span><span class="kr">type</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;radio&#39;</span><span class="o">:</span>
              <span class="nx">directiveToUse</span> <span class="o">=</span> <span class="nx">V_MODEL_RADIO</span>
              <span class="k">break</span>
            <span class="k">case</span> <span class="s1">&#39;checkbox&#39;</span><span class="o">:</span>
              <span class="nx">directiveToUse</span> <span class="o">=</span> <span class="nx">V_MODEL_CHECKBOX</span>
              <span class="k">break</span>
            <span class="k">case</span> <span class="s1">&#39;file&#39;</span><span class="o">:</span>
              <span class="nx">isInvalidType</span> <span class="o">=</span> <span class="kc">true</span>
              <span class="c1">// ERROR ä¸èƒ½ç”¨åœ¨ &lt;file&gt; æ ‡ç­¾ä¸Š
</span><span class="c1"></span>              <span class="k">break</span>
            <span class="k">default</span><span class="o">:</span>
              <span class="nx">__DEV__</span> <span class="o">&amp;&amp;</span> <span class="nx">checkDuplicateValue</span><span class="p">()</span>
              <span class="k">break</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">hasDynamicKeyVBind</span><span class="p">(</span><span class="nx">node</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// element has bindings with dynamic keys, which can possibly contain
</span><span class="c1"></span>        <span class="c1">// &#34;type&#34;.
</span><span class="c1"></span>        <span class="nx">directiveToUse</span> <span class="o">=</span> <span class="nx">V_MODEL_DYNAMIC</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// text type
</span><span class="c1"></span>        <span class="nx">__DEV__</span> <span class="o">&amp;&amp;</span> <span class="nx">checkDuplicateValue</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;select&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">directiveToUse</span> <span class="o">=</span> <span class="nx">V_MODEL_SELECT</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// textarea
</span><span class="c1"></span>      <span class="nx">__DEV__</span> <span class="o">&amp;&amp;</span> <span class="nx">checkDuplicateValue</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// inject runtime directive
</span><span class="c1"></span>    <span class="c1">// by returning the helper symbol via needRuntime
</span><span class="c1"></span>    <span class="c1">// the import will replaced a resolveDirective call.
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isInvalidType</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">baseResult</span><span class="p">.</span><span class="nx">needRuntime</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">helper</span><span class="p">(</span><span class="nx">directiveToUse</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// v-model åº”ç”¨åˆ°ä¸åˆæ³•çš„å…ƒç´ ä¸Š
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="c1">// native vmodel doesn&#39;t need the `modelValue` props since they are also
</span><span class="c1"></span>  <span class="c1">// passed to the runtime as `binding.value`. removing it reduces code size.
</span><span class="c1"></span>  <span class="c1">// æœ€åè¿‡æ»¤æ‰ modelValue: xxx å±æ€§
</span><span class="c1"></span>  <span class="nx">baseResult</span><span class="p">.</span><span class="nx">props</span> <span class="o">=</span> <span class="nx">baseResult</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
    <span class="nx">p</span> <span class="o">=&gt;</span>
      <span class="o">!</span><span class="p">(</span>
        <span class="nx">p</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="kr">type</span> <span class="o">===</span> <span class="nx">NodeTypes</span><span class="p">.</span><span class="nx">SIMPLE_EXPRESSION</span> <span class="o">&amp;&amp;</span>
        <span class="nx">p</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">content</span> <span class="o">===</span> <span class="s1">&#39;modelValue&#39;</span>
      <span class="p">)</span>
  <span class="p">)</span>
  <span class="k">return</span> <span class="nx">baseResult</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æºç åˆ†æï¼š</p>
<ol>
<li>
<p>åªå¤„ç† <code>input, textarea, select</code> æ–‡æœ¬æ¡†æ ‡ç­¾ï¼Œæˆ–è‡ªå®šä¹‰çš„æ ‡ç­¾</p>
</li>
<li>
<p><code>&lt;input&gt;</code> æ ‡ç­¾ç±»å‹åˆ†ä¸º <code>radio</code> å’Œ <code>checkbox</code> å•å¤é€‰é¡¹æ¡†å¤„ç†ï¼Œä¸èƒ½ä½¿ç”¨
<code>type=&#39;file&#39;</code> ç±»å‹</p>
</li>
<li>
<p><code>&lt;select&gt;</code> ä¸‹æ‹‰é€‰é¡¹æ¡†çš„å¤„ç†</p>
</li>
<li>
<p>è¿‡æ»¤æ‰ transform ä¹‹åçš„ <code>{modelValue: value, &#39;onUpdate:value&#39;: $event =&gt;
value = $event}</code> é‡Œé¢çš„ <code>modelValueï¼švalue</code> å±æ€§ï¼Œå› ä¸ºåœ¨ runtime-core æ—¶æœŸçš„
<code>withDirectives()</code> å¤„ç†é‡Œé¢ä¼šè¢«ç»‘å®šåˆ° <code>value</code> å±æ€§ä¸Š</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-v-on" class="outline-2">
<h2 id="v-on">
a94aacd add v-on transform
</h2>
<div id="outline-text-v-on" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/a94aacdb3983e06b11476394b9413310e827aab5">feat(add): v-on transform Â· gcclll/stb-vue-next@a94aacd</a></p>
<p>
compiler-core é˜¶æ®µï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">ast</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;div v-on:keyup.enter.prevent=&#34;pressKeyup&#34; /&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">codegenNode</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, { onKeyup: pressKeyup }, null, 40 /* PROPS, HYDRATE_EVENTS */, [&#34;onKeyup&#34;]))
  }
}
[
  {
    type: 16,
    loc: { source: &#39;&#39;, start: [Object], end: [Object] },
    key: {
      type: 4,
      loc: [Object],
      content: &#39;onKeyup&#39;,
      isStatic: true,
      constType: 3
    },
    value: {
      type: 4,
      content: &#39;pressKeyup&#39;,
      isStatic: false,
      constType: 0,
      loc: [Object]
    }
  }
]
undefined
</pre>
<p>
å¯ä»¥çœ‹åˆ° compile-core é˜¶æ®µæ˜¯æ²¡æœ‰å¤„ç†ä¿®é¥°ç¬¦çš„ã€‚</p>
<p>
v-on æŒ‡ä»¤æœ€åè§£ææˆ <code>{ key, value, type: 16 }</code> ç»“æ„ã€‚</p>
<p>
compiler-dom v-on å¤„ç†é€»è¾‘ï¼š</p>
<ol>
<li>
<p><code>resolveModifiers(key, modifiers)</code> è§£æå‡ºä¸‰ç±»ä¿®é¥°ç¬¦</p>
<ul>
<li>
<p><code>keyModifiers</code> ä¿®é¥°ç¬¦</p>
<p>
 é”®ç›˜äº‹ä»¶ï¼š <code>onkeyup, onkeydown, onkeypress</code></p>
</li>
<li>
<p><code>eventOptionModifiers</code> äº‹ä»¶é€‰é¡¹ä¿®é¥°ç¬¦ï¼Œåªæœ‰ä¸‰ç§ <code>passive, once, capture</code></p>
</li>
<li>
<p><code>nonKeyModifiers</code> éæŒ‰é”®ç±»ä¿®é¥°ç¬¦</p>
<p>
 äº‹ä»¶å†’æ³¡ç®¡ç†ï¼š <code>stop,prevent,self</code></p>
<p>
 ç³»ç»Ÿä¿®é¥°ç¬¦+exact: <code>ctrl,shift,alt,meta,exact</code> , exact è¡¨ç¤ºç²¾ç¡®åŒ¹é…æŒ‰é”®ã€‚</p>
<p>
 é¼ æ ‡æŒ‰é”®ä¿®é¥°ç¬¦ï¼š <code>middle</code></p>
</li>
</ul>
</li>
<li>
<p>ç»è¿‡ 1 ä¹‹åå¾—å‡ºä¸‰ç§ç±»å‹çš„ä¿®é¥°ç¬¦ï¼Œå¤„ç†å…¶ä¸­çš„ <code>nonKeyModifiers</code></p>
<p>
å°†è¿™ç§ç±»å‹çš„ä¿®é¥°ç¬¦ä¸­çš„ <code>right, middle</code> è½¬æ¢æˆå¯¹åº”çš„ <code>onContextmenu</code> å’Œ
<code>onMouseup</code> äº‹ä»¶</p>
<p>
å³ï¼š</p>
<p>
å¦‚æœæœ‰ <code>right</code> ç‚¹å‡»äº‹ä»¶ä¼šè§¦å‘ <code>onContextmenu</code> äº‹ä»¶ï¼Œå¼¹å‡ºå³é”®èœå•ï¼Ÿ</p>
<p>
å¦‚æœæœ‰ <code>middle</code> é¼ æ ‡ä¸­é—´æ»šè½®äº‹ä»¶ï¼Œä¼šè§¦å‘ <code>onMouseup</code> é¼ æ ‡å¼¹èµ·äº‹ä»¶</p>
<p>
æœ€åå°† <code>nonKeyModifiers</code> ç»“åˆ <code>value</code> åˆ›å»ºæˆå‡½æ•°è¡¨è¾¾å¼ã€‚</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
<span class="nx">parse</span><span class="p">,</span>
<span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span><span class="nx">code</span><span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span>
<span class="sb">`&lt;div @click.right=&#34;testRight&#34;
</span><span class="sb">     @click.middle=&#34;testMiddle&#34;
</span><span class="sb">     @click.left=&#34;testLeft&#34; /&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&gt;&gt;&gt; right ä¿®é¥°ç¬¦è¢«å½“åš onContextmenu äº‹ä»¶å¤„ç†, middle -&gt; onMouseup`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
&gt;&gt;&gt; right ä¿®é¥°ç¬¦è¢«å½“åš onContextmenu äº‹ä»¶å¤„ç†, middle -&gt; onMouseup
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { withModifiers : _withModifiers, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, {
      onContextmenu: _withModifiers(testRight, [&#34;right&#34;]),
      onMouseup: _withModifiers(testMiddle, [&#34;middle&#34;]),
      onClick: _withModifiers(testLeft, [&#34;left&#34;])
    }, null, 40 /* PROPS, HYDRATE_EVENTS */, [&#34;onContextmenu&#34;,&#34;onMouseup&#34;,&#34;onClick&#34;]))
  }
}
undefined
</pre>
</li>
<li>
<p>å¤„ç† <code>keyModifiers</code> ï¼Œå¦‚ï¼šé”®ç›˜äº‹ä»¶ä¿®é¥°ç¬¦ï¼Œç³»ç»Ÿä¿®é¥°ç¬¦ç­‰ç­‰</p>
<p>
æ¯”å¦‚ï¼šé”®ç›˜ <code>ctrl-a</code> ç»„åˆé”®</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
<span class="nx">parse</span><span class="p">,</span>
<span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`
</span><span class="sb">&lt;div @keydown.stop.capture.ctrl.a=&#34;test&#34; /&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { withModifiers : _withModifiers, withKeys : _withKeys, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, {
      onKeydownCapture: _withKeys(_withModifiers(test, [&#34;stop&#34;,&#34;ctrl&#34;]), [&#34;a&#34;])
    }, null, 40 /* PROPS, HYDRATE_EVENTS */, [&#34;onKeydownCapture&#34;]))
  }
}
undefined
</pre>
</li>
<li>
<p>å¤„ç† <code>eventOptionModifiers</code> ç»“åˆ <code>key</code> ç”Ÿæˆå¯¹åº”çš„äº‹ä»¶åè¡¨è¾¾å¼</p>
<p>
äº‹ä»¶é€‰é¡¹ä¿®é¥°ç¬¦åªæœ‰ä¸‰ä¸ªï¼š <code>capture,passive,once</code></p>
<p>
passive: <a href="https://segmentfault.com/a/1190000017247263">passiveçš„ä½œç”¨å’ŒåŸç†_ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦</a></p>
<p>
<a href="/post/javascript-docs/#event-cap-bub">capture</a>: <a href="https://blog.techbridge.cc/2017/07/15/javascript-event-propagation/">DOM çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ï¼šæ•ç²èˆ‡å†’æ³¡</a></p>
<p>
è§£æç»“æœï¼Œäº‹ä»¶é€‰é¡¹ä¿®é¥°ç¬¦è¢«åˆå¹¶åˆ°äº‹ä»¶åä¸­ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="p">{</span>
    <span class="nx">parse</span><span class="p">,</span>
    <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;div @click.stop.capture.once=&#34;test&#34; /&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { withModifiers : _withModifiers, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, {
      onClickCaptureOnce: _withModifiers(test, [&#34;stop&#34;])
    }, null, 40 /* PROPS, HYDRATE_EVENTS */, [&#34;onClickCaptureOnce&#34;]))
  }
}
undefined
</pre>
<p>
 å¦‚ï¼šäº‹ä»¶å <code>onClickCaptureOnce</code></p>
</li>
<li>
<p>å¦‚æœäº‹ä»¶åä¸ºåŠ¨æ€æˆ–æ˜¯é”®ç›˜äº‹ä»¶ï¼Œå¾—ç”¨ <code>_withKeys()</code> åŒ…ä¸€å±‚</p>
</li>
</ol>
<hr>
<p>
æµ‹è¯•ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">tpl</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">ast</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="nx">tpl</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">onError</span><span class="o">:</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">log</span><span class="p">(</span><span class="sb">`é”™è¯¯æè¿°ï¼š</span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">log</span><span class="p">(</span><span class="sb">`&gt;&gt;&gt; </span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
  <span class="nx">log</span><span class="p">(</span><span class="nx">ast</span><span class="p">.</span><span class="nx">codegenNode</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;div @click.stop.prevent=&#34;test&#34; /&gt;`</span><span class="p">,</span> <span class="s1">&#39;å¤šä¸ªä¿®é¥°ç¬¦&#39;</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
&gt;&gt;&gt; å¤šä¸ªä¿®é¥°ç¬¦
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { withModifiers : _withModifiers, createVNode : _createVNode, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return (_openBlock(), _createBlock(&#34;div&#34;, {
      onClick: _withModifiers(test, [&#34;stop&#34;,&#34;prevent&#34;])
    }, null, 8 /* PROPS */, [&#34;onClick&#34;]))
  }
}
[
  {
    type: 16,
    loc: { source: &#39;&#39;, start: [Object], end: [Object] },
    key: {
      type: 4,
      loc: [Object],
      content: &#39;onClick&#39;,
      isStatic: true,
      constType: 3
    },
    value: {
      type: 14,
      loc: [Object],
      callee: Symbol(vOnModifiersGuard),
      arguments: [Array]
    }
  }
]
undefined
</pre>
<blockquote>
<p><code>&lt;f12&gt;</code> æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹æ›´å¤šæµ‹è¯•ç”¨ä¾‹ç»“æœã€‚</p>
</blockquote>
<script>
l1(`v-on`)
c(`<div @click.stop.prevent="test"/>`, 'æ”¯æŒå¤šä¸ªä¿®é¥°ç¬¦')
c(`<div @click.stop="test" @keyup.enter="test" />`, 'å¤šä¸ªäº‹ä»¶')
c(`<div @click.stop.capture.once="test"/>`, 'å¤šä¸ªä¿®é¥°ç¬¦å’Œäº‹ä»¶é€‰é¡¹')
c(`<div @keydown.stop.capture.ctrl.a="test"/>`, 'é”®ç›˜äº‹ä»¶æˆ–åŠ¨æ€äº‹ä»¶ï¼Œåº”è¯¥ç”¨ keys guard åŒ…ä¸€å±‚(runtime-dom: withKeys())')
c(`<div @keyup.exact="test"/>`, `æ²¡æœ‰æŒ‰é”®ä¿®é¥°ç¬¦çš„æ—¶å€™ï¼Œä¸éœ€è¦ keys guard`)
c(`<div @keyup.left="test"/>`, 'é™æ€äº‹ä»¶å+left/right ä¿®é¥°ç¬¦ï¼Œéœ€è¦ keys guard')
c(`<div @[e].left="test"/>`, 'åŠ¨æ€äº‹ä»¶å+left/right ä¿®é¥°ç¬¦ï¼Œéœ€è¦ keys guard')
c(`<div @keyup.enter="test"/>`, 'should not wrap normal guard if there is only keys guard')
// è½¬æˆ onContextmenu äº‹ä»¶
c(`<div @click.right="test"/>`, 'should transform click.right')
// å¦‚æœæ˜¯ click.right è½¬æˆ onContextmenu
c(`<div @[event].right="test"/>`, 'åŠ¨æ€äº‹ä»¶å + right ä¿®é¥°ç¬¦')
// è½¬æˆ onMouseup
c(`<div @click.middle="test"/>`, 'é¼ æ ‡ä¸­é”®æŒ‰é”®äº‹ä»¶')
c(`<div @[event].middle="test"/>`, 'é¼ æ ‡ä¸­é”®åŠ¨æ€æŒ‰é”®äº‹ä»¶')
compile.options = { cacheHandlers: true }
const root = c(`<div @keyup.enter.capture="foo" />`, 'ç¼“å­˜ handler ä¿®é¥°ç¬¦')
log(root)
</script>
<blockquote>
<p><strong>å°ç»“</strong> :</p>
<p>
äº‹ä»¶ä¿®é¥°ç¬¦åˆ†ä¸ºä¸‰å¤§ç±»</p>
<ol>
<li>
<p>äº‹ä»¶é€‰é¡¹ç±»å‹ä¿®é¥°ç¬¦(passive,capture,once)</p>
<p>
ä¼šå’Œäº‹ä»¶ååˆå¹¶ï¼š <code>click.capture.once</code> -&gt; <code>onClickCaptureOnce</code></p>
</li>
<li>
<p>é”®ç›˜äº‹ä»¶(åŒ…æ‹¬é”®ç›˜æŒ‰é”® a-b-c-â€¦)</p>
</li>
<li>
<p>å…¶ä»–ç±»å‹äº‹ä»¶ä¿®é¥°ç¬¦(å¦‚ï¼šstop,prevent,self, ctrl,shift,alt,meta,exact)</p>
</li>
</ol>
<p>
å…³äº <code>right, middle</code> ä¿®é¥°ç¬¦å¤„ç†æƒ…å†µ</p>
<ol>
<li>
<p>right å¤„ç†æˆ <code>onContextmenu</code> äº‹ä»¶</p>
</li>
<li>
<p>middle å¤„ç†æˆ <code>onMouseup</code> äº‹ä»¶ </p>
</li>
<li>
<p>right/middle æ˜¯åœ¨åŠ¨æ€äº‹ä»¶åä¸Šé¢ï¼Œä¼šæ£€æµ‹æ˜¯ä¸æ˜¯ onClick å¦‚æœæ˜¯è¿›è¡Œ 1/2 è½¬æ¢ï¼Œä¸
æ˜¯æŒ‰ç…§åŸäº‹ä»¶åå¤„ç†ã€‚</p>
<p>
å¦‚ï¼š <code>@[eventName].middle=&#34;test&#34;</code> -&gt; <code>eventName === &#39;onClick&#39; ? &#39;onMouseup&#39; :
eventName</code></p>
</li>
</ol>
</blockquote>
</div>
</div>
<div id="outline-container-headline-8" class="outline-2">
<h2 id="headline-8">
e64a1b3 add v-show transform
</h2>
<div id="outline-text-headline-8" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/e64a1b35823cb4ebcc96ad143d7dd8d45c05b185">feat(add): v-show transform Â· gcclll/stb-vue-next@e64a1b3</a></p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">transformShow</span>: <span class="kt">DirectiveTransform</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">exp</span><span class="p">,</span> <span class="nx">loc</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">dir</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exp</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span>
      <span class="nx">createDOMCompilerError</span><span class="p">(</span><span class="nx">DOMErrorCodes</span><span class="p">.</span><span class="nx">X_V_SHOW_NO_EXPRESSION</span><span class="p">,</span> <span class="nx">loc</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">props</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">needRuntime</span>: <span class="kt">context.helper</span><span class="p">(</span><span class="nx">V_SHOW</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æµ‹è¯•ï¼š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">ast</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="sb">`&lt;div v-show=&#34;test&#34;/&gt;`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`props: `</span><span class="p">,</span> <span class="nx">ast</span><span class="p">.</span><span class="nx">codegenNode</span><span class="p">.</span><span class="nx">props</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
const _Vue = Vue

return function render(_ctx, _cache) {
  with (_ctx) {
    const { vShow : _vShow, createVNode : _createVNode, withDirectives : _withDirectives, openBlock : _openBlock, createBlock : _createBlock } = _Vue

    return _withDirectives((_openBlock(), _createBlock(&#34;div&#34;, null, null, 512 /* NEED_PATCH */)), [
      [_vShow, test]
    ])
  }
}
props:  undefined
</pre>
<p>
è¿™é‡Œè²Œä¼¼ä»€ä¹ˆéƒ½æ²¡å¹²ï¼Œé™¤äº†è¿”å›ä¸€ä¸ª <code>needRuntime: context.helper(V_SHOW)</code> ï¼Œéš¾é“
v-show å¿…é¡»åœ¨ runtime æ—¶æœŸå¤„ç†ï¼Ÿï¼Ÿï¼Ÿ</p>
</div>
</div>
<div id="outline-container-headline-9" class="outline-2">
<h2 id="headline-9">
436db72 add transition component warn transform
</h2>
<div id="outline-text-headline-9" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/436db72743d5ff677a4a505e9a4cb914613ffe2a">feat(add): transition component transform Â· gcclll/stb-vue-next@436db72</a></p>
<p>
è¿™é‡Œåªæ˜¯åŠ äº†ä¸ªé”™è¯¯ç”¨æ³•å¤„ç†ï¼Œå¯¹äº <code>&lt;transition&gt;</code> ç»„ä»¶ä¸‹é¢åªèƒ½æœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹ã€‚</p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-2">
<h2 id="headline-10">
<span class="todo">TODO</span>
af56754 add stringifyStatic node ç¯å¢ƒé™æ€æå‡
</h2>
<div id="outline-text-headline-10" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/af56754e25a96f161f28bbd5f78473cb81fbeee1">feat(add): node stringify static -&gt; hoist Â· gcclll/stb-vue-next@af56754</a></p>
</div>
</div>
<div id="outline-container-headline-11" class="outline-2">
<h2 id="headline-11">
f0cbb25 add ignoreSideEffectTags transform
</h2>
<div id="outline-text-headline-11" class="outline-text-2">
<p>
<a href="https://github.com/gcclll/stb-vue-next/commit/f0cbb25e4a47cf2b243156a408ddb4a327420110">feat(add): ignore side effect tags &gt; script/style Â· gcclll/stb-vue-next@f0cbb25</a></p>
<p>
è¿™ä¸ª transform ä½œç”¨æ˜¯æ£€æµ‹æ¨¡æ¿ä¸­æ˜¯ä¸æ˜¯å­˜åœ¨ <code>&lt;script&gt;, &lt;style&gt;</code> æ ‡ç­¾ã€‚</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">parse</span><span class="p">,</span>
  <span class="nx">compile</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">tpl</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&gt;&gt;&gt; </span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compile</span><span class="p">(</span><span class="nx">tpl</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">onError</span><span class="o">:</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&gt; é”™è¯¯æè¿°ï¼š</span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;script&gt;console.log(1)&lt;/script&gt;`</span><span class="p">,</span> <span class="s1">&#39;å¿½ç•¥ &lt;script&gt; æ ‡ç­¾&#39;</span><span class="p">)</span>
<span class="nx">c</span><span class="p">(</span><span class="sb">`&lt;style&gt;h1 { color: red }&lt;/style&gt;`</span><span class="p">,</span> <span class="s1">&#39;å¿½ç•¥ &lt;style&gt; æ ‡ç­¾&#39;</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
&gt;&gt;&gt; å¿½ç•¥ &lt;script&gt; æ ‡ç­¾
&gt; é”™è¯¯æè¿°ï¼šTags with side effect (&lt;script&gt; and &lt;style&gt;) are ignored in client component templates.

return function render(_ctx, _cache) {
  with (_ctx) {
    return null
  }
}
&gt;&gt;&gt; å¿½ç•¥ &lt;style&gt; æ ‡ç­¾
&gt; é”™è¯¯æè¿°ï¼šTags with side effect (&lt;script&gt; and &lt;style&gt;) are ignored in client component templates.

return function render(_ctx, _cache) {
  with (_ctx) {
    return null
  }
}
undefined
</pre>
</div>
</div>
<div id="outline-container-headline-12" class="outline-2">
<h2 id="headline-12">
fd0f5ae add dom parserOptions and decode html
</h2>
<div id="outline-text-headline-12" class="outline-text-2">
<p>
å¯¹ compiler-core çš„ <code>ParserOptions</code> çš„ä¸€ç§æ‰©å±•:</p>
<ol>
<li>
<p><code>isNativeTag: tag =&gt; isHTMLTag(tag) || isSVGTag(tag)</code></p>
<p>
<em>vue-next/packages/shared/src/domTagConfig.ts</em></p>
<p>
ä¸­åˆ¶å®šäº†ä¸€äº›åŸç”Ÿçš„æ ‡ç­¾ã€‚</p>
</li>
<li>
<p><code>isPreTag</code>: <code>pre</code> æ ‡ç­¾</p>
</li>
<li>
<p><code>decodeEntities</code> html å®ä½“è½¬æ¢</p>
<p>
åˆ†ä¸ºæµè§ˆå™¨ç¯å¢ƒå’ŒNDOEç¯å¢ƒå¤„ç†</p>
<p>
æµè§ˆå™¨ç¯å¢ƒå¤„ç†è¾ƒä¸ºç®€å•(è½¬æ ‡ç­¾å†…å®¹å–å‡ºå­—ç¬¦ä¸²ï¼Œåˆ©ç”¨æµè§ˆå™¨è‡ªèº«èƒ½åŠ›æ¥è½¬æ¢)ï¼š</p>
<div class="src src-typescript">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-typescript" data-lang="typescript">
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">decodeHtmlBrowser</span><span class="p">(</span><span class="nx">raw</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
<span class="p">;(</span><span class="nx">decoder</span> <span class="o">||</span> <span class="p">(</span><span class="nx">decoder</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">))).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">raw</span>
<span class="k">return</span> <span class="nx">decoder</span><span class="p">.</span><span class="nx">textContent</span> <span class="kr">as</span> <span class="kt">string</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
NODE ç¯å¢ƒç¨å¾®å¤æ‚ï¼Œä¸‹é¢åšäº›ç®€å•æµ‹è¯•å§ï¼š</p>
<p>
<a href="https://html.spec.whatwg.org/multipage/named-characters.html">https://html.spec.whatwg.org/multipage/named-characters.html</a></p>
<p>
<em>vue-next/packages/compiler-dom/src/namedChars.json</em></p>
<p>
ä¸Šé¢é“¾æ¥å’Œè·¯å¾„ä¸­åŒ…å«äº†æ‰€æœ‰å­—ç¬¦çš„ 16è¿›åˆ¶ - ç¬¦å· - åå­—å¯¹åº”è¡¨(json)ï¼Œä¸‹é¢éšä¾¿æ‰¾
å‡ ä¸ªæ¥æµ‹è¯•ä¸‹-&gt; åˆ†æå¦‚æ³¨é‡Š</p>
<div class="src src-js">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
<span class="kr">const</span> <span class="p">{</span>
<span class="nx">decodeHtml</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PWD</span> <span class="o">+</span> <span class="s1">&#39;/../../static/js/vue/compiler-dom.global.js&#39;</span><span class="p">)</span>

<span class="kd">let</span> <span class="nx">rawText</span> <span class="o">=</span> <span class="s1">&#39;a &amp;#x20ac b &amp;nbsp; e &amp;FilledVerySmallSquare; d &amp;Gg; f&#39;</span>
<span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">decodeHtml</span><span class="p">(</span><span class="nx">rawText</span><span class="p">)</span>
<span class="c1">// while å¾ªç¯é‡Œé¦–å…ˆæ˜¯åŒ¹é…æ­£åˆ™ï¼š/&amp;(?:#x?)?/ -&gt; &amp;#x...åå…­è¿›åˆ¶æ•° æˆ– `&amp;[name];`
</span><span class="c1">// å½¢å¼çš„å­—ç¬¦ï¼Œname å–è‡ª namedChars.json æ–‡ä»¶çš„ key
</span><span class="c1">// å¦‚æœéƒ½æ²¡æœ‰åŒ¹é…åˆ°ç›´æ¥é€€å‡ºå¾ªç¯ï¼Œ
</span><span class="c1">// å³ decodeHtml ç›®çš„æ˜¯å°†16è¿›åˆ¶å’Œ named è¡¨ç¤ºçš„ç¬¦å·è½¬æ¢è¯­ä¹‰åŒ–çš„ç¬¦å·
</span><span class="c1">// å¦‚ï¼š &amp;#x20ac -&gt; &#34;euro;&#34;: &#34;â‚¬&#34; -&gt; â‚¬ ç¬¦å·
</span><span class="c1">// æˆ–è€… &amp;nbsp; ç¬¦å·
</span><span class="c1">// æˆ–è€…ä½¿ç”¨ namedChars.json ä¸­çš„åå­—æ¥ä½œä¸ºç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ï¼š &amp;FilledVerySmallSquare; -&gt; â–ª, &amp;Gg; -&gt;  â‹™
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<pre class="example">
a â‚¬ b Â  e â–ª d â‹™ f
undefined
</pre>
</li>
<li>
<p><code>isBuiltInComponent</code>, ä¸¤ä¸ªå†…ç½®ç»„ä»¶ï¼š <code>Transition, TransitionGroup</code></p>
</li>
<li>
<p><code>getNamespace</code>, æ›´è¯¦ç»†çš„å‘½åç©ºé—´æ£€æµ‹</p>
</li>
<li>
<p><code>getTextMode</code>, æ–‡æœ¬æ¨¡å¼æ£€æµ‹</p>
<p>
<code>textarea, title</code> æ ‡ç­¾è§†ä¸º <code>TextModes.RCDATA</code> ç±»å‹</p>
<p>
<code>style,iframe,script,noscript</code> æ ‡ç­¾è§†ä¸º <code>TextModes.RAWTEXT</code> ç±»å‹</p>
<p>
å…¶ä»–è§†ä¸º <code>TextModes.DATA</code> ç±»å‹</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-13" class="outline-2">
<h2 id="headline-13">
ç”¨ä¾‹æµ‹è¯•(<code>&lt;f12&gt;</code> æŸ¥çœ‹æ§åˆ¶å°)ï¼š
</h2>
<div id="outline-text-headline-13" class="outline-text-2">
<script src="/js/vue/node.env.dom.test.js"></script>
</div>
</div>
<div id="outline-container-headline-14" class="outline-2">
<h2 id="headline-14">
æ€»ç»“
</h2>
<div id="outline-text-headline-14" class="outline-text-2">
<blockquote>
<p>è¿™ä¸€æ¨¡å—çš„å®Œæˆï¼Œé›¶é›¶æ•£æ•£æ—¶é—´å¤§æ¦‚èŠ±äº†ä¸åˆ°ä¸€å‘¨çš„æ—¶é—´ï¼Œä¹Ÿæ˜¯ç”±äºæœ‰ <a href="/vue/vue-mind-map-compiler-core-transform-generate/">compiler-core</a> åŒ…
çš„å®ŒæˆåŠåˆ†æçš„åŸºç¡€ä¸Šï¼Œè¿›å±•æ‰ä¼šè¿™ä¹ˆé¡ºåˆ©ã€‚</p>
</blockquote>
<p>
å¯¹äº compiler-dom è¿™ä¸€æ¨¡å—ä¸»è¦å†…å®¹ï¼Œå¿«é€Ÿé¢„è§ˆå¯ä»¥æŸ¥çœ‹ç¬¬ä¸€ç« èŠ‚çš„<a href="#init">åŠŸèƒ½é¢„è§ˆ</a>ã€‚</p>
<p>
è¿™é‡Œé‡ç‚¹å…³æ³¨çš„åœ°æ–¹ï¼Œæˆ‘è®¤ä¸ºæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ol>
<li>
<p><code>v-model</code> å¯¹ <code>&lt;input&gt;</code> ç±»å‹æ£€æµ‹å’Œå¤„ç†</p>
</li>
<li>
<p><code>v-on</code> äº‹ä»¶ä¿®é¥°ç¬¦çš„å¤„ç†ï¼Œæˆ‘æ„Ÿè§‰æ˜¯è¿™ä¸ªæ¨¡å—çš„ <strong>é‡ä¸­ä¹‹é‡</strong></p>
</li>
<li>
<p>å¦å¤–å¯¹äº node ç¯å¢ƒçš„ html ç¬¦å·è¯­ä¹‰åŒ–çš„å¤„ç†ä¹Ÿå€¼å¾—åˆ†æ</p>
</li>
</ol>
</div>
</div>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Zhicheng Lee</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2020-12-16
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/vue/">vue,</a>
          <a href="/tags/vue3/">vue3,</a>
          <a href="/tags/compiler-dom/">compiler-dom</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/vue/vue-mind-map-compiler-sfc/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Vue3 æºç å¤´è„‘é£æš´ä¹‹ 5 â˜ compiler-sfc</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/vue/vue-mind-map-compiler-core-transform-generate/">
            <span class="next-text nav-default">Vue3 æºç å¤´è„‘é£æš´ä¹‹ 3 â˜compiler-core - transform &#43; codegen</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'zcheng';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><div id="lv-container" data-id="city" data-uid="MTAyMC81MTQwMC8yNzg4MQ==">
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
    <noscript>Please enable JavaScript to view the comments powered by <a href="https://livere.com/">LiveRe.</a></noscript>
    </div>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:gccll.love@email.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/6062239/simon" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/gccll_love" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/profile.php?id=100013995916088" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://github.com/gcclll" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/gccll" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://space.bilibili.com/384410681" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://www.cheng92.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡ </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> æœ¬ç«™æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> äºº </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2020 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>Zhicheng Lee</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
    docsearch({
    apiKey: "ac1e64640788e5697016a58be1ec7232",
    indexName: "cheng92.com",
    appId: "EDIKM3W4HV",
    inputSelector: '.docsearch-input',
    debug: false,
    });
</script>



<script type="text/javascript" src="/js/main.min.db4c43431f3833e1a48d3c8754f77c8250eedde3c20810a308f35779fdf8acd1.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-175986456-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>





<script src="/js/global.js"></script>


</body>
</html>
