#+TITLE: Vue3 è‡ªé—®è‡ªç­”ç³»åˆ—â“â“â“
#+DATE: <2021-07-17 17:24:45>
#+TAGS[]: vue, vue3
#+CATEGORIES[]: vue
#+LANGUAGE: zh-cn
#+STARTUP: indent shrink

#+begin_export html
<link href="https://fonts.goo~gleapis.com/cs~s2?family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
<kbd>
<font color="blue" size="3" style="font-family: 'ZCOOL XiaoWei', serif;">
  è¯—å·ï¼šå…­é“åŒå ï¼Œé­”åŠ«ä¸‡åƒï¼Œå¼•æ¸¡å¦‚æ¥ã€‚
</font>
</kbd><br><br>
#+end_export

[[/img/bdx/yiyeshu-001.jpg]]

#+begin_quote
æœ¬æ–‡çº¯ç²¹çš„é“¾æ¥ï¼Œåˆ—å‡ºæºç å­¦ä¹ è¿‡ç¨‹ä¸­é‡è¦çŸ¥è¯†ç‚¹å’ŒåŠŸèƒ½ç‰¹æ€§æœ‰å…³çš„åˆ†æé“¾æ¥ï¼Œè¿™äº›é“¾æ¥ä¸»
è¦é“¾æ¥åˆ°æœ¬ç½‘ç«™å†…æ–‡ç« ï¼Œä¸æ’é™¤æœ‰å¤–é“¾å…¶ä»–ç½‘ç«™ã€‚
#+end_quote

1. [[/vue/vue-teardown-7-asset-transform/][æ¨¡æ¿ä¸­çš„èµ„æº URL æ˜¯å¦‚ä½•è¯†åˆ«çš„ï¼Œæœ€ååˆæ˜¯è¢«ç¼–è¯‘æˆå•¥äº†ï¼Ÿ]](å¦‚ï¼š ~<img
   src="@img/vue/test.png" />~)
2. TODO component render å‡½æ•°åœ¨å“ªé‡Œæ‰§è¡Œï¼Ÿ
3. <script setup> åŸç†å’Œç¼–è¯‘è¿‡ç¨‹åŠç»“æœï¼Ÿ
4. [[/vue/vue-mind-map-runtime-core-3-component/#setup][setup å‡½æ•°å¦‚ä½•è§£æï¼Ÿåˆæ˜¯å¦‚ä½•æ‰§è¡Œï¼Ÿ]]

   render -> patch -> processComponent -> mountComponent ->
   createComponentInstance -> åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œåˆå§‹åŒ–ç»„ä»¶ç»“æ„ ->

   setupComponent -> åˆå§‹åŒ– props å’Œ slotsï¼Œæœ‰çŠ¶æ€ç»„ä»¶å¤„ç†

   setupStatefulComponent -> ç»™ instance.ctx å¢åŠ ä»£ç†ï¼Œæ‰§è¡Œ setup() å‡½æ•°

   ä¹Ÿå°±æ˜¯è¯´åœ¨ setup æ‰§è¡Œä¹‹å‰ props, emits, slots éƒ½å·²ç»å¯ä»¥è®¿é—®äº†ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°
   åœ¨ç»„ ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œå› ä¸ºåé¢ç»„ä»¶çš„æ›´æ–°æ—¶ç›´æ¥è°ƒç”¨ ~instance.update~ æ¥å®Œæˆï¼Œä¸ä¼šè¿›å…¥ mountComponent ã€‚

5. [[/vue/vue-teardown-4-props-attrs/][props ? attrs ? å½“ç»™å­ç»„ä»¶ä¼ é€’å±æ€§çš„æ—¶å€™ï¼Œå“ªäº›åœ¨ props ä¸­ï¼Œå“ªäº›åœ¨ attrsä¸­ï¼Ÿ]]

   æ¯”å¦‚ï¼š
   #+begin_src html
   <Child name="child" foo=1 bar=true/>
   #+end_src

   name, foo, bar åœ¨ Child ç»„ä»¶ä¸­å­˜åœ¨å“ªé‡Œäº†ï¼Ÿ

   æ˜¯ props ? attrs ?

6. [[/vue/vue-teardown-2-sheduler/][vue3 ä¸­å’Œ scheduler ä»»åŠ¡è°ƒåº¦æœ‰å…³çš„ä»£ç ï¼]]

   è®²è¿°äº† runtime-core/src/scheduler.ts ä¸­ api åœ¨å“ªäº›åœ°æ–¹æœ‰ç”¨åˆ°ï¼Œè¿™äº›ä½¿ç”¨çš„åœ°æ–¹
   ä»»åŠ¡æ‰§è¡Œé¡ºåºåˆæ˜¯ä»€ä¹ˆâ“

7. [[/vue/vue-mind-map-runtime-dom/#prop-on-xxx][vue3 äº‹ä»¶ç»‘å®šæ˜¯å¦‚ä½•å®ç°çš„(stopImmediatePropagation åˆæ˜¯å•¥?)ï¼Ÿ]]

   ç®€è¿°ï¼šä¸€ä¸ªå…ƒç´ ä¸€ä¸ªäº‹ä»¶åå¯¹åº”çš„äº‹ä»¶åªä¼šç»‘å®šä¸€ä¸ª listener åŠ å°è£…ä¹‹åçš„
   invokerï¼Œæ­¤æ—¶ä¸ºäº†å®ç°åŸç”Ÿäº‹ä»¶çš„ stopImmediatePropagation åŠŸèƒ½ï¼Œå¯¹
   invoker.value å³äº‹ä»¶å¥æŸ„åˆ—è¡¨é‡Œé¢çš„æ‰€æœ‰äº‹ä»¶å¥æŸ„(å‡½æ•°)è¿›è¡Œäº†é‡å†™ã€‚

8. [[/vue/vue-mind-map-runtime-core/#scheduler][vue3 å¼‚æ­¥ä»»åŠ¡è°ƒåº¦æœºåˆ¶ runtime-core->scheduler æ˜¯å¦‚ä½•å®ç°çš„?]]

   vue3 ä¸­çš„å¼‚æ­¥æ›´æ–°ä»»åŠ¡åˆ†ä¸ºä¸‰ç§ï¼š pre cbs/queue jobs/post cbsï¼Œä»–ä»¬çš„æ‰§è¡Œéƒ½æœ‰ä¸€
   å®šçš„å…ˆåé¡ºåºï¼Œç‚¹å‡»[[/vue/vue-mind-map-runtime-core/#scheduler][é“¾æ¥]]äº†è§£æ›´å¤šåˆ†æå†…å®¹ã€‚

9. [[/vue/vue-mind-map-runtime-core-render/#keyed-children][vue3 diff åŸç†ï¼Ÿ]]

  | old         | new           | æ›´æ–°åŸåˆ™     |
  |-------------+---------------+--------------|
  | ~[1]~       | ~[1,2,3]~     | appendï¼Œæ–°å¢ |
  | ~[4,5]~     | ~[1,2,3,4,5]~ | appendï¼Œæ–°å¢ |
  | ~[2,3,4]~   | ~[1,2,3,4,5]~ | æ–°å¢+æ’å…¥    |
  | ~[1,2,3,4]~ | ~[2,3,1,4]~   | ä¸€æ¬¡ç§»åŠ¨     |
  | ~[1,2,3,4]~ | ~[1,4,2,3]~   | ä¸€æ¬¡ç§»åŠ¨     |
  | ~[1,2,3]~   | ~[2,3,1]~     | ä¸€æ¬¡ç§»åŠ¨     |
  | ~[1,2,3,4]~ | ~[4,2,3,1]~   | ä¸€æ¬¡ç§»åŠ¨     |

  è¯¸å¦‚ä¸Šé¢çš„å®ä¾‹æ˜¯å¦‚ä½•å®ç°æ’å…¥ï¼Œæ–°å¢ï¼Œåˆ é™¤å’Œç§»åŠ¨çš„ï¼Ÿ

  è¿™é‡Œåˆæ˜¯å¦‚ä½•åˆ©ç”¨â€œæœ€é•¿å¢é•¿åºåˆ—â€æ¥è¿‡æ»¤æ‰ä¸éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„ï¼Ÿ

  ç®€è¿°ï¼š ä¸¤ä¸ª while + if...else if...else

  while1 æ£€æµ‹ patch å¤´éƒ¨ç›¸åŒèŠ‚ç‚¹

  while2 æ£€æµ‹ patch å°¾éƒ¨ç›¸åŒèŠ‚ç‚¹

  ç»è¿‡ä¸¤ä¸ª while å¤„ç†ä¹‹åå‰©ä¸‹çš„åªæœ‰ä¸è§„åˆ™çš„ä¸¤ç»„(new & old)åºåˆ—ã€‚

  if æ‰§è¡Œæ–°å¢

  else if æ‰§è¡Œåˆ é™¤

  else ä¾ç…§ã€æœ€é•¿å¢é•¿åºåˆ—ã€ç®—æ³•è¿›è¡Œåˆ†æï¼Œå†³å®šæ˜¯åˆ é™¤è¿˜æ˜¯æ–°å¢æˆ–æ’å…¥ã€‚

  æœ€é•¿å¢é•¿åºåˆ—ï¼šæ‰¾åˆ°ä¸€ç»„åºåˆ—ä¸­è·¯å¾„æœ€é•¿çš„é€’å¢åºåˆ—ï¼Œæ¯”å¦‚ï¼š

  ~2,3,1,4~ æœ€é•¿å¢é•¿åºåˆ—å°±æ˜¯ ~2,3,4~

  å‰©ä¸‹çš„å…ƒç´ åªå¯èƒ½æ¯”è¿™ä¸ªåºåˆ—ä¸­çš„å…ƒç´ å€¼å°(å¦‚ï¼š ~1~)

  å¯¹äºä¸è§„åˆ™çš„åºåˆ—å¯¹æ¯”è¿‡ç¨‹ä¸­ï¼Œä¼šä¼˜å…ˆæŸ¥æ‰¾æœ‰ key çš„ child, æ ¹æ® old child key å»
   new children ä¸­æ‰¾åˆ°ç›¸åŒ key çš„ new child æ¥æ›¿æ¢è¿™ä¸ª old childã€‚

  å¦‚æœæ²¡æ‰¾åˆ°ç›¸åŒ key çš„ new child é‚£è¿™ä¸ª old child å°†é¢ä¸´è¢«åˆ é™¤çš„å‘½è¿ã€‚

  å¦‚æœ old child ä¹Ÿæ˜¯ unkeyed é‚£ä¼šä» new children ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ª unkeyed çš„ new child æ¥æ›¿æ¢ã€‚

  æ‰€ä»¥æ€»ç»“ä¸‹æ¥ï¼š

   a. while1 åŒåŒ–å¤´éƒ¨
   b. while2 åŒåŒ–å°¾éƒ¨
   c. if æ–°å¢
   d. else if åˆ é™¤
   e. else ä¸è§„åˆ™åºåˆ—

      + keyed old child æ‰¾ keyed new childï¼Œæ²¡æœ‰ unmount old

      + unkeyed old child æ‰¾ unkeyed new child, æ²¡æœ‰ unmount old

      + å‰©ä½™çš„ new child æ–°å¢

      + æœ€åæ ¹æ®æœ€é•¿é€’å¢åºåˆ—ç®—æ³•è¿›è¡Œç§»åŠ¨ï¼Œå‰ææ˜¯éœ€è¦ç§»åŠ¨

10. [[/vue/vue-mind-map-runtime-core-3-component/#keep-alive][keep-alive ç»„ä»¶å®ç°åŸç†ï¼Ÿ]]

    activate å’Œ deactivate çŠ¶æ€åˆ‡æ¢çš„å®é™…åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

    #+begin_quote
    â‰ é€šè¿‡åˆ›å»ºä¸€ä¸ª off-dom div æ¥æ‰¿æ¥ deactivate çŠ¶æ€ä¸‹çš„ DOM ğŸŒ²ã€‚
    #+end_quote
