#+TITLE: JavaScript Api - Number.parseInt(s, r)
#+DATE: <2021-01-25 17:58:20>
#+TAGS[]: javascript, api, Number
#+CATEGORIES[]: javascript, web
#+LANGUAGE: zh-cn
#+STARTUP: indent ^:{}


#+begin_quote
~parseInt(string, radix)~
#+end_quote

åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹ä¸‹é¢çš„æµ‹è¯•ä»£ç ç»“æœï¼š

#+begin_src js
const noop = () => {}
var vals = [
  1, // 0
  '1', // 1
  NaN, // 2
  null, // 3
  {}, // 4
  false, // 5
  true, // 6
  { length: 2, 0: 'a', 1: 'b' }, // 7
  { a: 1 }, //8
  [], // 9
  [1, 2], // 10
  noop, // 11
  undefined, // 12
  void 0 // 13
]

// åœ¨æ‰§è¡Œä¹‹å‰ï¼Œä¸Šé¢ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ
const result = vals.map(v => parseInt(v, 10))
console.log('\n', result)
console.log('[1,2] => ', result[10])
#+end_src

#+RESULTS:
:
:  [
:     1,   1, NaN, NaN, NaN,
:   NaN, NaN, NaN, NaN, NaN,
:     1, NaN, NaN, NaN
: ]
: [1,2] =>  1
: undefined

å‘ç°é—®é¢˜æ²¡ï¼Œç–‘æƒ‘ç‚¹å°± ~parseInt~ åœ¨ ~[1,2] // 10~ çš„æ—¶å€™ï¼Œç»“æœå±…ç„¶æ˜¯ *1* ?

[[https://tc39.es/ecma262/#sec-parseint-string-radix][parseInt]] å®ç°ä¼ªç ï¼š
#+begin_src js
const ToString = (s) => "" + s;
const TrimString = (s) => (s || "").trim();
const ToInt32 = (v) => +v;
const log = console.log;
function parseInt(string, radix) {
  let inputString = ToString(string); // ~æ‚è„¸~ï¼Œè¿™ä¸€è¡Œå°±è¯´æ˜é—®é¢˜äº†
  let S = TrimString(inputString);
  let sign = 1;
  // 0x002D -> '-', S.codePointAt(0) === 0x002D
  if (S) {
    const ch = S[0];
    if (ch === "-") {
      sign = -1;
      // åˆ é™¤ -
      S = S.slice(1);
    } else if (ch === "+") {
      sign = 1;
      // åˆ é™¤ +
      S = S.slice(1);
    }
  }

  // è¿›åˆ¶
  let R = ToInt32(radix || 0);
  let stripPrefix = true;
  if (R !== 0) {
    // åªæ”¯æŒ 2~36 è¿›åˆ¶
    if (R < 2 || R > 36) return NaN;
    if (R !== 16) {
      stripPrefix = false;
    }
  } else {
    // ä¸º 0 æ—¶é»˜è®¤ 10 è¿›åˆ¶
    R = 10;
  }

  if (stripPrefix) {
    if (S.length > 2 && S.slice(0, 2).toLowerCase() === "0x") {
      S = S.slice(2); // delete '0x' or '0X'
      R = 16;
    }
  }

  // å¦‚æœ S ä¸­åŒ…å«éè¿›åˆ¶å†…çš„å­—ç¬¦ï¼Œå°† end é‡ç½®ä¸ºè¯¥å­—ç¬¦çš„ç´¢å¼•å€¼
  let len = S.length,
    end = len - 1;
  const table = "0123456789abcdefghijklmnopqrstuvwxyz".slice(0, radix);
  for (let i = 0; i < len; i++) {
    const c = S[i].toLowerCase();
    // 10 è¿›åˆ¶æ˜¯ 0 - 9
    // 2 -> 0, 1
    // 3 -> 0, 1, 2
    // ...
    // 36 -> 0, ..., 9, a, ..., z
    if (!table.includes(c)) {
      // è¿™é‡Œå‡è®¾æ˜¯ 10è¿›åˆ¶
      end = i; // ç¬¬ä¸€ä¸ªéè¿›åˆ¶å†…çš„å­—ç¬¦
      break;
    }
  }
  let Z = S.slice(0, end > 0 ? end + 1 : 0);
  if (!Z) return NaN;

  let mathInt = parseWithRadix(Z, R);

  // mathInt è½¬æˆå¯¹åº”è¿›åˆ¶çš„æ•°
  if (mathInt === 0) {
    return sign === -1 ? -0 : +0;
  }
  return sign * mathInt;
}

function parseWithRadix(Z, radix = 10) {
  let mathInt = 0;

  const zLen = Z.length;

  const base = "a".codePointAt(0);
  for (let i = 0; i < zLen; i++) {
    let c = Z[i].toLowerCase();

    if (c >= "a" && c <= "z" && radix > 10) {
      c = 10 + c.codePointAt(0) - base;
    }

    mathInt += +c * Math.pow(radix, zLen - i - 1);
  }
  return mathInt;
}

function test(val) {
  let result = [];
  for (let i = 0; i < 40; i++) {
    result.push(`R: ${i}, V: ${parseInt(val, i)}`);
  }
  log("\n", result);
}
test("EEE");
log(parseInt("0xEEE", 16));
log(parseInt("111111", 2));
test("-20AFE");
#+end_src

#+RESULTS:
#+begin_example

 [
  'R: 0, V: NaN',    'R: 1, V: NaN',    'R: 2, V: NaN',
  'R: 3, V: NaN',    'R: 4, V: NaN',    'R: 5, V: NaN',
  'R: 6, V: NaN',    'R: 7, V: NaN',    'R: 8, V: NaN',
  'R: 9, V: NaN',    'R: 10, V: NaN',   'R: 11, V: NaN',
  'R: 12, V: NaN',   'R: 13, V: NaN',   'R: 14, V: NaN',
  'R: 15, V: 3374',  'R: 16, V: 3822',  'R: 17, V: 4298',
  'R: 18, V: 4802',  'R: 19, V: 5334',  'R: 20, V: 5894',
  'R: 21, V: 6482',  'R: 22, V: 7098',  'R: 23, V: 7742',
  'R: 24, V: 8414',  'R: 25, V: 9114',  'R: 26, V: 9842',
  'R: 27, V: 10598', 'R: 28, V: 11382', 'R: 29, V: 12194',
  'R: 30, V: 13034', 'R: 31, V: 13902', 'R: 32, V: 14798',
  'R: 33, V: 15722', 'R: 34, V: 16674', 'R: 35, V: 17654',
  'R: 36, V: 18662', 'R: 37, V: NaN',   'R: 38, V: NaN',
  'R: 39, V: NaN'
]
3822
63

 [
  'R: 0, V: NaN',       'R: 1, V: NaN',
  'R: 2, V: NaN',       'R: 3, V: NaN',
  'R: 4, V: NaN',       'R: 5, V: NaN',
  'R: 6, V: NaN',       'R: 7, V: NaN',
  'R: 8, V: NaN',       'R: 9, V: NaN',
  'R: 10, V: NaN',      'R: 11, V: -2787',
  'R: 12, V: -3591',    'R: 13, V: -4539',
  'R: 14, V: -5643',    'R: 15, V: -6915',
  'R: 16, V: -133886',  'R: 17, V: -170201',
  'R: 18, V: -213476',  'R: 19, V: -264551',
  'R: 20, V: -324314',  'R: 21, V: -393701',
  'R: 22, V: -473696',  'R: 23, V: -565331',
  'R: 24, V: -669686',  'R: 25, V: -787889',
  'R: 26, V: -921116',  'R: 27, V: -1070591',
  'R: 28, V: -1237586', 'R: 29, V: -1423421',
  'R: 30, V: -1629464', 'R: 31, V: -1857131',
  'R: 32, V: -2107886', 'R: 33, V: -2383241',
  'R: 34, V: -2684756', 'R: 35, V: -3014039',
  'R: 36, V: -3372746', 'R: 37, V: NaN',
  'R: 38, V: NaN',      'R: 39, V: NaN'
]
undefined
#+end_example

#+begin_quote
å…³é”®ç‚¹ï¼š

1. è¾“å…¥å€¼ä¸€è¿›æ¥å°±ä¼šè¿›è¡Œå­—ç¬¦ä¸²åŒ–ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ•°ç»„ ~[1,2]~ æœ€åå¾—åˆ°çš„ç»“æœæ˜¯ *1*
   äº†
2. è¿›åˆ¶æ•°çš„å¤„ç†ï¼Œä¸º 0 æ—¶ ~radix = 10~, é ~[2, 36]~ åŒºé—´çš„æ•°è§†ä¸ºéæ³•è¿›åˆ¶
3. è¾“å…¥çš„å†…å®¹(~string~) å¦‚ä½•è½¬æˆå¯¹åº”è¿›åˆ¶çš„æ•°ï¼Œå³ ~parse(Z, radix)~ å‡½æ•°
#+end_quote

å­—ç¬¦ä¸²è½¬æ•°å­—å‡½æ•°ï¼š
#+begin_src js
function parse(Z, radix = 10) {
  let mathInt = 0;

  const zLen = Z.length;

  const base = 'a'.codePointAt(0)
  for (let i = 0; i < zLen; i++) {
    let c = Z[i].toLowerCase()

    if (c >= 'a' && c <= 'z' && radix === 16) {
      c = 10 + c.codePointAt(0) - base
    }

    mathInt += +c * Math.pow(radix, zLen - i - 1);
  }
  return mathInt
}
const log = console.log
log(parse('EEE', 16))
#+end_src

#+RESULTS:
: 3822
: undefined

#+begin_quote
â“â“â“ parseInt(0.0000005) = 5  â“â“â“
#+end_quote

æµ‹è¯•ï¼š
#+begin_src js
function test(res) {
  console.log(`parseInt(${res}) = ` + parseInt(res))
}

test(0.5)
test(0.05)
test(0.005)
test(0.0005)
test(0.00005)
test(0.000005)
test(0.0000005)
test(0.00000005)
test(0.000000005)
#+end_src

#+RESULTS:
#+begin_example
parseInt(0.5) = 0
parseInt(0.05) = 0
parseInt(0.005) = 0
parseInt(0.0005) = 0
parseInt(0.00005) = 0
parseInt(0.000005) = 0
parseInt(5e-7) = 5
parseInt(5e-8) = 5
parseInt(5e-9) = 5
undefined
#+end_example

ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­

ç»“æœä¸ç”¨åˆ†æäº†å§ï¼Œä¸Šé¢çš„ç»“æœå¾ˆæ˜æ˜¾äº†ï¼Œè¶…è¿‡6ä½çš„å°æ•°åœ¨ toString çš„æ—¶å€™è¢«è½¬æˆäº†æŒ‡
æ•°è¡¨ç¤ºå½¢å¼äº†ï¼Œè€Œ parseInt å®ç°ä¼ªç ä¸€å¼€å§‹å°±ä¼šå°†ä¼ è¿›å»çš„æ•°å­—è½¬æˆå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æœ€ååœ¨
è¯†åˆ«å­—ç¬¦ä¸²çš„æ—¶å€™é‡åˆ°äº† ~e~ å°±ç»ˆæ­¢äº†ï¼Œæœ€ç»ˆå¾—åˆ° 5 çš„ç»“æœã€‚

æœ¬ç€è¿½æ ¹ç©¶åº•çš„åŸåˆ™ï¼Œè¿˜æ˜¯å»çœ‹ä¸‹ toString é‡Œé¢æ˜¯æ€ä¹ˆå¤„ç†çš„å§ ğŸš†

[[https://tc39.es/ecma262/#sec-tostring][ECMAScriptÂ® 2022 LanguageÂ Specification - toString]]

[[/img/tmp/ecma-tostring.png]]

è¿™é‡Œå°±è¦çœ‹ä¸‹æ•°å­—æ˜¯å¦‚ä½•è½¬æˆå­—ç¬¦ä¸²çš„ï¼š [[/web/apis/js-api-number-tostring/][Number::toString ( x )]]
